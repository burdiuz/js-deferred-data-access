{"version":3,"file":"remote-resource-pool.js","sources":["../node_modules/@actualwave/event-dispatcher/dist/event-dispatcher.js","../source/utils/hasOwnProperty.js","../source/utils/generateId.js","../source/utils/RAW_RESOURCE_DATA_KEY.js","../source/utils/RESOURCE_INTERNALS_KEY.js","../source/utils/getInternals.js","../source/Resource.js","../source/resource/isResource.js","../source/createResource.js","../source/ResourcePool.js","../source/createResourcePool.js","../source/defaultResourcePool.js","../source/PoolRegistry.js","../source/createPoolRegistry.js","../source/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"EventDispatcher\"] = factory();\n\telse\n\t\troot[\"EventDispatcher\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"http://localhost:8081/dist/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Event = undefined;\n\nvar _EventDispatcher = __webpack_require__(1);\n\nvar _EventDispatcher2 = _interopRequireDefault(_EventDispatcher);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = _EventDispatcher2.default;\nexports.Event = _EventDispatcher.Event;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar hasOwnProp = function hasOwnProp(target, name) {\n  return Object.prototype.hasOwnProperty.call(target, name);\n}; /**\r\n    * Created by Oleg Galaburda on 09.02.16.\r\n    * \r\n    */\n\nvar Event = exports.Event = function () {\n  function Event(type) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n    _classCallCheck(this, Event);\n\n    this.type = type;\n    this.data = data;\n    this.defaultPrevented = false;\n  }\n\n  _createClass(Event, [{\n    key: 'toJSON',\n    value: function toJSON() {\n      return { type: this.type, data: this.data };\n    }\n  }, {\n    key: 'isDefaultPrevented',\n    value: function isDefaultPrevented() {\n      return this.defaultPrevented;\n    }\n  }, {\n    key: 'preventDefault',\n    value: function preventDefault() {\n      this.defaultPrevented = true;\n    }\n  }]);\n\n  return Event;\n}();\n\nvar ListenersRunner = function () {\n  function ListenersRunner(listeners, onStopped, onComplete) {\n    var _this = this;\n\n    _classCallCheck(this, ListenersRunner);\n\n    this.index = -1;\n    this.immediatelyStopped = false;\n\n    this.stopImmediatePropagation = function () {\n      _this.immediatelyStopped = true;\n    };\n\n    this.listeners = listeners;\n    this.onStopped = onStopped;\n    this.onComplete = onComplete;\n  }\n\n  _createClass(ListenersRunner, [{\n    key: 'run',\n    value: function run(event, target) {\n      var listener = void 0;\n      var listeners = this.listeners;\n\n      this.augmentEvent(event);\n      // TODO this has to be handled in separate object ListenersRunner that should be\n      // created for each call() call and asked for index validation on each listener remove.\n      for (this.index = 0; this.index < listeners.length; this.index++) {\n        if (this.immediatelyStopped) break;\n        listener = listeners[this.index];\n        listener.call(target, event);\n      }\n      this.clearEvent(event);\n      this.onComplete(this);\n    }\n  }, {\n    key: 'augmentEvent',\n    value: function augmentEvent(eventObject) {\n      var event = eventObject;\n      event.stopPropagation = this.onStopped;\n      event.stopImmediatePropagation = this.stopImmediatePropagation;\n    }\n\n    /* eslint class-methods-use-this: \"off\" */\n\n  }, {\n    key: 'clearEvent',\n    value: function clearEvent(eventObject) {\n      var event = eventObject;\n      delete event.stopPropagation;\n      delete event.stopImmediatePropagation;\n    }\n  }, {\n    key: 'listenerRemoved',\n    value: function listenerRemoved(listeners, index) {\n      if (listeners === this.listeners && index <= this.index) {\n        this.index--;\n      }\n    }\n  }]);\n\n  return ListenersRunner;\n}();\n\nvar EventListeners = function () {\n  function EventListeners() {\n    var _this2 = this;\n\n    _classCallCheck(this, EventListeners);\n\n    this._listeners = {};\n    this._runners = [];\n\n    this.removeRunner = function (runner) {\n      _this2._runners.splice(_this2._runners.indexOf(runner), 1);\n    };\n  }\n  /**\r\n   * key - event Type\r\n   * value - hash of priorities\r\n   *    key - priority\r\n   *    value - list of handlers\r\n   * @type {Object<string, Object.<string, Array<number, Function>>>}\r\n   * @private\r\n   */\n\n\n  _createClass(EventListeners, [{\n    key: 'createList',\n    value: function createList(eventType, priorityOpt) {\n      var priority = parseInt(priorityOpt, 10);\n      var target = this.getPrioritiesByKey(eventType);\n      var key = String(priority);\n      var value = void 0;\n      if (hasOwnProp(target, key)) {\n        value = target[key];\n      } else {\n        value = [];\n        target[key] = value;\n      }\n      return value;\n    }\n  }, {\n    key: 'getPrioritiesByKey',\n    value: function getPrioritiesByKey(key) {\n      var value = void 0;\n      if (hasOwnProp(this._listeners, key)) {\n        value = this._listeners[key];\n      } else {\n        value = {};\n        this._listeners[key] = value;\n      }\n      return value;\n    }\n  }, {\n    key: 'add',\n    value: function add(eventType, handler, priority) {\n      var handlers = this.createList(eventType, priority);\n      if (handlers.indexOf(handler) < 0) {\n        handlers.push(handler);\n      }\n    }\n  }, {\n    key: 'has',\n    value: function has(eventType) {\n      var priority = void 0;\n      var result = false;\n      var priorities = this.getPrioritiesByKey(eventType);\n      if (priorities) {\n        for (priority in priorities) {\n          if (hasOwnProp(priorities, priority)) {\n            result = true;\n            break;\n          }\n        }\n      }\n      return result;\n    }\n  }, {\n    key: 'remove',\n    value: function remove(eventType, handler) {\n      var _this3 = this;\n\n      var priorities = this.getPrioritiesByKey(eventType);\n      if (priorities) {\n        var list = Object.getOwnPropertyNames(priorities);\n        var length = list.length;\n\n        var _loop = function _loop(index) {\n          var priority = list[index];\n          var handlers = priorities[priority];\n          var handlerIndex = handlers.indexOf(handler);\n          if (handlerIndex >= 0) {\n            handlers.splice(handlerIndex, 1);\n            if (!handlers.length) {\n              delete priorities[priority];\n            }\n            _this3._runners.forEach(function (runner) {\n              runner.listenerRemoved(handlers, handlerIndex);\n            });\n          }\n        };\n\n        for (var index = 0; index < length; index++) {\n          _loop(index);\n        }\n      }\n    }\n  }, {\n    key: 'removeAll',\n    value: function removeAll(eventType) {\n      delete this._listeners[eventType];\n    }\n  }, {\n    key: 'createRunner',\n    value: function createRunner(handlers, onStopped) {\n      var runner = new ListenersRunner(handlers, onStopped, this.removeRunner);\n      this._runners.push(runner);\n      return runner;\n    }\n  }, {\n    key: 'call',\n    value: function call(event, target) {\n      var priorities = this.getPrioritiesByKey(event.type);\n      var stopped = false;\n      var stopPropagation = function stopPropagation() {\n        stopped = true;\n      };\n      if (priorities) {\n        // getOwnPropertyNames() or keys()?\n        var list = Object.getOwnPropertyNames(priorities).sort(function (a, b) {\n          return a - b;\n        });\n        var length = list.length;\n\n        for (var index = 0; index < length; index++) {\n          if (stopped) break;\n          var _handlers = priorities[list[index]];\n          // in case if all handlers of priority were removed while event\n          // was dispatched and handlers become undefined.\n          if (_handlers) {\n            var _runner = this.createRunner(_handlers, stopPropagation);\n            _runner.run(event, target);\n            if (_runner.immediatelyStopped) break;\n          }\n        }\n      }\n    }\n  }]);\n\n  return EventListeners;\n}();\n\nvar EventDispatcher = function () {\n  function EventDispatcher() {\n    var eventPreprocessor = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    var noInit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    _classCallCheck(this, EventDispatcher);\n\n    if (!noInit) {\n      this.initialize(eventPreprocessor);\n    }\n  }\n\n  /**\r\n   * @private\r\n   */\n\n\n  _createClass(EventDispatcher, [{\n    key: 'initialize',\n    value: function initialize() {\n      var eventPreprocessor = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\n      this._eventPreprocessor = eventPreprocessor;\n      this._listeners = new EventListeners();\n    }\n  }, {\n    key: 'addEventListener',\n    value: function addEventListener(eventType, listener) {\n      var priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n      this._listeners.add(eventType, listener, -priority || 0);\n    }\n  }, {\n    key: 'hasEventListener',\n    value: function hasEventListener(eventType) {\n      return this._listeners.has(eventType);\n    }\n  }, {\n    key: 'removeEventListener',\n    value: function removeEventListener(eventType, listener) {\n      this._listeners.remove(eventType, listener);\n    }\n  }, {\n    key: 'removeAllEventListeners',\n    value: function removeAllEventListeners(eventType) {\n      this._listeners.removeAll(eventType);\n    }\n  }, {\n    key: 'dispatchEvent',\n    value: function dispatchEvent(event, data) {\n      var eventObject = EventDispatcher.getEvent(event, data);\n      if (this._eventPreprocessor) {\n        eventObject = this._eventPreprocessor.call(this, eventObject);\n      }\n      this._listeners.call(eventObject);\n    }\n  }], [{\n    key: 'isObject',\n    value: function isObject(value) {\n      return (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' && value !== null;\n    }\n  }, {\n    key: 'getEvent',\n    value: function getEvent(eventOrType, optionalData) {\n      var event = eventOrType;\n      if (!EventDispatcher.isObject(eventOrType)) {\n        event = new EventDispatcher.Event(String(eventOrType), optionalData);\n      }\n      return event;\n    }\n  }, {\n    key: 'create',\n    value: function create(eventPreprocessor) {\n      return new EventDispatcher(eventPreprocessor);\n    }\n\n    /* eslint no-undef: \"off\" */\n\n  }]);\n\n  return EventDispatcher;\n}();\n\nEventDispatcher.Event = Event;\n\nexports.default = EventDispatcher;\n\n/***/ })\n/******/ ]);\n});\n//# sourceMappingURL=event-dispatcher.js.map","export default ((hasOwnProperty) =>\r\n  (target, property) =>\r\n    hasOwnProperty.call(target, property))(Object.prototype.hasOwnProperty);\r\n","let index = 0;\r\nexport default () => `ID/${++index}/${Date.now()}`;\r\n","export default 'resource::data';\r\n","export default Symbol('resource::internals');\r\n","/**\r\n * Created by Oleg Galaburda on 16.11.17.\r\n */\r\n\r\nimport RESOURCE_INTERNALS_KEY from './RESOURCE_INTERNALS_KEY';\r\n\r\nexport default (target) => target[RESOURCE_INTERNALS_KEY];\r\n\r\n","import RAW_RESOURCE_DATA_KEY from './utils/RAW_RESOURCE_DATA_KEY';\r\nimport RESOURCE_INTERNALS_KEY from './utils/RESOURCE_INTERNALS_KEY';\r\nimport getInternals from './utils/getInternals';\r\nimport generateId from './utils/generateId';\r\n\r\nconst getPoolId = (pool) => (pool ? pool.id : null);\r\n\r\n/**\r\n * @exports Resource\r\n */\r\nclass Resource {\r\n  constructor(pool, value, type, id) {\r\n    Object.defineProperties(this, {\r\n      [RESOURCE_INTERNALS_KEY]: {\r\n        value: {\r\n          pool,\r\n          value,\r\n          type,\r\n          id,\r\n          active: true,\r\n          poolId: getPoolId(pool),\r\n        },\r\n      },\r\n      [RAW_RESOURCE_DATA_KEY]: {\r\n        get: this.toJSON,\r\n      },\r\n    });\r\n  }\r\n\r\n\r\n  get active() {\r\n    return Boolean(getInternals(this).active);\r\n  }\r\n\r\n  get value() {\r\n    return getInternals(this).value;\r\n  }\r\n\r\n  get type() {\r\n    return getInternals(this).type || typeof getInternals(this).value;\r\n  }\r\n\r\n  get id() {\r\n    return getInternals(this).id;\r\n  }\r\n\r\n  get poolId() {\r\n    return getInternals(this).poolId;\r\n  }\r\n\r\n  toJSON = () => ({\r\n    [RAW_RESOURCE_DATA_KEY]: {\r\n      $id: this.id,\r\n      $type: this.type,\r\n      $poolId: this.poolId,\r\n    },\r\n  });\r\n\r\n  destroy() {\r\n    const internals = getInternals(this);\r\n    const { id, pool } = internals;\r\n\r\n    if (!internals.active) {\r\n      return;\r\n    }\r\n\r\n    internals.active = false;\r\n    pool.remove(id);\r\n\r\n    Object.keys(internals).map((name) => delete internals[name]);\r\n  }\r\n}\r\n\r\nexport default Resource;\r\n","import RAW_RESOURCE_DATA_KEY from '../utils/RAW_RESOURCE_DATA_KEY';\r\nimport Resource from '../Resource';\r\n\r\nexport default (object) => {\r\n  if (!object) return false;\r\n\r\n  if (\r\n    object instanceof Resource\r\n    // this case for RAW resources passed via JSON conversion,\r\n    // look like {'resource::data': {$id: '1111', $poolId: '22222'}}\r\n    // (object[RAW_RESOURCE_DATA_KEY] && typeof object[RAW_RESOURCE_DATA_KEY] === 'object')\r\n    || object[RAW_RESOURCE_DATA_KEY]\r\n  ) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n","import generateId from './utils/generateId';\r\nimport Resource from './Resource';\r\n\r\nexport default (pool, value, resourceType, id = null) => (\r\n  new Resource(pool, value, resourceType, id || generateId())\r\n);\r\n","import EventDispatcher from '@actualwave/event-dispatcher';\r\nimport generateId from './utils/generateId';\r\nimport isResource from './resource/isResource';\r\nimport createResource from './createResource';\r\n\r\nlet validTargets = {};\r\n\r\nexport const isValidTarget = (target) => (\r\n  !isResource(target)\r\n  && Boolean(validTargets[typeof target])\r\n);\r\n\r\nexport const setValidTargets = (list) => {\r\n  validTargets = list.reduce((targets, target) => {\r\n    targets[target] = true;\r\n\r\n    return targets;\r\n  }, {});\r\n};\r\n\r\nexport const getDefaultValidTargets = () => ['object', 'function'];\r\n\r\nclass ResourcePool extends EventDispatcher {\r\n  static RESOURCE_ADDED = 'resourceAdded';\r\n  static RESOURCE_REMOVED = 'resourceRemoved';\r\n  static POOL_CLEAR = 'poolClear';\r\n  static POOL_CLEARED = 'poolCleared';\r\n  static POOL_DESTROYED = 'poolDestroyed';\r\n\r\n  resources = new Map();\r\n\r\n  constructor() {\r\n    super();\r\n    Object.defineProperties(this, {\r\n      id: {\r\n        value: generateId(),\r\n      },\r\n    });\r\n  }\r\n\r\n  set(value, type = null) {\r\n    const map = this.resources;\r\n    let resource = null;\r\n\r\n    if (!isValidTarget(value)) {\r\n      return null;\r\n    }\r\n\r\n    if (map.has(value)) {\r\n      resource = map.get(value);\r\n    } else {\r\n      resource = createResource(this, value, type || typeof value);\r\n      map.set(resource.id, resource);\r\n      map.set(value, resource);\r\n      if (this.hasEventListener(ResourcePool.RESOURCE_ADDED)) {\r\n        this.dispatchEvent(ResourcePool.RESOURCE_ADDED, resource);\r\n      }\r\n    }\r\n\r\n    return resource;\r\n  }\r\n\r\n  has(target) {\r\n    return this.resources.has(target);\r\n  }\r\n\r\n  get(target) {\r\n    return this.resources.get(target);\r\n  }\r\n\r\n  remove(value) {\r\n    const map = this.resources;\r\n    const resource = map.get(value);\r\n    if (resource) {\r\n      map.delete(resource.id);\r\n      map.delete(resource.value);\r\n\r\n      if (this.hasEventListener(ResourcePool.RESOURCE_REMOVED)) {\r\n        this.dispatchEvent(ResourcePool.RESOURCE_REMOVED, resource);\r\n      }\r\n\r\n      resource.destroy();\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    const map = this.resources;\r\n\r\n    if (this.hasEventListener(ResourcePool.POOL_CLEAR)) {\r\n      this.dispatchEvent(ResourcePool.POOL_CLEAR, this);\r\n    }\r\n\r\n    for (const [key, resource] of map) {\r\n      if (typeof key === 'string' && key === resource.id) {\r\n        resource.destroy();\r\n      }\r\n    }\r\n\r\n    map.clear();\r\n\r\n    if (this.hasEventListener(ResourcePool.POOL_CLEARED)) {\r\n      this.dispatchEvent(ResourcePool.POOL_CLEARED, this);\r\n    }\r\n  }\r\n\r\n  isActive() {\r\n    return Boolean(this.resources);\r\n  }\r\n\r\n  destroy() {\r\n    this.clear();\r\n    // intentionally make it not usable after its destroyed\r\n    delete this.resources;\r\n    if (this.hasEventListener(ResourcePool.POOL_DESTROYED)) {\r\n      this.dispatchEvent(ResourcePool.POOL_DESTROYED, this);\r\n    }\r\n  }\r\n}\r\n\r\nexport default ResourcePool;\r\n","import ResourcePool from './ResourcePool';\r\n\r\nexport default () => new ResourcePool();\r\n","import ResourcePool from './ResourcePool';\r\n\r\nclass DefaultResourcePool extends ResourcePool {\r\n  // INFO default ResourcePool should not be destroyable;\r\n  destroy() {\r\n    throw new Error('Default ResourcePool cannot be destroyed.');\r\n  }\r\n}\r\n\r\nexport default new DefaultResourcePool();\r\n","import EventDispatcher from '@actualwave/event-dispatcher';\r\nimport hasOwnProperty from './utils/hasOwnProperty';\r\nimport createResourcePool from './createResourcePool';\r\nimport defaultResourcePool from './defaultResourcePool';\r\nimport ResourcePool from './ResourcePool';\r\n\r\nconst POOLS_FIELD = Symbol('resource.pool.registry::pools');\r\n\r\n/**\r\n * @classdesc Collection of ResourcePool instances. Allows lookup for ResourcePool by its Id.\r\n * When ResourcePool is registered in PoolRegistry, it subscribes to\r\n * ResourcePool POOL_DESTROYED event and removes pool from registry after its destroyed.\r\n */\r\nclass PoolRegistry extends EventDispatcher {\r\n  static RESOURCE_POOL_CREATED = 'resourcePoolCreated';\r\n  static RESOURCE_POOL_REGISTERED = 'resourcePoolRegistered';\r\n  static RESOURCE_POOL_REMOVED = 'resourcePoolRemoved';\r\n  constructor() {\r\n    super();\r\n    this[POOLS_FIELD] = {};\r\n\r\n    // every registry should keep default pool, so you can have access from anywhere\r\n    this.register(defaultResourcePool);\r\n  }\r\n\r\n  handlePoolDestroyed = (event) => {\r\n    this.remove(event.data);\r\n  }\r\n\r\n  /**\r\n   * Create and register ResourcePool\r\n   * @returns {ResourcePool} New ResourcePool instance\r\n   */\r\n  createPool() {\r\n    const pool = createResourcePool();\r\n    if (this.hasEventListener(PoolRegistry.RESOURCE_POOL_CREATED)) {\r\n      this.dispatchEvent(PoolRegistry.RESOURCE_POOL_CREATED, pool);\r\n    }\r\n    this.register(pool);\r\n    return pool;\r\n  }\r\n\r\n  /**\r\n   * Register ResourcePool instance.\r\n   * @param pool {ResourcePool} ResourcePool instance to be registered\r\n   */\r\n  register(pool) {\r\n    if (hasOwnProperty(this[POOLS_FIELD], pool.id)) return;\r\n    this[POOLS_FIELD][pool.id] = pool;\r\n    pool.addEventListener(ResourcePool.POOL_DESTROYED, this.handlePoolDestroyed);\r\n    if (this.hasEventListener(PoolRegistry.RESOURCE_POOL_REGISTERED)) {\r\n      this.dispatchEvent(PoolRegistry.RESOURCE_POOL_REGISTERED, pool);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieve ResourcePool instance from registry by its Id.\r\n   * @param poolId {String} ResourcePool instance Id\r\n   * @returns {ResourcePool|null}\r\n   */\r\n  get(poolId) {\r\n    return this[POOLS_FIELD][poolId] || null;\r\n  }\r\n\r\n  /**\r\n   * Check if ResourcePool registered in this registry instance.\r\n   * @param pool {ResourcePool|String} ResourcePool instance or its Id.\r\n   * @returns {Boolean}\r\n   */\r\n  isRegistered(pool) {\r\n    return hasOwnProperty(\r\n      this[POOLS_FIELD],\r\n      pool instanceof ResourcePool ? pool.id : String(pool),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove ResourcePool from current registry instance.\r\n   * @param pool {ResourcePool|String} ResourcePool instance or its Id.\r\n   * @returns {Boolean}\r\n   */\r\n  remove(pool) {\r\n    let result = false;\r\n    pool = pool instanceof ResourcePool ? pool : this.get(pool);\r\n    if (pool) {\r\n      pool.removeEventListener(ResourcePool.POOL_DESTROYED, this.handlePoolDestroyed);\r\n      result = delete this[POOLS_FIELD][pool.id];\r\n    }\r\n    if (this.hasEventListener(PoolRegistry.RESOURCE_POOL_REMOVED)) {\r\n      this.dispatchEvent(PoolRegistry.RESOURCE_POOL_REMOVED, pool);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\nexport default PoolRegistry;\r\n","import PoolRegistry from './PoolRegistry';\r\n\r\nexport default () => new PoolRegistry();\r\n","import PoolRegistry from './PoolRegistry';\nimport ResourcePool, { getDefaultValidTargets, setValidTargets } from './ResourcePool';\nimport Resource from './Resource';\nimport createResource from './createResource';\nimport createResourcePool from './createResourcePool';\nimport createPoolRegistry from './createPoolRegistry';\nimport defaultResourcePool from './defaultResourcePool';\n\nsetValidTargets(getDefaultValidTargets());\n\nexport {\n  Resource,\n  PoolRegistry,\n  ResourcePool,\n  createResource,\n  createResourcePool,\n  createPoolRegistry,\n  getDefaultValidTargets,\n  setValidTargets,\n  defaultResourcePool,\n};\n"],"names":["this","hasOwnProperty","target","property","call","Object","prototype","index","Date","now","Symbol","RESOURCE_INTERNALS_KEY","getPoolId","pool","id","Resource","value","type","toJSON","RAW_RESOURCE_DATA_KEY","poolId","defineProperties","active","Boolean","getInternals","internals","remove","keys","map","name","object","resourceType","generateId","validTargets","isValidTarget","isResource","setValidTargets","list","reduce","targets","getDefaultValidTargets","ResourcePool","EventDispatcher","resources","Map","resource","has","get","createResource","set","hasEventListener","RESOURCE_ADDED","dispatchEvent","delete","RESOURCE_REMOVED","destroy","POOL_CLEAR","key","clear","POOL_CLEARED","POOL_DESTROYED","DefaultResourcePool","Error","POOLS_FIELD","PoolRegistry","handlePoolDestroyed","event","data","register","defaultResourcePool","createResourcePool","RESOURCE_POOL_CREATED","addEventListener","RESOURCE_POOL_REGISTERED","String","result","removeEventListener","RESOURCE_POOL_REMOVED"],"mappings":"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"}