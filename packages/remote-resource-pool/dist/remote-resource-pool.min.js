!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.RemoteResourcePool={})}(this,function(e){"use strict";"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t,n,r=(function(e,t){var n;n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="http://localhost:8081/dist/",n(n.s=0)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Event=void 0;var r,i=n(1),s=(r=i)&&r.__esModule?r:{default:r};t.default=s.default,t.Event=i.Event},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a=t.Event=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;s(this,e),this.type=t,this.data=n,this.defaultPrevented=!1}return i(e,[{key:"toJSON",value:function(){return{type:this.type,data:this.data}}},{key:"isDefaultPrevented",value:function(){return this.defaultPrevented}},{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),e}(),u=function(){function e(t,n,r){var i=this;s(this,e),this.index=-1,this.immediatelyStopped=!1,this.stopImmediatePropagation=function(){i.immediatelyStopped=!0},this.listeners=t,this.onStopped=n,this.onComplete=r}return i(e,[{key:"run",value:function(e,t){var n=this.listeners;for(this.augmentEvent(e),this.index=0;this.index<n.length&&!this.immediatelyStopped;this.index++)n[this.index].call(t,e);this.clearEvent(e),this.onComplete(this)}},{key:"augmentEvent",value:function(e){var t=e;t.stopPropagation=this.onStopped,t.stopImmediatePropagation=this.stopImmediatePropagation}},{key:"clearEvent",value:function(e){var t=e;delete t.stopPropagation,delete t.stopImmediatePropagation}},{key:"listenerRemoved",value:function(e,t){e===this.listeners&&t<=this.index&&this.index--}}]),e}(),l=function(){function e(){var t=this;s(this,e),this._listeners={},this._runners=[],this.removeRunner=function(e){t._runners.splice(t._runners.indexOf(e),1)}}return i(e,[{key:"createList",value:function(e,t){var n=parseInt(t,10),r=this.getPrioritiesByKey(e),i=String(n),s=void 0;return o(r,i)?s=r[i]:(s=[],r[i]=s),s}},{key:"getPrioritiesByKey",value:function(e){var t=void 0;return o(this._listeners,e)?t=this._listeners[e]:(t={},this._listeners[e]=t),t}},{key:"add",value:function(e,t,n){var r=this.createList(e,n);r.indexOf(t)<0&&r.push(t)}},{key:"has",value:function(e){var t=void 0,n=!1,r=this.getPrioritiesByKey(e);if(r)for(t in r)if(o(r,t)){n=!0;break}return n}},{key:"remove",value:function(e,t){var n=this,r=this.getPrioritiesByKey(e);if(r)for(var i=Object.getOwnPropertyNames(r),s=i.length,o=function(e){var s=i[e],o=r[s],a=o.indexOf(t);a>=0&&(o.splice(a,1),o.length||delete r[s],n._runners.forEach(function(e){e.listenerRemoved(o,a)}))},a=0;a<s;a++)o(a)}},{key:"removeAll",value:function(e){delete this._listeners[e]}},{key:"createRunner",value:function(e,t){var n=new u(e,t,this.removeRunner);return this._runners.push(n),n}},{key:"call",value:function(e,t){var n=this.getPrioritiesByKey(e.type),r=!1,i=function(){r=!0};if(n)for(var s=Object.getOwnPropertyNames(n).sort(function(e,t){return e-t}),o=s.length,a=0;a<o&&!r;a++){var u=n[s[a]];if(u){var l=this.createRunner(u,i);if(l.run(e,t),l.immediatelyStopped)break}}}}]),e}(),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s(this,e),n||this.initialize(t)}return i(e,[{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._eventPreprocessor=e,this._listeners=new l}},{key:"addEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._listeners.add(e,t,-n||0)}},{key:"hasEventListener",value:function(e){return this._listeners.has(e)}},{key:"removeEventListener",value:function(e,t){this._listeners.remove(e,t)}},{key:"removeAllEventListeners",value:function(e){this._listeners.removeAll(e)}},{key:"dispatchEvent",value:function(t,n){var r=e.getEvent(t,n);this._eventPreprocessor&&(r=this._eventPreprocessor.call(this,r)),this._listeners.call(r)}}],[{key:"isObject",value:function(e){return"object"===(void 0===e?"undefined":r(e))&&null!==e}},{key:"getEvent",value:function(t,n){var r=t;return e.isObject(t)||(r=new e.Event(String(t),n)),r}},{key:"create",value:function(t){return new e(t)}}]),e}();c.Event=a,t.default=c}])},e.exports=n()}(t={exports:{}},t.exports),t.exports),i=(n=r)&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,s=(e=>(t,n)=>e.call(t,n))(Object.prototype.hasOwnProperty);let o=0;var a=()=>`ID/${++o}/${Date.now()}`,u="resource::data",l=Symbol("resource::internals"),c=e=>e[l];const h=e=>e?e.id:null;class d{constructor(e,t,n,r){this.toJSON=(()=>({[u]:{$id:this.id,$type:this.type,$poolId:this.poolId}})),Object.defineProperties(this,{[l]:{value:{pool:e,value:t,type:n,id:r,active:!0,poolId:h(e)}},[u]:{get:this.toJSON}})}get active(){return Boolean(c(this).active)}get value(){return c(this).value}get type(){return c(this).type||typeof c(this).value}get id(){return c(this).id}get poolId(){return c(this).poolId}destroy(){const e=c(this),{id:t,pool:n}=e;e.active&&(e.active=!1,n.remove(t),Object.keys(e).map(t=>delete e[t]))}}var v=(e,t,n,r=null)=>new d(e,t,n,r||a());let f={};const p=e=>!(e=>!!e&&!!(e instanceof d||e[u]))(e)&&Boolean(f[typeof e]),E=e=>{f=e.reduce((e,t)=>(e[t]=!0,e),{})},y=()=>["object","function"];class O extends i{constructor(){super(),this.resources=new Map,Object.defineProperties(this,{id:{value:a()}})}set(e,t=null){const n=this.resources;let r=null;return p(e)?(n.has(e)?r=n.get(e):(r=v(this,e,t||typeof e),n.set(r.id,r),n.set(e,r),this.hasEventListener(O.RESOURCE_ADDED)&&this.dispatchEvent(O.RESOURCE_ADDED,r)),r):null}has(e){return this.resources.has(e)}get(e){return this.resources.get(e)}remove(e){const t=this.resources,n=t.get(e);n&&(t.delete(n.id),t.delete(n.value),this.hasEventListener(O.RESOURCE_REMOVED)&&this.dispatchEvent(O.RESOURCE_REMOVED,n),n.destroy())}clear(){const e=this.resources;this.hasEventListener(O.POOL_CLEAR)&&this.dispatchEvent(O.POOL_CLEAR,this);for(const[t,n]of e)"string"==typeof t&&t===n.id&&n.destroy();e.clear(),this.hasEventListener(O.POOL_CLEARED)&&this.dispatchEvent(O.POOL_CLEARED,this)}isActive(){return Boolean(this.resources)}destroy(){this.clear(),delete this.resources,this.hasEventListener(O.POOL_DESTROYED)&&this.dispatchEvent(O.POOL_DESTROYED,this)}}O.RESOURCE_ADDED="resourceAdded",O.RESOURCE_REMOVED="resourceRemoved",O.POOL_CLEAR="poolClear",O.POOL_CLEARED="poolCleared",O.POOL_DESTROYED="poolDestroyed";var R=()=>new O;var _=new class extends O{destroy(){throw new Error("Default ResourcePool cannot be destroyed.")}};const P=Symbol("resource.pool.registry::pools");class g extends i{constructor(){super(),this.handlePoolDestroyed=(e=>{this.remove(e.data)}),this[P]={},this.register(_)}createPool(){const e=R();return this.hasEventListener(g.RESOURCE_POOL_CREATED)&&this.dispatchEvent(g.RESOURCE_POOL_CREATED,e),this.register(e),e}register(e){s(this[P],e.id)||(this[P][e.id]=e,e.addEventListener(O.POOL_DESTROYED,this.handlePoolDestroyed),this.hasEventListener(g.RESOURCE_POOL_REGISTERED)&&this.dispatchEvent(g.RESOURCE_POOL_REGISTERED,e))}get(e){return this[P][e]||null}isRegistered(e){return s(this[P],e instanceof O?e.id:String(e))}remove(e){let t=!1;return(e=e instanceof O?e:this.get(e))&&(e.removeEventListener(O.POOL_DESTROYED,this.handlePoolDestroyed),t=delete this[P][e.id]),this.hasEventListener(g.RESOURCE_POOL_REMOVED)&&this.dispatchEvent(g.RESOURCE_POOL_REMOVED,e),t}}g.RESOURCE_POOL_CREATED="resourcePoolCreated",g.RESOURCE_POOL_REGISTERED="resourcePoolRegistered",g.RESOURCE_POOL_REMOVED="resourcePoolRemoved";E(["object","function"]),e.Resource=d,e.PoolRegistry=g,e.ResourcePool=O,e.createResource=v,e.createResourcePool=R,e.createPoolRegistry=(()=>new g),e.getDefaultValidTargets=y,e.setValidTargets=E,e.defaultResourcePool=_,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=remote-resource-pool.min.js.map
