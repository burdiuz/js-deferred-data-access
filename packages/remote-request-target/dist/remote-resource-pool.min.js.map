{"version":3,"file":"remote-resource-pool.min.js","sources":["../node_modules/@actualwave/event-dispatcher/dist/event-dispatcher.js","../source/utils/hasOwnProperty.js","../source/utils/generateId.js","../source/utils/RAW_RESOURCE_DATA_KEY.js","../source/utils/RESOURCE_INTERNALS_KEY.js","../source/utils/getInternals.js","../source/Resource.js","../source/createResource.js","../source/ResourcePool.js","../source/resource/isResource.js","../source/createResourcePool.js","../source/defaultResourcePool.js","../source/PoolRegistry.js","../source/createPoolRegistry.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"EventDispatcher\"] = factory();\n\telse\n\t\troot[\"EventDispatcher\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"http://localhost:8081/dist/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Event = undefined;\n\nvar _EventDispatcher = __webpack_require__(1);\n\nvar _EventDispatcher2 = _interopRequireDefault(_EventDispatcher);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = _EventDispatcher2.default;\nexports.Event = _EventDispatcher.Event;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar hasOwnProp = function hasOwnProp(target, name) {\n  return Object.prototype.hasOwnProperty.call(target, name);\n}; /**\r\n    * Created by Oleg Galaburda on 09.02.16.\r\n    * \r\n    */\n\nvar Event = exports.Event = function () {\n  function Event(type) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n    _classCallCheck(this, Event);\n\n    this.type = type;\n    this.data = data;\n    this.defaultPrevented = false;\n  }\n\n  _createClass(Event, [{\n    key: 'toJSON',\n    value: function toJSON() {\n      return { type: this.type, data: this.data };\n    }\n  }, {\n    key: 'isDefaultPrevented',\n    value: function isDefaultPrevented() {\n      return this.defaultPrevented;\n    }\n  }, {\n    key: 'preventDefault',\n    value: function preventDefault() {\n      this.defaultPrevented = true;\n    }\n  }]);\n\n  return Event;\n}();\n\nvar ListenersRunner = function () {\n  function ListenersRunner(listeners, onStopped, onComplete) {\n    var _this = this;\n\n    _classCallCheck(this, ListenersRunner);\n\n    this.index = -1;\n    this.immediatelyStopped = false;\n\n    this.stopImmediatePropagation = function () {\n      _this.immediatelyStopped = true;\n    };\n\n    this.listeners = listeners;\n    this.onStopped = onStopped;\n    this.onComplete = onComplete;\n  }\n\n  _createClass(ListenersRunner, [{\n    key: 'run',\n    value: function run(event, target) {\n      var listener = void 0;\n      var listeners = this.listeners;\n\n      this.augmentEvent(event);\n      // TODO this has to be handled in separate object ListenersRunner that should be\n      // created for each call() call and asked for index validation on each listener remove.\n      for (this.index = 0; this.index < listeners.length; this.index++) {\n        if (this.immediatelyStopped) break;\n        listener = listeners[this.index];\n        listener.call(target, event);\n      }\n      this.clearEvent(event);\n      this.onComplete(this);\n    }\n  }, {\n    key: 'augmentEvent',\n    value: function augmentEvent(eventObject) {\n      var event = eventObject;\n      event.stopPropagation = this.onStopped;\n      event.stopImmediatePropagation = this.stopImmediatePropagation;\n    }\n\n    /* eslint class-methods-use-this: \"off\" */\n\n  }, {\n    key: 'clearEvent',\n    value: function clearEvent(eventObject) {\n      var event = eventObject;\n      delete event.stopPropagation;\n      delete event.stopImmediatePropagation;\n    }\n  }, {\n    key: 'listenerRemoved',\n    value: function listenerRemoved(listeners, index) {\n      if (listeners === this.listeners && index <= this.index) {\n        this.index--;\n      }\n    }\n  }]);\n\n  return ListenersRunner;\n}();\n\nvar EventListeners = function () {\n  function EventListeners() {\n    var _this2 = this;\n\n    _classCallCheck(this, EventListeners);\n\n    this._listeners = {};\n    this._runners = [];\n\n    this.removeRunner = function (runner) {\n      _this2._runners.splice(_this2._runners.indexOf(runner), 1);\n    };\n  }\n  /**\r\n   * key - event Type\r\n   * value - hash of priorities\r\n   *    key - priority\r\n   *    value - list of handlers\r\n   * @type {Object<string, Object.<string, Array<number, Function>>>}\r\n   * @private\r\n   */\n\n\n  _createClass(EventListeners, [{\n    key: 'createList',\n    value: function createList(eventType, priorityOpt) {\n      var priority = parseInt(priorityOpt, 10);\n      var target = this.getPrioritiesByKey(eventType);\n      var key = String(priority);\n      var value = void 0;\n      if (hasOwnProp(target, key)) {\n        value = target[key];\n      } else {\n        value = [];\n        target[key] = value;\n      }\n      return value;\n    }\n  }, {\n    key: 'getPrioritiesByKey',\n    value: function getPrioritiesByKey(key) {\n      var value = void 0;\n      if (hasOwnProp(this._listeners, key)) {\n        value = this._listeners[key];\n      } else {\n        value = {};\n        this._listeners[key] = value;\n      }\n      return value;\n    }\n  }, {\n    key: 'add',\n    value: function add(eventType, handler, priority) {\n      var handlers = this.createList(eventType, priority);\n      if (handlers.indexOf(handler) < 0) {\n        handlers.push(handler);\n      }\n    }\n  }, {\n    key: 'has',\n    value: function has(eventType) {\n      var priority = void 0;\n      var result = false;\n      var priorities = this.getPrioritiesByKey(eventType);\n      if (priorities) {\n        for (priority in priorities) {\n          if (hasOwnProp(priorities, priority)) {\n            result = true;\n            break;\n          }\n        }\n      }\n      return result;\n    }\n  }, {\n    key: 'remove',\n    value: function remove(eventType, handler) {\n      var _this3 = this;\n\n      var priorities = this.getPrioritiesByKey(eventType);\n      if (priorities) {\n        var list = Object.getOwnPropertyNames(priorities);\n        var length = list.length;\n\n        var _loop = function _loop(index) {\n          var priority = list[index];\n          var handlers = priorities[priority];\n          var handlerIndex = handlers.indexOf(handler);\n          if (handlerIndex >= 0) {\n            handlers.splice(handlerIndex, 1);\n            if (!handlers.length) {\n              delete priorities[priority];\n            }\n            _this3._runners.forEach(function (runner) {\n              runner.listenerRemoved(handlers, handlerIndex);\n            });\n          }\n        };\n\n        for (var index = 0; index < length; index++) {\n          _loop(index);\n        }\n      }\n    }\n  }, {\n    key: 'removeAll',\n    value: function removeAll(eventType) {\n      delete this._listeners[eventType];\n    }\n  }, {\n    key: 'createRunner',\n    value: function createRunner(handlers, onStopped) {\n      var runner = new ListenersRunner(handlers, onStopped, this.removeRunner);\n      this._runners.push(runner);\n      return runner;\n    }\n  }, {\n    key: 'call',\n    value: function call(event, target) {\n      var priorities = this.getPrioritiesByKey(event.type);\n      var stopped = false;\n      var stopPropagation = function stopPropagation() {\n        stopped = true;\n      };\n      if (priorities) {\n        // getOwnPropertyNames() or keys()?\n        var list = Object.getOwnPropertyNames(priorities).sort(function (a, b) {\n          return a - b;\n        });\n        var length = list.length;\n\n        for (var index = 0; index < length; index++) {\n          if (stopped) break;\n          var _handlers = priorities[list[index]];\n          // in case if all handlers of priority were removed while event\n          // was dispatched and handlers become undefined.\n          if (_handlers) {\n            var _runner = this.createRunner(_handlers, stopPropagation);\n            _runner.run(event, target);\n            if (_runner.immediatelyStopped) break;\n          }\n        }\n      }\n    }\n  }]);\n\n  return EventListeners;\n}();\n\nvar EventDispatcher = function () {\n  function EventDispatcher() {\n    var eventPreprocessor = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    var noInit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    _classCallCheck(this, EventDispatcher);\n\n    if (!noInit) {\n      this.initialize(eventPreprocessor);\n    }\n  }\n\n  /**\r\n   * @private\r\n   */\n\n\n  _createClass(EventDispatcher, [{\n    key: 'initialize',\n    value: function initialize() {\n      var eventPreprocessor = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\n      this._eventPreprocessor = eventPreprocessor;\n      this._listeners = new EventListeners();\n    }\n  }, {\n    key: 'addEventListener',\n    value: function addEventListener(eventType, listener) {\n      var priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n      this._listeners.add(eventType, listener, -priority || 0);\n    }\n  }, {\n    key: 'hasEventListener',\n    value: function hasEventListener(eventType) {\n      return this._listeners.has(eventType);\n    }\n  }, {\n    key: 'removeEventListener',\n    value: function removeEventListener(eventType, listener) {\n      this._listeners.remove(eventType, listener);\n    }\n  }, {\n    key: 'removeAllEventListeners',\n    value: function removeAllEventListeners(eventType) {\n      this._listeners.removeAll(eventType);\n    }\n  }, {\n    key: 'dispatchEvent',\n    value: function dispatchEvent(event, data) {\n      var eventObject = EventDispatcher.getEvent(event, data);\n      if (this._eventPreprocessor) {\n        eventObject = this._eventPreprocessor.call(this, eventObject);\n      }\n      this._listeners.call(eventObject);\n    }\n  }], [{\n    key: 'isObject',\n    value: function isObject(value) {\n      return (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' && value !== null;\n    }\n  }, {\n    key: 'getEvent',\n    value: function getEvent(eventOrType, optionalData) {\n      var event = eventOrType;\n      if (!EventDispatcher.isObject(eventOrType)) {\n        event = new EventDispatcher.Event(String(eventOrType), optionalData);\n      }\n      return event;\n    }\n  }, {\n    key: 'create',\n    value: function create(eventPreprocessor) {\n      return new EventDispatcher(eventPreprocessor);\n    }\n\n    /* eslint no-undef: \"off\" */\n\n  }]);\n\n  return EventDispatcher;\n}();\n\nEventDispatcher.Event = Event;\n\nexports.default = EventDispatcher;\n\n/***/ })\n/******/ ]);\n});\n//# sourceMappingURL=event-dispatcher.js.map","export default ((hasOwnProperty) =>\r\n  (target, property) =>\r\n    hasOwnProperty.call(target, property))(Object.prototype.hasOwnProperty);\r\n","let index = 0;\r\nexport default () => `ID/${++index}/${Date.now()}`;\r\n","export default 'resource::data';\r\n","export default Symbol('resource::internals');\r\n","/**\r\n * Created by Oleg Galaburda on 16.11.17.\r\n */\r\n\r\nimport RESOURCE_INTERNALS_KEY from './RESOURCE_INTERNALS_KEY';\r\n\r\nexport default (target) => target[RESOURCE_INTERNALS_KEY];\r\n\r\n","import RAW_RESOURCE_DATA_KEY from './utils/RAW_RESOURCE_DATA_KEY';\r\nimport RESOURCE_INTERNALS_KEY from './utils/RESOURCE_INTERNALS_KEY';\r\nimport getInternals from './utils/getInternals';\r\nimport generateId from './utils/generateId';\r\n\r\nconst getPoolId = (pool) => (pool ? pool.id : null);\r\n\r\n/**\r\n * @exports Resource\r\n */\r\nclass Resource {\r\n  constructor(pool, value, type, id) {\r\n    Object.defineProperties(this, {\r\n      [RESOURCE_INTERNALS_KEY]: {\r\n        value: {\r\n          pool,\r\n          value,\r\n          type,\r\n          id,\r\n          active: true,\r\n          poolId: getPoolId(pool),\r\n        },\r\n      },\r\n      [RAW_RESOURCE_DATA_KEY]: {\r\n        get: this.toJSON,\r\n      },\r\n    });\r\n  }\r\n\r\n\r\n  get active() {\r\n    return Boolean(getInternals(this).active);\r\n  }\r\n\r\n  get value() {\r\n    return getInternals(this).value;\r\n  }\r\n\r\n  get type() {\r\n    return getInternals(this).type || typeof getInternals(this).value;\r\n  }\r\n\r\n  get id() {\r\n    return getInternals(this).id;\r\n  }\r\n\r\n  get poolId() {\r\n    return getInternals(this).poolId;\r\n  }\r\n\r\n  toJSON = () => ({\r\n    [RAW_RESOURCE_DATA_KEY]: {\r\n      $id: this.id,\r\n      $type: this.type,\r\n      $poolId: this.poolId,\r\n    },\r\n  });\r\n\r\n  destroy() {\r\n    const internals = getInternals(this);\r\n    const { id, pool } = internals;\r\n\r\n    if (!internals.active) {\r\n      return;\r\n    }\r\n\r\n    internals.active = false;\r\n    pool.remove(id);\r\n\r\n    Object.keys(internals).map((name) => delete internals[name]);\r\n  }\r\n}\r\n\r\nexport default Resource;\r\n","import generateId from './utils/generateId';\r\nimport Resource from './Resource';\r\n\r\nexport default (pool, value, resourceType, id = null) => (\r\n  new Resource(pool, value, resourceType, id || generateId())\r\n);\r\n","import EventDispatcher from '@actualwave/event-dispatcher';\r\nimport generateId from './utils/generateId';\r\nimport isResource from './resource/isResource';\r\nimport createResource from './createResource';\r\n\r\nlet validTargets = {};\r\n\r\nexport const isValidTarget = (target) => (\r\n  !isResource(target)\r\n  && Boolean(validTargets[typeof target])\r\n);\r\n\r\nexport const setValidTargets = (list) => {\r\n  validTargets = list.reduce((targets, target) => {\r\n    targets[target] = true;\r\n\r\n    return targets;\r\n  }, {});\r\n};\r\n\r\nexport const getDefaultValidTargets = () => ['object', 'function'];\r\n\r\nclass ResourcePool extends EventDispatcher {\r\n  static RESOURCE_ADDED = 'resourceAdded';\r\n  static RESOURCE_REMOVED = 'resourceRemoved';\r\n  static POOL_CLEAR = 'poolClear';\r\n  static POOL_CLEARED = 'poolCleared';\r\n  static POOL_DESTROYED = 'poolDestroyed';\r\n\r\n  resources = new Map();\r\n\r\n  constructor() {\r\n    super();\r\n    Object.defineProperties(this, {\r\n      id: {\r\n        value: generateId(),\r\n      },\r\n    });\r\n  }\r\n\r\n  set(value, type = null) {\r\n    const map = this.resources;\r\n    let resource = null;\r\n\r\n    if (!isValidTarget(value)) {\r\n      return null;\r\n    }\r\n\r\n    if (map.has(value)) {\r\n      resource = map.get(value);\r\n    } else {\r\n      resource = createResource(this, value, type || typeof value);\r\n      map.set(resource.id, resource);\r\n      map.set(value, resource);\r\n      if (this.hasEventListener(ResourcePool.RESOURCE_ADDED)) {\r\n        this.dispatchEvent(ResourcePool.RESOURCE_ADDED, resource);\r\n      }\r\n    }\r\n\r\n    return resource;\r\n  }\r\n\r\n  has(target) {\r\n    return this.resources.has(target);\r\n  }\r\n\r\n  get(target) {\r\n    return this.resources.get(target);\r\n  }\r\n\r\n  remove(value) {\r\n    const map = this.resources;\r\n    const resource = map.get(value);\r\n    if (resource) {\r\n      map.delete(resource.id);\r\n      map.delete(resource.value);\r\n\r\n      if (this.hasEventListener(ResourcePool.RESOURCE_REMOVED)) {\r\n        this.dispatchEvent(ResourcePool.RESOURCE_REMOVED, resource);\r\n      }\r\n\r\n      resource.destroy();\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    const map = this.resources;\r\n\r\n    if (this.hasEventListener(ResourcePool.POOL_CLEAR)) {\r\n      this.dispatchEvent(ResourcePool.POOL_CLEAR, this);\r\n    }\r\n\r\n    for (const [key, resource] of map) {\r\n      if (typeof key === 'string' && key === resource.id) {\r\n        resource.destroy();\r\n      }\r\n    }\r\n\r\n    map.clear();\r\n\r\n    if (this.hasEventListener(ResourcePool.POOL_CLEARED)) {\r\n      this.dispatchEvent(ResourcePool.POOL_CLEARED, this);\r\n    }\r\n  }\r\n\r\n  isActive() {\r\n    return Boolean(this.resources);\r\n  }\r\n\r\n  destroy() {\r\n    this.clear();\r\n    // intentionally make it not usable after its destroyed\r\n    delete this.resources;\r\n    if (this.hasEventListener(ResourcePool.POOL_DESTROYED)) {\r\n      this.dispatchEvent(ResourcePool.POOL_DESTROYED, this);\r\n    }\r\n  }\r\n}\r\n\r\nexport default ResourcePool;\r\n","import RAW_RESOURCE_DATA_KEY from '../utils/RAW_RESOURCE_DATA_KEY';\r\nimport Resource from '../Resource';\r\n\r\nexport default (object) => {\r\n  if (!object) return false;\r\n\r\n  if (\r\n    object instanceof Resource\r\n    // this case for RAW resources passed via JSON conversion,\r\n    // look like {'resource::data': {$id: '1111', $poolId: '22222'}}\r\n    // (object[RAW_RESOURCE_DATA_KEY] && typeof object[RAW_RESOURCE_DATA_KEY] === 'object')\r\n    || object[RAW_RESOURCE_DATA_KEY]\r\n  ) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n","import ResourcePool from './ResourcePool';\r\n\r\nexport default () => new ResourcePool();\r\n","import ResourcePool from './ResourcePool';\r\n\r\nclass DefaultResourcePool extends ResourcePool {\r\n  // INFO default ResourcePool should not be destroyable;\r\n  destroy() {\r\n    throw new Error('Default ResourcePool cannot be destroyed.');\r\n  }\r\n}\r\n\r\nexport default new DefaultResourcePool();\r\n","import EventDispatcher from '@actualwave/event-dispatcher';\r\nimport hasOwnProperty from './utils/hasOwnProperty';\r\nimport createResourcePool from './createResourcePool';\r\nimport defaultResourcePool from './defaultResourcePool';\r\nimport ResourcePool from './ResourcePool';\r\n\r\nconst POOLS_FIELD = Symbol('resource.pool.registry::pools');\r\n\r\n/**\r\n * @classdesc Collection of ResourcePool instances. Allows lookup for ResourcePool by its Id.\r\n * When ResourcePool is registered in PoolRegistry, it subscribes to\r\n * ResourcePool POOL_DESTROYED event and removes pool from registry after its destroyed.\r\n */\r\nclass PoolRegistry extends EventDispatcher {\r\n  static RESOURCE_POOL_CREATED = 'resourcePoolCreated';\r\n  static RESOURCE_POOL_REGISTERED = 'resourcePoolRegistered';\r\n  static RESOURCE_POOL_REMOVED = 'resourcePoolRemoved';\r\n  constructor() {\r\n    super();\r\n    this[POOLS_FIELD] = {};\r\n\r\n    // every registry should keep default pool, so you can have access from anywhere\r\n    this.register(defaultResourcePool);\r\n  }\r\n\r\n  handlePoolDestroyed = (event) => {\r\n    this.remove(event.data);\r\n  }\r\n\r\n  /**\r\n   * Create and register ResourcePool\r\n   * @returns {ResourcePool} New ResourcePool instance\r\n   */\r\n  createPool() {\r\n    const pool = createResourcePool();\r\n    if (this.hasEventListener(PoolRegistry.RESOURCE_POOL_CREATED)) {\r\n      this.dispatchEvent(PoolRegistry.RESOURCE_POOL_CREATED, pool);\r\n    }\r\n    this.register(pool);\r\n    return pool;\r\n  }\r\n\r\n  /**\r\n   * Register ResourcePool instance.\r\n   * @param pool {ResourcePool} ResourcePool instance to be registered\r\n   */\r\n  register(pool) {\r\n    if (hasOwnProperty(this[POOLS_FIELD], pool.id)) return;\r\n    this[POOLS_FIELD][pool.id] = pool;\r\n    pool.addEventListener(ResourcePool.POOL_DESTROYED, this.handlePoolDestroyed);\r\n    if (this.hasEventListener(PoolRegistry.RESOURCE_POOL_REGISTERED)) {\r\n      this.dispatchEvent(PoolRegistry.RESOURCE_POOL_REGISTERED, pool);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieve ResourcePool instance from registry by its Id.\r\n   * @param poolId {String} ResourcePool instance Id\r\n   * @returns {ResourcePool|null}\r\n   */\r\n  get(poolId) {\r\n    return this[POOLS_FIELD][poolId] || null;\r\n  }\r\n\r\n  /**\r\n   * Check if ResourcePool registered in this registry instance.\r\n   * @param pool {ResourcePool|String} ResourcePool instance or its Id.\r\n   * @returns {Boolean}\r\n   */\r\n  isRegistered(pool) {\r\n    return hasOwnProperty(\r\n      this[POOLS_FIELD],\r\n      pool instanceof ResourcePool ? pool.id : String(pool),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove ResourcePool from current registry instance.\r\n   * @param pool {ResourcePool|String} ResourcePool instance or its Id.\r\n   * @returns {Boolean}\r\n   */\r\n  remove(pool) {\r\n    let result = false;\r\n    pool = pool instanceof ResourcePool ? pool : this.get(pool);\r\n    if (pool) {\r\n      pool.removeEventListener(ResourcePool.POOL_DESTROYED, this.handlePoolDestroyed);\r\n      result = delete this[POOLS_FIELD][pool.id];\r\n    }\r\n    if (this.hasEventListener(PoolRegistry.RESOURCE_POOL_REMOVED)) {\r\n      this.dispatchEvent(PoolRegistry.RESOURCE_POOL_REMOVED, pool);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\nexport default PoolRegistry;\r\n","import PoolRegistry from './PoolRegistry';\r\n\r\nexport default () => new PoolRegistry();\r\n"],"names":["factory","modules","installedModules","__webpack_require__","moduleId","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","value","Event","undefined","obj","_EventDispatcher","_EventDispatcher2","default","_typeof","Symbol","iterator","constructor","_createClass","defineProperties","target","props","length","descriptor","writable","key","Constructor","protoProps","staticProps","_classCallCheck","instance","TypeError","hasOwnProp","type","data","arguments","this","defaultPrevented","ListenersRunner","listeners","onStopped","onComplete","_this","index","immediatelyStopped","stopImmediatePropagation","event","augmentEvent","clearEvent","eventObject","stopPropagation","EventListeners","_this2","_listeners","_runners","removeRunner","runner","splice","indexOf","eventType","priorityOpt","priority","parseInt","getPrioritiesByKey","String","handler","handlers","createList","push","result","priorities","_this3","list","getOwnPropertyNames","_loop","handlerIndex","forEach","listenerRemoved","stopped","sort","a","b","_handlers","_runner","createRunner","run","EventDispatcher","eventPreprocessor","noInit","initialize","_eventPreprocessor","listener","add","has","remove","removeAll","getEvent","eventOrType","optionalData","isObject","Date","now","RESOURCE_INTERNALS_KEY","Resource","pool","id","toJSON","RAW_RESOURCE_DATA_KEY","poolId","getPoolId","Boolean","getInternals","active","internals","keys","map","resourceType","generateId","isValidTarget","isResource","validTargets","setValidTargets","reduce","targets","getDefaultValidTargets","ResourcePool","resources","Map","resource","createResource","set","hasEventListener","RESOURCE_ADDED","dispatchEvent","delete","RESOURCE_REMOVED","destroy","POOL_CLEAR","clear","POOL_CLEARED","POOL_DESTROYED","Error","PoolRegistry","handlePoolDestroyed","POOLS_FIELD","register","defaultResourcePool","createResourcePool","RESOURCE_POOL_CREATED","addEventListener","RESOURCE_POOL_REGISTERED","removeEventListener","RESOURCE_POOL_REMOVED"],"mappings":"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"}