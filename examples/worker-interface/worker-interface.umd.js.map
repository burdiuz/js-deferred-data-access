{"version":3,"file":"worker-interface.umd.js","sources":["../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/utils/src/utils.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/command/src/command.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/command/src/command-chain.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/proxy/src/command.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/proxy/src/types.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/proxy/src/proxy.js","../../../node_modules/@actualwave/has-own/index.es.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/proxy/src/utils.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/proxy/src/traps.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/core/core.js","../../../node_modules/@actualwave/weak-storage/index.es.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/resource/src/resource.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/resource/src/utils.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/resource/src/resource-pool.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/resource/src/default-resource-pool.js","../../../packages/worker-interface/node_modules/@actualwave/deferred-data-access/resource/src/resource-pool-registry.js","../../../../../packages/worker-interface/src/utils.ts","../../../../../packages/worker-interface/src/handshake.ts","../../../../../packages/worker-interface/src/request.ts","../../../../../packages/worker-interface/src/worker-interface.ts"],"sourcesContent":["const DATE_NOW = Date.now() - Math.floor(Math.random() * 1000);\r\nlet index = 0;\r\nexport var ReservedPropertyNames;\r\n(function (ReservedPropertyNames) {\r\n    ReservedPropertyNames[\"THEN\"] = \"then\";\r\n    ReservedPropertyNames[\"CATCH\"] = \"catch\";\r\n})(ReservedPropertyNames || (ReservedPropertyNames = {}));\r\nexport const isReservedPropertyName = (name) => name === ReservedPropertyNames.THEN || name === ReservedPropertyNames.CATCH;\r\nexport const reject = async (message) => {\r\n    throw message;\r\n};\r\nexport const createUIDGenerator = (key = '') => {\r\n    const prefix = `${key ? `${key}/` : ''}${DATE_NOW}/`;\r\n    return () => `${prefix}${++index};`;\r\n};\r\nexport const generateId = createUIDGenerator();\r\nexport class IdOwner {\r\n    constructor(id = generateId()) {\r\n        this.id = id;\r\n    }\r\n}\r\n//# sourceMappingURL=utils.js.map","export class Command {\r\n    constructor(type, name, value, context) {\r\n        this.type = type;\r\n        this.name = name;\r\n        this.value = value;\r\n        this.context = context;\r\n    }\r\n    toObject(includeContext = false) {\r\n        const { type, name, value, context } = this;\r\n        return {\r\n            type,\r\n            name,\r\n            value,\r\n            context: includeContext ? context : undefined,\r\n        };\r\n    }\r\n    toJSON(includeContext = false) {\r\n        const { type, name, value, context } = this;\r\n        return JSON.stringify([\r\n            type,\r\n            name,\r\n            value,\r\n            includeContext ? context : undefined,\r\n        ]);\r\n    }\r\n    static fromJSON(jsonString) {\r\n        const [type, name, value, context] = JSON.parse(jsonString);\r\n        return new Command(type, name, value, context);\r\n    }\r\n}\r\n//# sourceMappingURL=command.js.map","import { Command } from './command';\r\nexport class CommandChain extends Command {\r\n    constructor(prev, type, name, value, context) {\r\n        super(type, name, value, context);\r\n        this.prev = prev;\r\n    }\r\n    *[Symbol.iterator]() {\r\n        let item = this;\r\n        while (item) {\r\n            yield item;\r\n            item = item.prev;\r\n        }\r\n    }\r\n    isTail() {\r\n        return !this.prev;\r\n    }\r\n    forEach(callback) {\r\n        let node = this;\r\n        do {\r\n            callback(node);\r\n            node = node.prev;\r\n        } while (node);\r\n    }\r\n    map(callback) {\r\n        let node = this;\r\n        const list = [];\r\n        do {\r\n            list.push(callback(node));\r\n            node = node.prev;\r\n        } while (node);\r\n        return list;\r\n    }\r\n    reduce(callback, base) {\r\n        let node = this;\r\n        let result = base;\r\n        do {\r\n            result = callback(result, node);\r\n            node = node.prev;\r\n        } while (node);\r\n        return result;\r\n    }\r\n    static fromCommand({ type, name, value, context }, prev) {\r\n        return new CommandChain(prev, type, name, value, context);\r\n    }\r\n}\r\n//# sourceMappingURL=command-chain.js.map","import { CommandChain } from '@actualwave/deferred-data-access/command';\r\nexport var ProxyCommand;\r\n(function (ProxyCommand) {\r\n    ProxyCommand[\"GET\"] = \"P:get\";\r\n    ProxyCommand[\"SET\"] = \"P:set\";\r\n    ProxyCommand[\"APPLY\"] = \"P:apply\";\r\n    ProxyCommand[\"DELETE_PROPERTY\"] = \"P:del\";\r\n    // If proxy works in lazy mode and APPLY command has previous GET command, this will be generated.\r\n    ProxyCommand[\"METHOD_CALL\"] = \"P:call\";\r\n})(ProxyCommand || (ProxyCommand = {}));\r\nexport const generateProxyCommand = (head, type, name, value, context, lazy) => {\r\n    if (type === ProxyCommand.APPLY && lazy && head?.type === ProxyCommand.GET) {\r\n        return new CommandChain(head.prev, ProxyCommand.METHOD_CALL, head.name, value, head.context);\r\n    }\r\n    return new CommandChain(head, type, name, value, context);\r\n};\r\nexport const getMethodName = ({ prev }) => prev?.name;\r\nexport const getMethodCallContext = ({ prev }) => prev?.context;\r\n//# sourceMappingURL=command.js.map","export const EXCLUSIONS = {\r\n    /*\r\n     INFO arguments and caller were included because they are required function properties\r\n     https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/arguments\r\n     */\r\n    arguments: true,\r\n    caller: true,\r\n    prototype: true,\r\n};\r\nexport const API_PROP = Symbol('P:api');\r\n//# sourceMappingURL=types.js.map","import { API_PROP } from './types';\r\nexport const wrapWithProxy = (\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntarget, traps, api = {}) => {\r\n    const wrapper = Object.assign(typeof target === 'function'\r\n        ? function $RequestFn(...args) {\r\n            return target.apply(this, args);\r\n        }\r\n        : function $Request() {\r\n            // because\r\n        }, {\r\n        target,\r\n        [API_PROP]: { getTarget: () => target, ...api },\r\n    });\r\n    return new Proxy(wrapper, traps);\r\n};\r\nexport const isWrappedWithProxy = (obj) => !!(obj && obj[API_PROP]);\r\nexport const unwrapProxy = (obj) => obj && obj[API_PROP] && obj[API_PROP].getTarget() || obj;\r\n//# sourceMappingURL=proxy.js.map","export const hasOwn = (\n  (has) =>\n  (target, property) =>\n  Boolean(target && has.call(target, property))\n)(Object.prototype.hasOwnProperty);\n\nexport default hasOwn;","import { hasOwn } from '@actualwave/has-own';\r\nimport { ProxyCommand, getMethodCallContext } from './command';\r\nimport { API_PROP, EXCLUSIONS } from './types';\r\nexport const isNameExcluded = (name) => name === API_PROP || hasOwn(EXCLUSIONS, name);\r\nexport const isNameSymbol = (name) => typeof name === 'symbol';\r\nexport const followCommandChain = async (head, \r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ncontext) => {\r\n    let target = context;\r\n    if (!context) {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        target = head.prev\r\n            ? await followCommandChain(head.prev)\r\n            : head.context;\r\n    }\r\n    const { type, name, value } = head;\r\n    switch (type) {\r\n        case ProxyCommand.GET:\r\n            return target[name];\r\n        case ProxyCommand.APPLY:\r\n            return target.apply(getMethodCallContext(head), value);\r\n    }\r\n    throw new Error(`Unknown command \"${type}\" cannot be followed, only ProxyCommand.GET and APPLY are allowed.`);\r\n};\r\n//# sourceMappingURL=utils.js.map","import { ProxyCommand } from './command';\r\nimport { EXCLUSIONS } from './types';\r\nimport { isNameExcluded } from './utils';\r\nconst createGetTrap = (handler) => (wrapper, name) => {\r\n    const { target } = wrapper;\r\n    if (isNameExcluded(name)) {\r\n        return wrapper[name];\r\n    }\r\n    // We expect that user of the lib will wrap with Proxy explicitly whatever they want\r\n    return handler(ProxyCommand.GET, name, undefined, target);\r\n};\r\nconst createApplyTrap = (handler) => ({ target }, thisValue, args) => {\r\n    // thisValue is being ignored for now\r\n    // target is a function that should be applied\r\n    return handler(ProxyCommand.APPLY, undefined, args, target);\r\n};\r\nconst createSetTrap = (handler) => ({ target }, name, value) => {\r\n    if (isNameExcluded(name)) {\r\n        return false;\r\n    }\r\n    /* TODO why this might be needed?\r\n    if (isNameSymbol(name)) {\r\n      target.then((context: any) => {\r\n        context[name] = value;\r\n      });\r\n\r\n      return false;\r\n    }\r\n    */\r\n    handler(ProxyCommand.SET, name, value, target);\r\n    return true;\r\n};\r\nconst createDeletePropertyTrap = (handler) => (wrapper, name) => {\r\n    if (isNameExcluded(name)) {\r\n        return false;\r\n    }\r\n    handler(ProxyCommand.DELETE_PROPERTY, name, undefined, wrapper.target);\r\n    return true;\r\n};\r\nconst proxyHasTrap = (wrapper, name) => {\r\n    if (isNameExcluded(name)) {\r\n        return wrapper[name];\r\n    }\r\n    return false;\r\n};\r\nconst proxyOwnKeysTrap = () => Object.getOwnPropertyNames(EXCLUSIONS);\r\n// INFO You cannot enumerate properties of request object, this may possibly require processing a lot of data\r\nconst proxyEnumerateTrap = () => Object.getOwnPropertyNames(EXCLUSIONS)[Symbol.iterator]();\r\nconst proxyGetOwnPropertyDescriptorTrap = (wrapper, name) => {\r\n    if (isNameExcluded(name)) {\r\n        return Object.getOwnPropertyDescriptor(wrapper, name);\r\n    }\r\n    return Object.getOwnPropertyDescriptor(wrapper.target, name);\r\n};\r\nexport const createProxyTrapsObject = (handler) => ({\r\n    get: createGetTrap(handler),\r\n    apply: createApplyTrap(handler),\r\n    set: createSetTrap(handler),\r\n    deleteProperty: createDeletePropertyTrap(handler),\r\n    has: proxyHasTrap,\r\n    ownKeys: proxyOwnKeysTrap,\r\n    enumerate: proxyEnumerateTrap,\r\n    getOwnPropertyDescriptor: proxyGetOwnPropertyDescriptorTrap,\r\n});\r\n//# sourceMappingURL=traps.js.map","import { isReservedPropertyName, ReservedPropertyNames, } from '@actualwave/deferred-data-access/utils';\r\nimport { CommandChain, } from '@actualwave/deferred-data-access/command';\r\nimport { wrapWithProxy, createProxyTrapsObject, ProxyCommand, generateProxyCommand, } from '@actualwave/deferred-data-access/proxy';\r\nconst EMPTY_PROMISE = Promise.resolve(undefined);\r\nconst isPromiseActivity = (command) => {\r\n    const { type } = command;\r\n    if (type === ProxyCommand.GET || type === ProxyCommand.METHOD_CALL) {\r\n        return isReservedPropertyName(command.name);\r\n    }\r\n    if (type === ProxyCommand.APPLY) {\r\n        return isReservedPropertyName(command.prev?.name);\r\n    }\r\n    return false;\r\n};\r\nconst executePromiseMethod = (context, name, args) => {\r\n    switch (name) {\r\n        case ReservedPropertyNames.THEN:\r\n            return context.then(...args);\r\n        case ReservedPropertyNames.CATCH:\r\n            return context.catch(...args);\r\n        default:\r\n            throw new Error(`Unexpected Error: Promise method \"${String(name)}\" could not be called.`);\r\n    }\r\n};\r\nconst applyPromiseActivity = (command, commandHandler, lazy, wrap) => {\r\n    switch (command.type) {\r\n        case ProxyCommand.GET: {\r\n            const { name, prev } = command;\r\n            let { context } = command;\r\n            if (lazy) {\r\n                // then() / catch() on lazy means we should call handler and subscribe to promise\r\n                if (!prev) {\r\n                    throw new Error(`Unexpected Error: Proxy command GET has unknown context.`);\r\n                }\r\n                // When lazy, context is a dummy promise, so we have to call handler with previous command and then use it as a context.\r\n                context = commandHandler(prev, prev.context, wrap);\r\n            }\r\n            else {\r\n                // then() / catch() on non-lazy means we handler already called, just subscribe to promise of it\r\n                /*\r\n                   When not lazy, this promise was already created and is a context to this action.\r\n                   Without wrapper we may get this error:\r\n                   Uncaught TypeError: Method Promise.prototype.then called on incompatible receiver undefined\r\n                */\r\n                //return (context as any)[name as string](...(value as never[]));\r\n            }\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            return (...args) => context[name](...args);\r\n        }\r\n        case ProxyCommand.METHOD_CALL:\r\n            if (!command.context) {\r\n                throw new Error(`Unexpected Error: Could not apply Promise method of unknown context.`);\r\n            }\r\n            return executePromiseMethod(command.context, command.name, command.value);\r\n        case ProxyCommand.APPLY:\r\n            {\r\n                const { prev } = command;\r\n                if (!prev?.context || !prev?.name) {\r\n                    throw new Error(`Unexpected Error: Could not apply Promise method of unknown context.`);\r\n                }\r\n                return executePromiseMethod(prev.context, prev.name, command.value);\r\n            }\r\n            break;\r\n        default:\r\n            throw new Error(`Command type \"${command.type}\" could not be executed as a Promise command.`);\r\n            break;\r\n    }\r\n};\r\nexport const handle = (commandHandler, lazy = true) => (context, command) => {\r\n    const wrap = (context, command) => {\r\n        const traps = createProxyTrapsObject((type, name, value, context) => {\r\n            const childCommand = generateProxyCommand(command, type, name, value, context, lazy);\r\n            let result;\r\n            if (isPromiseActivity(childCommand)) {\r\n                return applyPromiseActivity(childCommand, commandHandler, lazy, wrap);\r\n            }\r\n            else if ((type === ProxyCommand.APPLY || type === ProxyCommand.GET) &&\r\n                lazy) {\r\n                result = EMPTY_PROMISE;\r\n            }\r\n            else {\r\n                result = commandHandler(childCommand, context, wrap);\r\n            }\r\n            // anything coming not from Promise methods is always wrapped\r\n            return wrap(result, childCommand);\r\n        });\r\n        return wrapWithProxy(context, traps, {\r\n            getCommand() {\r\n                return command;\r\n            },\r\n            dropCommandChain() {\r\n                if (command) {\r\n                    delete command.prev;\r\n                }\r\n            },\r\n        });\r\n    };\r\n    return wrap(Promise.resolve(context), command ? CommandChain.fromCommand(command) : undefined);\r\n};\r\n//# sourceMappingURL=core.js.map","class KeysIterator {\r\n    constructor(map) {\r\n        this.map = map;\r\n        this.mapIterator = this.map.keys();\r\n    }\r\n    [Symbol.iterator]() {\r\n        return new KeysIterator(this.map);\r\n    }\r\n    next() {\r\n        let key;\r\n        let value;\r\n        let done;\r\n        do {\r\n            ({ done, value: key } = this.mapIterator.next());\r\n            if (!done) {\r\n                value = this.map.get(key).deref();\r\n            }\r\n        } while (!done && !value);\r\n        return {\r\n            done,\r\n            value: key,\r\n        };\r\n    }\r\n}\n\nclass ValuesIterator {\r\n    constructor(mapIterator) {\r\n        this.mapIterator = mapIterator;\r\n    }\r\n    [Symbol.iterator]() {\r\n        return new ValuesIterator(this.mapIterator[Symbol.iterator]());\r\n    }\r\n    next() {\r\n        let ref;\r\n        let value;\r\n        let done;\r\n        do {\r\n            ({ done, value: ref } = this.mapIterator.next());\r\n            if (done) {\r\n                value = undefined;\r\n            }\r\n            else {\r\n                value = ref.deref();\r\n            }\r\n        } while (!done && !value);\r\n        return {\r\n            done,\r\n            value,\r\n        };\r\n    }\r\n}\n\nclass EntriesIterator {\r\n    constructor(mapIterator) {\r\n        this.mapIterator = mapIterator;\r\n    }\r\n    [Symbol.iterator]() {\r\n        return new EntriesIterator(this.mapIterator[Symbol.iterator]());\r\n    }\r\n    next() {\r\n        let entries;\r\n        let value;\r\n        let done;\r\n        do {\r\n            ({ done, value: entries } = this.mapIterator.next());\r\n            if (done) {\r\n                entries = undefined;\r\n            }\r\n            else {\r\n                value = entries[1].deref();\r\n                entries = [entries[0], value];\r\n            }\r\n        } while (!done && !value);\r\n        return {\r\n            done,\r\n            entries,\r\n        };\r\n    }\r\n}\n\nclass WeakValueMap {\r\n    constructor(autoVerify = true) {\r\n        this.map = new Map();\r\n        if (autoVerify) {\r\n            this.finalizer = new FinalizationRegistry((key) => {\r\n                const ref = this.map.get(key);\r\n                if (!ref || !ref.deref()) {\r\n                    this.map.delete(key);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    get size() {\r\n        return this.map.size;\r\n    }\r\n    keys() {\r\n        return new KeysIterator(this.map);\r\n    }\r\n    values() {\r\n        return new ValuesIterator(this.map.values());\r\n    }\r\n    entries() {\r\n        return new EntriesIterator(this.map.entries());\r\n    }\r\n    set(key, value) {\r\n        this.map.set(key, new WeakRef(value));\r\n    }\r\n    get(key) {\r\n        const ref = this.map.get(key);\r\n        return ref && ref.deref();\r\n    }\r\n    has(key) {\r\n        return !!this.get(key);\r\n    }\r\n    delete(key) {\r\n        return this.map.delete(key);\r\n    }\r\n    clear() {\r\n        this.map.clear();\r\n    }\r\n    forEach(callback) {\r\n        this.map.forEach((ref, key) => {\r\n            const value = ref.deref();\r\n            if (value) {\r\n                callback(value, key, this);\r\n            }\r\n        });\r\n    }\r\n    verify() {\r\n        const map = new Map();\r\n        this.map.forEach((ref, key) => {\r\n            const value = ref.deref();\r\n            if (value) {\r\n                map.set(key, ref);\r\n            }\r\n        });\r\n        this.map.clear();\r\n        this.map = map;\r\n    }\r\n}\n\nclass WeakStorage extends WeakValueMap {\r\n    constructor(autoVerify) {\r\n        super(autoVerify);\r\n        this.byValues = new WeakMap();\r\n    }\r\n    set(key, value) {\r\n        super.set(key, value);\r\n        this.byValues.set(key, value);\r\n    }\r\n    getKey(value) {\r\n        return this.byValues.get(value);\r\n    }\r\n    delete(key) {\r\n        const value = this.get(key);\r\n        if (value) {\r\n            this.byValues.delete(value);\r\n        }\r\n        return super.delete(key);\r\n    }\r\n    clear() {\r\n        super.clear();\r\n        this.byValues = new WeakMap();\r\n    }\r\n}\n\nexport { WeakStorage, WeakValueMap };\n","import { IdOwner } from '@actualwave/deferred-data-access/utils';\r\nexport class Resource extends IdOwner {\r\n    constructor(pool, type) {\r\n        super();\r\n        this.pool = pool;\r\n        this.type = type;\r\n    }\r\n    toObject() {\r\n        return { id: this.id, poolId: this.pool.id, type: this.type };\r\n    }\r\n    toJSON() {\r\n        return JSON.stringify(this.toObject());\r\n    }\r\n}\r\nexport const createResource = (pool, target, type) => new Resource(pool, type || typeof target);\r\nexport const isResourceObject = (obj) => obj &&\r\n    // type signature is not enough for non-ts env\r\n    typeof obj === 'object' &&\r\n    typeof obj.id === 'string' &&\r\n    typeof obj.poolId === 'string';\r\n//# sourceMappingURL=resource.js.map","const validTargets = new Set();\r\nexport const getDefaultValidTargets = () => ['object', 'function'];\r\nexport const isValidTarget = (value) => validTargets.has(typeof value);\r\nexport const setValidTargets = (list) => {\r\n    validTargets.clear();\r\n    list.forEach((item) => validTargets.add(item));\r\n};\r\nsetValidTargets(getDefaultValidTargets());\r\n//# sourceMappingURL=utils.js.map","/* eslint-disable @typescript-eslint/ban-types */\r\nimport { IdOwner } from '@actualwave/deferred-data-access/utils';\r\nimport { WeakValueMap } from '@actualwave/weak-storage';\r\nimport { createResource } from './resource';\r\nimport { isValidTarget } from './utils';\r\nexport class ResourcePool extends IdOwner {\r\n    constructor() {\r\n        super(...arguments);\r\n        // { [string]: weakref }\r\n        this.refs = new WeakValueMap();\r\n        // { [weakref]: Resource }\r\n        this.resources = new WeakMap();\r\n    }\r\n    get active() {\r\n        return !!this.resources;\r\n    }\r\n    set(target, type) {\r\n        let resource = null;\r\n        if (!isValidTarget(target)) {\r\n            return resource;\r\n        }\r\n        resource = this.resources.get(target);\r\n        if (!resource) {\r\n            resource = createResource(this, target, type);\r\n            this.refs.set(resource.id, target);\r\n            this.resources.set(target, resource);\r\n        }\r\n        return resource;\r\n    }\r\n    has(target) {\r\n        return this.resources.has(target);\r\n    }\r\n    get({ id }) {\r\n        return this.getById(id);\r\n    }\r\n    getById(id) {\r\n        return this.refs.get(id);\r\n    }\r\n    getResource(target) {\r\n        return this.resources.get(target);\r\n    }\r\n    remove(target) {\r\n        const resource = this.resources.get(target);\r\n        if (resource) {\r\n            this.refs.delete(resource.id);\r\n            return this.resources.delete(target);\r\n        }\r\n        return false;\r\n    }\r\n    clear() {\r\n        for (const key of this.refs.keys()) {\r\n            const target = this.refs.get(key);\r\n            this.resources.delete(target);\r\n        }\r\n        this.refs.clear();\r\n    }\r\n}\r\n//# sourceMappingURL=resource-pool.js.map","import { ResourcePool } from \"./resource-pool\";\r\nconst generateGetDefaultResourcePool = (pool) => () => {\r\n    if (!pool) {\r\n        pool = new ResourcePool();\r\n    }\r\n    return pool;\r\n};\r\nexport const getDefaultResourcePool = generateGetDefaultResourcePool();\r\n//# sourceMappingURL=default-resource-pool.js.map","import { hasOwn } from '@actualwave/has-own';\r\nimport { IdOwner } from '@actualwave/deferred-data-access/utils';\r\nimport { getDefaultResourcePool } from './default-resource-pool';\r\nimport { ResourcePool } from './resource-pool';\r\nexport class ResourcePoolRegistry extends IdOwner {\r\n    constructor() {\r\n        super();\r\n        this.pools = {};\r\n        this.register(getDefaultResourcePool());\r\n    }\r\n    /**\r\n     * Create and register ResourcePool\r\n     */\r\n    createPool() {\r\n        const pool = new ResourcePool();\r\n        this.register(pool);\r\n        return pool;\r\n    }\r\n    /**\r\n     * Register ResourcePool instance.\r\n     */\r\n    register(pool) {\r\n        if (hasOwn(this.pools, pool.id))\r\n            return false;\r\n        this.pools[pool.id] = pool;\r\n        return true;\r\n    }\r\n    /**\r\n     * Retrieve ResourcePool instance from registry by its Id.\r\n     */\r\n    get(poolId) {\r\n        return this.pools[poolId] || null;\r\n    }\r\n    /**\r\n     * Check if ResourcePool registered in this registry instance.\r\n     */\r\n    isRegistered(pool) {\r\n        return hasOwn(this.pools, pool.id);\r\n    }\r\n    /**\r\n     * Remove ResourcePool from current registry instance.\r\n     */\r\n    remove(pool) {\r\n        const poolId = typeof pool === 'string' ? pool : pool.id;\r\n        return delete this.pools[poolId];\r\n    }\r\n}\r\nconst generateGetRegistry = (registry) => () => {\r\n    if (!registry) {\r\n        registry = new ResourcePoolRegistry();\r\n    }\r\n    return registry;\r\n};\r\nexport const getRegistry = generateGetRegistry();\r\n//# sourceMappingURL=resource-pool-registry.js.map",null,null,null,null],"names":["DATE_NOW","Date","now","Math","floor","random","index","ReservedPropertyNames","isReservedPropertyName","name","THEN","CATCH","createUIDGenerator","key","prefix","generateId","IdOwner","constructor","id","this","Command","type","value","context","toObject","includeContext","undefined","toJSON","JSON","stringify","static","jsonString","parse","CommandChain","prev","super","Symbol","iterator","item","isTail","forEach","callback","node","map","list","push","reduce","base","result","ProxyCommand","EXCLUSIONS","arguments","caller","prototype","API_PROP","wrapWithProxy","target","traps","api","wrapper","Object","assign","args","apply","getTarget","Proxy","hasOwn","has","hasOwnProperty","property","Boolean","call","isNameExcluded","createGetTrap","handler","GET","createApplyTrap","thisValue","APPLY","createSetTrap","SET","createDeletePropertyTrap","DELETE_PROPERTY","proxyHasTrap","proxyOwnKeysTrap","getOwnPropertyNames","proxyEnumerateTrap","proxyGetOwnPropertyDescriptorTrap","getOwnPropertyDescriptor","EMPTY_PROMISE","Promise","resolve","executePromiseMethod","then","catch","Error","String","handle","commandHandler","lazy","command","wrap","childCommand","head","METHOD_CALL","generateProxyCommand","isPromiseActivity","applyPromiseActivity","get","set","deleteProperty","ownKeys","enumerate","getCommand","dropCommandChain","fromCommand","KeysIterator","mapIterator","keys","next","done","deref","ValuesIterator","ref","EntriesIterator","entries","WeakValueMap","autoVerify","Map","finalizer","FinalizationRegistry","delete","size","values","WeakRef","clear","verify","Resource","pool","poolId","isResourceObject","obj","validTargets","Set","add","ResourcePool","refs","resources","WeakMap","active","resource","createResource","getById","getResource","remove","getDefaultResourcePool","generateGetDefaultResourcePool","ResourcePoolRegistry","pools","register","createPool","isRegistered","getRegistry","registry","generateGetRegistry","EVENT_TYPE","InterfaceType","MessageType","generateMessageId","createIsHandshakeMessage","data","match","resolveOrTimeout","timeout","timeoutError","onTimeout","promise","race","_","rej","setTimeout","findEventEmitter","worker","self","findMessagePort","getMessageEventData","event","Event","createSubscriberFns","instance","addEventListener","subscribe","listener","unsubscribe","removeEventListener","addListener","removeListener","on","off","handshake","remoteId","handshakeTimeout","params","isMessage","HOST","root","postMessage","handshakeHandler","handshakeHost","handshakeInterval","intervalId","clearInterval","intervalFn","setInterval","handshakeWorker","extractResourceFrom","initialize","async","initId","apiRoot","remoteRoot","pendingRequests","createRequest","source","commandChain","contextTarget","exeContext","REQUEST","createRequestMessage","createResponse","error","RESPONSE","messageHandler","request","applyRemoteRequest","message","reject","stop","responseTimeout","resultPromise","rq","Worker","eventEmitter","messagePort","WORKER"],"mappings":"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"}