{"version":3,"file":"rest-object.umd.js","sources":["../../../../../packages/rest-object/src/fetch.ts","../../../node_modules/@actualwave/has-own/index.es.js","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/proxy/src/command.js","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/command/src/command.js","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/command/src/command-chain.js","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/proxy/src/types.js","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/proxy/src/proxy.js","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/proxy/src/utils.js","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/proxy/src/traps.js","../../../../../packages/rest-object/src/request.ts","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/utils/src/utils.js","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/core/core.js","../../../packages/rest-object/node_modules/@actualwave/deferred-data-access/record/record.js","../../../../../packages/rest-object/src/rest-object.ts"],"sourcesContent":[null,"export const hasOwn = (\n  (has) =>\n  (target, property) =>\n  Boolean(target && has.call(target, property))\n)(Object.prototype.hasOwnProperty);\n\nexport default hasOwn;","import { CommandChain } from '@actualwave/deferred-data-access/command';\r\nexport var ProxyCommand;\r\n(function (ProxyCommand) {\r\n    ProxyCommand[\"GET\"] = \"P:get\";\r\n    ProxyCommand[\"SET\"] = \"P:set\";\r\n    ProxyCommand[\"APPLY\"] = \"P:apply\";\r\n    ProxyCommand[\"DELETE_PROPERTY\"] = \"P:del\";\r\n    // If proxy works in lazy mode and APPLY command has previous GET command, this will be generated.\r\n    ProxyCommand[\"METHOD_CALL\"] = \"P:call\";\r\n})(ProxyCommand || (ProxyCommand = {}));\r\nexport const generateProxyCommand = (head, type, name, value, context, lazy) => {\r\n    if (type === ProxyCommand.APPLY && lazy && head?.type === ProxyCommand.GET) {\r\n        return new CommandChain(head.prev, ProxyCommand.METHOD_CALL, head.name, value, head.context);\r\n    }\r\n    return new CommandChain(head, type, name, value, context);\r\n};\r\nexport const getMethodName = ({ prev }) => prev?.name;\r\nexport const getMethodCallContext = ({ prev }) => prev?.context;\r\n//# sourceMappingURL=command.js.map","export class Command {\r\n    constructor(type, name, value, context) {\r\n        this.type = type;\r\n        this.name = name;\r\n        this.value = value;\r\n        this.context = context;\r\n    }\r\n    toObject(includeContext = false) {\r\n        const { type, name, value, context } = this;\r\n        return {\r\n            type,\r\n            name,\r\n            value,\r\n            context: includeContext ? context : undefined,\r\n        };\r\n    }\r\n    toJSON(includeContext = false) {\r\n        const { type, name, value, context } = this;\r\n        return JSON.stringify([\r\n            type,\r\n            name,\r\n            value,\r\n            includeContext ? context : undefined,\r\n        ]);\r\n    }\r\n    static fromJSON(jsonString) {\r\n        const [type, name, value, context] = JSON.parse(jsonString);\r\n        return new Command(type, name, value, context);\r\n    }\r\n}\r\n//# sourceMappingURL=command.js.map","import { Command } from './command';\r\nexport class CommandChain extends Command {\r\n    constructor(prev, type, name, value, context) {\r\n        super(type, name, value, context);\r\n        this.prev = prev;\r\n    }\r\n    *[Symbol.iterator]() {\r\n        let item = this;\r\n        while (item) {\r\n            yield item;\r\n            item = item.prev;\r\n        }\r\n    }\r\n    isTail() {\r\n        return !this.prev;\r\n    }\r\n    forEach(callback) {\r\n        let node = this;\r\n        do {\r\n            callback(node);\r\n            node = node.prev;\r\n        } while (node);\r\n    }\r\n    map(callback) {\r\n        let node = this;\r\n        const list = [];\r\n        do {\r\n            list.push(callback(node));\r\n            node = node.prev;\r\n        } while (node);\r\n        return list;\r\n    }\r\n    reduce(callback, base) {\r\n        let node = this;\r\n        let result = base;\r\n        do {\r\n            result = callback(result, node);\r\n            node = node.prev;\r\n        } while (node);\r\n        return result;\r\n    }\r\n    static fromCommand({ type, name, value, context }, prev) {\r\n        return new CommandChain(prev, type, name, value, context);\r\n    }\r\n}\r\n//# sourceMappingURL=command-chain.js.map","export const EXCLUSIONS = {\r\n    /*\r\n     INFO arguments and caller were included because they are required function properties\r\n     https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/arguments\r\n     */\r\n    arguments: true,\r\n    caller: true,\r\n    prototype: true,\r\n};\r\nexport const API_PROP = Symbol('P:api');\r\n//# sourceMappingURL=types.js.map","import { API_PROP } from './types';\r\nexport const wrapWithProxy = (\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntarget, traps, api = {}) => {\r\n    const wrapper = Object.assign(typeof target === 'function'\r\n        ? function $RequestFn(...args) {\r\n            return target.apply(this, args);\r\n        }\r\n        : function $Request() {\r\n            // because\r\n        }, {\r\n        target,\r\n        [API_PROP]: { getTarget: () => target, ...api },\r\n    });\r\n    return new Proxy(wrapper, traps);\r\n};\r\nexport const isWrappedWithProxy = (obj) => !!(obj && obj[API_PROP]);\r\nexport const unwrapProxy = (obj) => obj && obj[API_PROP] && obj[API_PROP].getTarget() || obj;\r\n//# sourceMappingURL=proxy.js.map","import { hasOwn } from '@actualwave/has-own';\r\nimport { ProxyCommand, getMethodCallContext } from './command';\r\nimport { API_PROP, EXCLUSIONS } from './types';\r\nexport const isNameExcluded = (name) => name === API_PROP || hasOwn(EXCLUSIONS, name);\r\nexport const isNameSymbol = (name) => typeof name === 'symbol';\r\nexport const followCommandChain = async (head, \r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ncontext) => {\r\n    let target = context;\r\n    if (!context) {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        target = head.prev\r\n            ? await followCommandChain(head.prev)\r\n            : head.context;\r\n    }\r\n    const { type, name, value } = head;\r\n    switch (type) {\r\n        case ProxyCommand.GET:\r\n            return target[name];\r\n        case ProxyCommand.APPLY:\r\n            return target.apply(getMethodCallContext(head), value);\r\n    }\r\n    throw new Error(`Unknown command \"${type}\" cannot be followed, only ProxyCommand.GET and APPLY are allowed.`);\r\n};\r\n//# sourceMappingURL=utils.js.map","import { ProxyCommand } from './command';\r\nimport { EXCLUSIONS } from './types';\r\nimport { isNameExcluded } from './utils';\r\nconst createGetTrap = (handler) => (wrapper, name) => {\r\n    const { target } = wrapper;\r\n    if (isNameExcluded(name)) {\r\n        return wrapper[name];\r\n    }\r\n    // We expect that user of the lib will wrap with Proxy explicitly whatever they want\r\n    return handler(ProxyCommand.GET, name, undefined, target);\r\n};\r\nconst createApplyTrap = (handler) => ({ target }, thisValue, args) => {\r\n    // thisValue is being ignored for now\r\n    // target is a function that should be applied\r\n    return handler(ProxyCommand.APPLY, undefined, args, target);\r\n};\r\nconst createSetTrap = (handler) => ({ target }, name, value) => {\r\n    if (isNameExcluded(name)) {\r\n        return false;\r\n    }\r\n    /* TODO why this might be needed?\r\n    if (isNameSymbol(name)) {\r\n      target.then((context: any) => {\r\n        context[name] = value;\r\n      });\r\n\r\n      return false;\r\n    }\r\n    */\r\n    handler(ProxyCommand.SET, name, value, target);\r\n    return true;\r\n};\r\nconst createDeletePropertyTrap = (handler) => (wrapper, name) => {\r\n    if (isNameExcluded(name)) {\r\n        return false;\r\n    }\r\n    handler(ProxyCommand.DELETE_PROPERTY, name, undefined, wrapper.target);\r\n    return true;\r\n};\r\nconst proxyHasTrap = (wrapper, name) => {\r\n    if (isNameExcluded(name)) {\r\n        return wrapper[name];\r\n    }\r\n    return false;\r\n};\r\nconst proxyOwnKeysTrap = () => Object.getOwnPropertyNames(EXCLUSIONS);\r\n// INFO You cannot enumerate properties of request object, this may possibly require processing a lot of data\r\nconst proxyEnumerateTrap = () => Object.getOwnPropertyNames(EXCLUSIONS)[Symbol.iterator]();\r\nconst proxyGetOwnPropertyDescriptorTrap = (wrapper, name) => {\r\n    if (isNameExcluded(name)) {\r\n        return Object.getOwnPropertyDescriptor(wrapper, name);\r\n    }\r\n    return Object.getOwnPropertyDescriptor(wrapper.target, name);\r\n};\r\nexport const createProxyTrapsObject = (handler) => ({\r\n    get: createGetTrap(handler),\r\n    apply: createApplyTrap(handler),\r\n    set: createSetTrap(handler),\r\n    deleteProperty: createDeletePropertyTrap(handler),\r\n    has: proxyHasTrap,\r\n    ownKeys: proxyOwnKeysTrap,\r\n    enumerate: proxyEnumerateTrap,\r\n    getOwnPropertyDescriptor: proxyGetOwnPropertyDescriptorTrap,\r\n});\r\n//# sourceMappingURL=traps.js.map",null,"const DATE_NOW = Date.now() - Math.floor(Math.random() * 1000);\r\nlet index = 0;\r\nexport var ReservedPropertyNames;\r\n(function (ReservedPropertyNames) {\r\n    ReservedPropertyNames[\"THEN\"] = \"then\";\r\n    ReservedPropertyNames[\"CATCH\"] = \"catch\";\r\n})(ReservedPropertyNames || (ReservedPropertyNames = {}));\r\nexport const isReservedPropertyName = (name) => name === ReservedPropertyNames.THEN || name === ReservedPropertyNames.CATCH;\r\nexport const reject = async (message) => {\r\n    throw message;\r\n};\r\nexport const createUIDGenerator = (key = '') => {\r\n    const prefix = `${key ? `${key}/` : ''}${DATE_NOW}/`;\r\n    return () => `${prefix}${++index};`;\r\n};\r\nexport const generateId = createUIDGenerator();\r\nexport class IdOwner {\r\n    constructor(id = generateId()) {\r\n        this.id = id;\r\n    }\r\n}\r\n//# sourceMappingURL=utils.js.map","import { isReservedPropertyName, ReservedPropertyNames, } from '@actualwave/deferred-data-access/utils';\r\nimport { CommandChain, } from '@actualwave/deferred-data-access/command';\r\nimport { wrapWithProxy, createProxyTrapsObject, ProxyCommand, generateProxyCommand, } from '@actualwave/deferred-data-access/proxy';\r\nconst EMPTY_PROMISE = Promise.resolve(undefined);\r\nconst isPromiseActivity = (command) => {\r\n    const { type } = command;\r\n    if (type === ProxyCommand.GET || type === ProxyCommand.METHOD_CALL) {\r\n        return isReservedPropertyName(command.name);\r\n    }\r\n    if (type === ProxyCommand.APPLY) {\r\n        return isReservedPropertyName(command.prev?.name);\r\n    }\r\n    return false;\r\n};\r\nconst executePromiseMethod = (context, name, args) => {\r\n    switch (name) {\r\n        case ReservedPropertyNames.THEN:\r\n            return context.then(...args);\r\n        case ReservedPropertyNames.CATCH:\r\n            return context.catch(...args);\r\n        default:\r\n            throw new Error(`Unexpected Error: Promise method \"${String(name)}\" could not be called.`);\r\n    }\r\n};\r\nconst applyPromiseActivity = (command, commandHandler, lazy, wrap) => {\r\n    switch (command.type) {\r\n        case ProxyCommand.GET: {\r\n            const { name, prev } = command;\r\n            let { context } = command;\r\n            if (lazy) {\r\n                // then() / catch() on lazy means we should call handler and subscribe to promise\r\n                if (!prev) {\r\n                    throw new Error(`Unexpected Error: Proxy command GET has unknown context.`);\r\n                }\r\n                // When lazy, context is a dummy promise, so we have to call handler with previous command and then use it as a context.\r\n                context = commandHandler(prev, prev.context, wrap);\r\n            }\r\n            else {\r\n                // then() / catch() on non-lazy means we handler already called, just subscribe to promise of it\r\n                /*\r\n                   When not lazy, this promise was already created and is a context to this action.\r\n                   Without wrapper we may get this error:\r\n                   Uncaught TypeError: Method Promise.prototype.then called on incompatible receiver undefined\r\n                */\r\n                //return (context as any)[name as string](...(value as never[]));\r\n            }\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            return (...args) => context[name](...args);\r\n        }\r\n        case ProxyCommand.METHOD_CALL:\r\n            if (!command.context) {\r\n                throw new Error(`Unexpected Error: Could not apply Promise method of unknown context.`);\r\n            }\r\n            return executePromiseMethod(command.context, command.name, command.value);\r\n        case ProxyCommand.APPLY:\r\n            {\r\n                const { prev } = command;\r\n                if (!prev?.context || !prev?.name) {\r\n                    throw new Error(`Unexpected Error: Could not apply Promise method of unknown context.`);\r\n                }\r\n                return executePromiseMethod(prev.context, prev.name, command.value);\r\n            }\r\n            break;\r\n        default:\r\n            throw new Error(`Command type \"${command.type}\" could not be executed as a Promise command.`);\r\n            break;\r\n    }\r\n};\r\nexport const handle = (commandHandler, lazy = true) => (context, command) => {\r\n    const wrap = (context, command) => {\r\n        const traps = createProxyTrapsObject((type, name, value, context) => {\r\n            const childCommand = generateProxyCommand(command, type, name, value, context, lazy);\r\n            let result;\r\n            if (isPromiseActivity(childCommand)) {\r\n                return applyPromiseActivity(childCommand, commandHandler, lazy, wrap);\r\n            }\r\n            else if ((type === ProxyCommand.APPLY || type === ProxyCommand.GET) &&\r\n                lazy) {\r\n                result = EMPTY_PROMISE;\r\n            }\r\n            else {\r\n                result = commandHandler(childCommand, context, wrap);\r\n            }\r\n            // anything coming not from Promise methods is always wrapped\r\n            return wrap(result, childCommand);\r\n        });\r\n        return wrapWithProxy(context, traps, {\r\n            getCommand() {\r\n                return command;\r\n            },\r\n            dropCommandChain() {\r\n                if (command) {\r\n                    delete command.prev;\r\n                }\r\n            },\r\n        });\r\n    };\r\n    return wrap(Promise.resolve(context), command ? CommandChain.fromCommand(command) : undefined);\r\n};\r\n//# sourceMappingURL=core.js.map","import { unwrapProxy } from '@actualwave/deferred-data-access/proxy';\r\nconst calls = new Map();\r\nlet latest = Promise.resolve();\r\nconst noop = () => null;\r\nexport const latestCall = () => latest;\r\nexport const latestCallFor = (context) => calls.get(unwrapProxy(context));\r\nexport const clearLatestCalls = () => calls.clear();\r\nexport const recordHandlerCalls = (handler) => (command, context, wrap) => {\r\n    const promise = handler(command, context, wrap);\r\n    if (context && !calls.has(context)) {\r\n        calls.set(context, promise);\r\n        promise.catch(noop).then(() => calls.delete(context));\r\n    }\r\n    latest = promise;\r\n    return promise;\r\n};\r\n//# sourceMappingURL=record.js.map",null],"names":["fetchFn","fetch","Error","callFetchFn","url","params","hasOwn","has","Object","prototype","hasOwnProperty","target","property","Boolean","call","ProxyCommand","Command","constructor","type","name","value","context","this","toObject","includeContext","undefined","toJSON","JSON","stringify","static","jsonString","parse","CommandChain","prev","super","Symbol","iterator","item","isTail","forEach","callback","node","map","list","push","reduce","base","result","EXCLUSIONS","arguments","caller","API_PROP","wrapWithProxy","traps","api","wrapper","assign","args","apply","getTarget","Proxy","isNameExcluded","createGetTrap","handler","GET","createApplyTrap","thisValue","APPLY","createSetTrap","SET","createDeletePropertyTrap","DELETE_PROPERTY","proxyHasTrap","proxyOwnKeysTrap","getOwnPropertyNames","proxyEnumerateTrap","proxyGetOwnPropertyDescriptorTrap","getOwnPropertyDescriptor","CONTENT_TYPE","JSON_TYPE","CRUD_METHODS","create","read","patch","update","delete","httpMethodByType","METHOD_CALL","httpMethodByName","prepareBody","body","request","proto","getPrototypeOf","Array","headers","headersImpl","set","get","headersObj","defineContentTypeHeader","getURLFromChain","async","chain","last","part","String","generateRequest","command","isCRUDMethod","getBodyByType","method","queryParams","config","query","URLSearchParams","toString","ReservedPropertyNames","isReservedPropertyName","THEN","CATCH","EMPTY_PROMISE","Promise","resolve","executePromiseMethod","then","catch","handle","commandHandler","lazy","wrap","childCommand","head","generateProxyCommand","isPromiseActivity","applyPromiseActivity","deleteProperty","ownKeys","enumerate","getCommand","dropCommandChain","fromCommand","calls","Map","noop","latestCallFor","obj","baseUrl","requestFn","r","response","contentType","test","json","text","indexOf","formData","getResponse","promise","fn"],"mappings":"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"}