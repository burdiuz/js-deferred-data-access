!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).RESTObject={})}(this,(function(e){"use strict";let t="function"==typeof fetch?fetch:()=>{throw new Error("fetch() global function is not available.")};const r=(e,r)=>t(e,r),n=(o=Object.prototype.hasOwnProperty,(e,t)=>Boolean(e&&o.call(e,t)));var o,a;class c{constructor(e,t,r,n){this.type=e,this.name=t,this.value=r,this.context=n}toObject(e=!1){const{type:t,name:r,value:n,context:o}=this;return{type:t,name:r,value:n,context:e?o:void 0}}toJSON(e=!1){const{type:t,name:r,value:n,context:o}=this;return JSON.stringify([t,r,n,e?o:void 0])}static fromJSON(e){const[t,r,n,o]=JSON.parse(e);return new c(t,r,n,o)}}class s extends c{constructor(e,t,r,n,o){super(t,r,n,o),this.prev=e}*[Symbol.iterator](){let e=this;for(;e;)yield e,e=e.prev}isTail(){return!this.prev}forEach(e){let t=this;do{e(t),t=t.prev}while(t)}map(e){let t=this;const r=[];do{r.push(e(t)),t=t.prev}while(t);return r}reduce(e,t){let r=this,n=t;do{n=e(n,r),r=r.prev}while(r);return n}static fromCommand({type:e,name:t,value:r,context:n},o){return new s(o,e,t,r,n)}}!function(e){e.GET="P:get",e.SET="P:set",e.APPLY="P:apply",e.DELETE_PROPERTY="P:del",e.METHOD_CALL="P:call"}(a||(a={}));const i={arguments:!0,caller:!0,prototype:!0},u=Symbol("P:api"),p=(e,t,r={})=>{const n=Object.assign("function"==typeof e?function(...t){return e.apply(this,t)}:function(){},{target:e,[u]:{getTarget:()=>e,...r}});return new Proxy(n,t)},l=e=>e===u||n(i,e),d=e=>(t,r)=>{const{target:n}=t;return l(r)?t[r]:e(a.GET,r,void 0,n)},y=e=>({target:t},r,n)=>e(a.APPLY,void 0,n,t),h=e=>({target:t},r,n)=>!l(r)&&(e(a.SET,r,n,t),!0),m=e=>(t,r)=>!l(r)&&(e(a.DELETE_PROPERTY,r,void 0,t.target),!0),f=(e,t)=>!!l(t)&&e[t],E=()=>Object.getOwnPropertyNames(i),P=()=>Object.getOwnPropertyNames(i)[Symbol.iterator](),T=(e,t)=>l(t)?Object.getOwnPropertyDescriptor(e,t):Object.getOwnPropertyDescriptor(e.target,t),w="Content-Type",O="application/json",v={create:"POST",read:"GET",patch:"PATCH",update:"PUT",delete:"DELETE"},g=e=>{switch(e){case a.SET:return"PUT";case a.DELETE_PROPERTY:return"DELETE";case a.APPLY:case a.METHOD_CALL:return"POST";default:return"GET"}},L=e=>v[e],x=(e,t)=>{if(!e)return t;const r=Object.getPrototypeOf(e);return r===Object.prototype||r===Array.prototype||"function"==typeof e.toJSON?(e=>{let{headers:t}=e;t||(t={});const r=t;if("function"==typeof r.set)return r.get(w)||r.set(w,O),e;const n=t;return n[w]||(e={...e,headers:{...n,[w]:O}}),e})({...t,body:JSON.stringify(e)}):e},b=async e=>{let t=e;const r=e.reduce(((e,r)=>(t=r,`/${String(r.name)}${e}`)),"");return`${await t.context||""}${r}`},C=async e=>{const{type:t,name:r,value:o}=e;if(t!==a.METHOD_CALL||!(e=>n(v,e))(r)){const r=await b(e),n=(({type:e,value:t})=>{switch(e){case a.SET:return t;case a.APPLY:case a.METHOD_CALL:return t[0];default:return}})(e);return x(n,{url:r,method:g(t)})}const[c,s,i]=o,u=await b(e.prev),p=c?new URLSearchParams(c).toString():"";return{...x(s,{url:p?`${u}&${p}`:u,method:L(String(r))}),...i}};var S;!function(e){e.THEN="then",e.CATCH="catch"}(S||(S={}));const A=e=>e===S.THEN||e===S.CATCH,D=Promise.resolve(void 0),j=(e,t,r)=>{switch(t){case S.THEN:return e.then(...r);case S.CATCH:return e.catch(...r);default:throw new Error(`Unexpected Error: Promise method "${String(t)}" could not be called.`)}},H=(e,t=!0)=>(r,n)=>{const o=(r,n)=>{const c=(i=(r,c,i,u)=>{const p=((e,t,r,n,o,c)=>t===a.APPLY&&c&&e?.type===a.GET?new s(e.prev,a.METHOD_CALL,e.name,n,e.context):new s(e,t,r,n,o))(n,r,c,i,u,t);let l;return(e=>{const{type:t}=e;return t===a.GET||t===a.METHOD_CALL?A(e.name):t===a.APPLY&&A(e.prev?.name)})(p)?((e,t,r,n)=>{switch(e.type){case a.GET:{const{name:o,prev:a}=e;let{context:c}=e;if(r){if(!a)throw new Error("Unexpected Error: Proxy command GET has unknown context.");c=t(a,a.context,n)}return(...e)=>c[o](...e)}case a.METHOD_CALL:if(!e.context)throw new Error("Unexpected Error: Could not apply Promise method of unknown context.");return j(e.context,e.name,e.value);case a.APPLY:{const{prev:t}=e;if(!t?.context||!t?.name)throw new Error("Unexpected Error: Could not apply Promise method of unknown context.");return j(t.context,t.name,e.value)}default:throw new Error(`Command type "${e.type}" could not be executed as a Promise command.`)}})(p,e,t,o):(l=r!==a.APPLY&&r!==a.GET||!t?e(p,u,o):D,o(l,p))},{get:d(i),apply:y(i),set:h(i),deleteProperty:m(i),has:f,ownKeys:E,enumerate:P,getOwnPropertyDescriptor:T});var i;return p(r,c,{getCommand:()=>n,dropCommandChain(){n&&delete n.prev}})};return o(Promise.resolve(r),n?s.fromCommand(n):void 0)},_=new Map;Promise.resolve();const N=()=>null,Y=e=>{return _.get((t=e)&&t[u]&&t[u].getTarget()||t);var t};e.callFetchFn=r,e.createRESTObject=(e,t=(e=>e))=>{var n;return H((n=async(e,n)=>{if(n&&e.type===a.METHOD_CALL&&"forLatest"===e.name)return Y(n);const o=t(await C(e)),c=await r(o.url,o),s=c.headers.get("Content-Type")||"",i=await(async(e,t)=>/^\w+\/json(?:[^a-z]|$)/i.test(t)?e.json():/^text\//i.test(t)?e.text():0===t.indexOf("multipart/form-data")?e.formData():e.body)(c,s);return{body:i,contentType:s,response:c}},(e,t,r)=>{const o=n(e,t,r);return t&&!_.has(t)&&(_.set(t,o),o.catch(N).then((()=>_.delete(t)))),o}))(e)},e.generateRequest=C,e.getFetchFn=()=>t,e.setFetchFn=e=>{t=e},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rest-object.umd.js.map
