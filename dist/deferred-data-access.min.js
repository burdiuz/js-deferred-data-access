!function(e,t){"function"==typeof define&&define.amd?define(["event-dispatcher"],t):"object"==typeof module&&module.exports?module.exports=t(require("event-dispatcher")):e.DataAccessInterface=t(e.EventDispatcher)}(this,function(e){var t=function(){"use strict";function t(){return new g}function r(){return"function"==typeof Proxy}function n(){}function o(e,t){t=t||T.defaultResourcePool;var r=null;return e instanceof D?r=e.toJSON():"object"==typeof e[E]?r=k.toJSON(e):e instanceof n||"function"==typeof e?r=t.set(e).toJSON():l(e)&&(r=e),r}function i(e){var t=o(e);return t?t[v]:null}function s(e){var t=null;return"object"==typeof e[E]?t=e[E].id:l(e)&&(t=e[v].id),t}function u(e){var t=null;return"object"==typeof e[E]?t=e[E].poolId:l(e)&&(t=e[v].poolId),t}function a(e){var t=null;return"object"==typeof e[E]?t=e[E].type:l(e)&&(t=e[v].type),t}function c(e){var t={};return t[v]={id:"foreign-id-"+O(),type:e||typeof t,poolId:"foreign-poolId-"+O()},t}function l(e){return e instanceof D||e instanceof k||e&&("object"==typeof e[E]||"object"==typeof e[v])}function h(e){return l(e)||"function"==typeof e||e instanceof n}function f(e,t){return l(e)&&l(t)&&s(e)===s(t)&&u(e)===u(t)}function p(e,t){t instanceof Array?t.push(e):t&&(t[e.name]=e)}function d(e,t){return function(r,n,o,i){var s=R.create(e,r,t,n,i);return p(s,o),s}}var y=Object.freeze({PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected",DESTROYED:"destroyed"}),E=Symbol("request.target:internals"),v="resource::data",O=function(){var e="DA/"+String(Date.now())+"/",t=0;return function(){return e+String(++t)+"/"+String(Date.now())}}(),g=function(){function e(){this._status=y.PENDING,this.promise=new Promise(function(e,t){this.resolve=e,this.reject=t}.bind(this))}return e}(),R=function(){function e(){return!1}function t(t,r,n,o,i,s){this.name=void 0!==n?n:t,this.type=t,this.handle=r,this.isTemporary=o||e,this.cacheable=Boolean(i),this.virtual=Boolean(s)}function r(e,r,n,o,i,s){var u=new t(e,r,n,o,i,s);return Object.freeze(u)}return t.create=r,t}(),P=function(){var e=Symbol("::destroy.resource"),t={DESTROY:"::destroy.resource",fields:Object.freeze({DESTROY:e})};return t.createDESTROYDescriptor=function(e,r){var n=R.create(t.DESTROY,e,t.fields.DESTROY,null,!1,!0);return p(n,r),n},Object.freeze(t)}(),b=function(){function e(){return[n.GET,n.SET,n.APPLY,n.DELETE_PROPERTY]}function t(){return[n.GET,n.SET,n.APPLY]}function r(e,t,r,n){var o,i,s,u,a=b.list,c=a.length;r=r||{};for(var l=0;c>l;l++)i=a[l],o=e[i],s=b.fields[i],o instanceof Function&&(u=R.create(i,o,s,t,n),r instanceof Array?r.push(u):r&&(r[s]=u));return r}var n={GET:"get",SET:"set",APPLY:"apply",DELETE_PROPERTY:"deleteProperty"};return n.fields=Object.freeze({get:Symbol("proxy.commands::get"),set:Symbol("proxy.commands::set"),apply:Symbol("proxy.commands::apply"),deleteProperty:Symbol("proxy.commands::deleteProperty")}),Object.defineProperties(n,{list:{get:e},required:{get:t}}),n.createGETDescriptor=d(n.GET,n.fields.get),n.createSETDescriptor=d(n.SET,n.fields.set),n.createAPPLYDescriptor=d(n.APPLY,n.fields.apply),n.createDescriptors=r,Object.freeze(n)}(),m=Object.freeze({names:Object.freeze({then:!0,"catch":!0})}),D=function(){function e(e,u,a,c){Object.defineProperty(this,E,{value:{active:!0,pool:e,poolId:e?e.id:null,resource:u,type:a,id:c}}),Object.defineProperty(this,v,{get:t}),Object.defineProperties(this,{active:{get:r},poolId:{get:n},resource:{get:o},type:{get:i},id:{get:s}})}function t(){return this.toJSON()}function r(){return Boolean(this[E].active)}function n(){return this[E].poolId}function o(){return this[E].resource}function i(){return this[E].type||typeof this[E].resource}function s(){return this[E].id}function u(){var e={};return e[v]={id:this[E].id,type:this.type,poolId:this.poolId},e}function a(){var e=this[E].id,t=this[E].pool;if(this[E].active){this[E].active=!1,t.remove(e);for(var r in this[E])delete this[E][r]}}function c(t,r,n,o){return new e(t,r,n,o||O())}return e.prototype.toJSON=u,e.prototype.destroy=a,e.create=c,e}(),S=function(){function t(){this[y]=new Map,Object.defineProperties(this,{id:{value:O()}}),e.apply(this)}function r(e,r){var n=null;return t.isValidTarget(e)&&(this[y].has(e)?n=this[y].get(e):(n=D.create(this,e,r||typeof e),this[y].set(n.id,n),this[y].set(e,n),this.hasEventListener(d.RESOURCE_ADDED)&&this.dispatchEvent(d.RESOURCE_ADDED,n))),n}function n(e){return this[y].has(e)}function o(e){return this[y].get(e)}function i(e){var t=this[y].get(e);t&&(this[y]["delete"](t.id),this[y]["delete"](t.resource),this.hasEventListener(d.RESOURCE_REMOVED)&&this.dispatchEvent(d.RESOURCE_REMOVED,t),t.destroy())}function s(){this.hasEventListener(d.POOL_CLEAR)&&this.dispatchEvent(d.POOL_CLEAR,this);for(var e,t=this[y].keys();!(e=t.next()).done;)if("string"==typeof e.value){var r=this[y].get(e.value);r.destroy()}this[y].clear(),this.hasEventListener(d.POOL_CLEARED)&&this.dispatchEvent(d.POOL_CLEARED,this)}function u(){return Boolean(this[y])}function a(){this.clear(),delete this[y],this.hasEventListener(d.POOL_DESTROYED)&&this.dispatchEvent(d.POOL_DESTROYED,this)}function c(e){return!l(e)&&Boolean(E[typeof e])}function h(e){E={};for(var t=e.length,r=0;t>r;r++)E[e[r]]=!0}function f(){return["object","function"]}function p(){return new t}var d=Object.freeze({RESOURCE_ADDED:"resourceAdded",RESOURCE_REMOVED:"resourceRemoved",POOL_CLEAR:"poolClear",POOL_CLEARED:"poolCleared",POOL_DESTROYED:"poolDestroyed"}),y=Symbol("ResourcePool::map"),E={};return t.prototype=e.createNoInitPrototype(),t.prototype.constructor=t,t.prototype.set=r,t.prototype.has=n,t.prototype.get=o,t.prototype.remove=i,t.prototype.clear=s,t.prototype.isActive=u,t.prototype.destroy=a,t.isValidTarget=c,t.setValidTargets=h,t.getDefaultValidTargets=f,t.create=p,t.Events=d,t.setValidTargets(t.getDefaultValidTargets()),t}(),T=function(){function t(e){this.remove(e.data)}function r(){S.apply(this),this.destroy=function(){throw new Error("Default ResourcePool cannot be destroyed.")}}function n(){Object.defineProperty(this,h,{value:{}}),e.apply(this),this._poolDestroyedListener=t.bind(this),this.register(n.defaultResourcePool)}function o(){var e=S.create();return this.hasEventListener(l.RESOURCE_POOL_CREATED)&&this.dispatchEvent(l.RESOURCE_POOL_CREATED,e),this.register(e),e}function i(e){this[h].hasOwnProperty(e.id)||(this[h][e.id]=e,e.addEventListener(S.Events.POOL_DESTROYED,this._poolDestroyedListener),this.hasEventListener(l.RESOURCE_POOL_REGISTERED)&&this.dispatchEvent(l.RESOURCE_POOL_REGISTERED,e))}function s(e){return this[h][e]||null}function u(e){return this[h].hasOwnProperty(e instanceof S?e.id:String(e))}function a(e){var t=!1;return e=e instanceof S?e:this.get(e),e&&(e.removeEventListener(S.Events.POOL_DESTROYED,this._poolDestroyedListener),t=delete this[h][e.id]),this.hasEventListener(l.RESOURCE_POOL_REMOVED)&&this.dispatchEvent(l.RESOURCE_POOL_REMOVED,e),t}function c(){return new n}var l=Object.freeze({RESOURCE_POOL_CREATED:"resourcePoolCreated",RESOURCE_POOL_REGISTERED:"resourcePoolRegistered",RESOURCE_POOL_REMOVED:"resourcePoolRemoved"}),h=Symbol("resource.pool.registry::pools");return r.prototype=S.prototype,n.prototype=e.createNoInitPrototype(),n.prototype.constructor=n,n.prototype.createPool=o,n.prototype.register=i,n.prototype.get=s,n.prototype.isRegistered=u,n.prototype.remove=a,n.create=c,n.Events=l,n.defaultResourcePool=new r,n}(),C=function(){function t(t,r,n,o){this[y]=t,this[v]=n,this[E]=r,e.apply(this),o&&o.setConverter(this)}function r(e){var t;return t=h(e)?o(e,this[v]):"function"==typeof e.toJSON?e.toJSON():e,t!==e&&this.hasEventListener(O.RESOURCE_CONVERTED)&&this.dispatchEvent(O.RESOURCE_CONVERTED,{data:e,result:t}),t}function n(e){var t,r=e;if(l(e))if(t=u(e),this[E].isRegistered(t)){var n=this[E].get(t).get(s(e));n&&(r=n.resource)}else r=this[y].create(Promise.resolve(e));return r!==e&&this.hasEventListener(O.RESOURCE_CREATED)&&this.dispatchEvent(O.RESOURCE_CREATED,{data:e,result:r}),r}function i(e,t){for(var r=[],n=e.length,o=0;n>o;o++)r[o]=t.call(this,e[o]);return r}function a(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=t.call(this,e[n]));return r}function c(e){var t=e;return void 0!==e&&null!==e&&(h(e)?t=this.resourceToObject(e):e instanceof Array?t=this.lookupArray(e,this.resourceToObject):e.constructor===Object&&(t=this.lookupObject(e,this.resourceToObject))),t}function f(e){var t=e;return void 0!==e&&null!==e&&(l(e)?t=this.objectToResource(e):e instanceof Array?t=this.lookupArray(e,this.objectToResource):e.constructor===Object&&(t=this.lookupObject(e,this.objectToResource))),t}function p(e){function t(e){return k.isPending(e)&&r.push(e),e}var r=[];return"object"==typeof e&&null!==e&&(k.isPending(e)?r.push(e):e instanceof Array?this.lookupArray(e,t):e.constructor===Object&&this.lookupObject(e,t)),r}function d(e,r,n,o){return new t(e,r,n,o)}var y=Symbol("resource.converter::factory"),E=Symbol("resource.converter::resourcePoolRegistry"),v=Symbol("resource.converter::resourcePool"),O=Object.freeze({RESOURCE_CREATED:"resourceCreated",RESOURCE_CONVERTED:"resourceConverted"});return t.prototype=e.createNoInitPrototype(),t.prototype.constructor=t,t.prototype.toJSON=c,t.prototype.parse=f,t.prototype.lookupArray=i,t.prototype.lookupObject=a,t.prototype.lookupForPending=p,t.prototype.resourceToObject=r,t.prototype.objectToResource=n,t.create=d,t.Events=O,t}(),j=function(){function e(n){function o(e){p=e}function i(t){E={},e.filterHandlers(t,E),d=Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E)),y=r(E,d),n&&e.areProxyHandlersAvailable(E,!0)}function s(e){return E.hasOwnProperty(e)}function u(){return E}function a(){return d.slice()}function c(){return y.slice()}function l(e){return E[e]||null}function h(e,t,r,n,o){var i=p?p.lookupForPending(r.value):null;i&&i.length?Promise.all(i).then(function(){f(e,t,r,n,o)}):f(e,t,r,n,o)}function f(e,t,r,n,o){var i=l(t);if(!(i instanceof R))throw new Error('Command descriptor for "'+t+'" was not found.');i.handle(e,r,n,o)}var p,d=[],y=[],E={};n=Boolean(n),Object.defineProperties(this,{proxyEnabled:{value:n},available:{get:function(){return Boolean(d.length)}}}),this.setConverter=o,this.setHandlers=i,this.hasHandler=s,this.getHandlers=u,this.getHandlerNames=a,this.getPropertyNames=c,this.getHandler=l,this.handle=h,this[Symbol.iterator]=function(){return new t(this.getHandlers(),this.getPropertyNames())}}function t(e,t){function r(){var r;return r=++o>=n?{done:!0}:{value:e[t[o]],done:!1}}var n=t.length,o=-1;this.next=r,this[Symbol.iterator]=function(){return this}.bind(this)}function r(e,t){for(var r=[],n=t.length,o=0;n>o;o++){var i=t[o];e[i].virtual||r.push(i)}return r}function n(t){return new e(t)}function o(e,t){for(var r=!0,n=b.required,o=n.length,i=0;o>i;i++){var s=n[i];if(!(b.fields[s]in e)&&(r=!1,t))throw new Error('For Proxy interface, handler "'+s+'" should be set.')}return r}var i=Object.freeze({HANDLERS_UPDATED:"handlersUpdated"}),s=function(){function e(e,t){for(var n=e.length,o=0;n>o;o++){var i=e[o];i instanceof R&&r(i,t)}}function t(e,t){if(e)for(var n=Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)),o=n.length,i=0;o>i;i++){var s=n[i],u=e[s];"function"==typeof u&&(u=R.create(s,u)),u instanceof R&&r(u,t)}}function r(e,t){var r=e.name;if(r in m.names)throw new Error('Name "'+r+'" is reserved and cannot be used in descriptor.');if(t.hasOwnProperty(r)&&t[r]instanceof R)throw new Error('Field names should be unique, "'+String(r)+'" field has duplicates.');t[r]=e}function n(r,n){r instanceof Array?e(r,n):t(r,n)}return n}();return e.filterHandlers=s,e.areProxyHandlersAvailable=o,e.create=n,e.Events=i,e}(),w=function(){function e(){function e(e){var t=e.name;return u.has(t)||u.set(t,r(e.name,e.type,e.isTemporary,e.cacheable)),u.get(t)}function r(e,t,r,i){function u(u,a){var c,l;if(this[E]){var h=I.createRequestPackage(t,arguments,this[E].id),f=n(e,h,i);c=f.child,f.deferred&&(l=this[E].sendRequest(e,h,f.deferred,c),l||(c=null),l=o(l,r,this,c,h))}else l=Promise.reject(new Error("Target object is not a resource, so cannot be used for calls."));return c||s.create(l)}return u}function n(e,r,n){var o,i;return n&&(o=s.getCached(e,r)),o||(i=t(),o=n?s.createCached(i.promise,e,r):s.create(i.promise,e,r)),{child:o,deferred:i}}function o(e,t,r,n,o){return e?e.then(function(e){k.setTemporary(n,Boolean(t(r,n,o,e)))}):e=Promise.reject(new Error("Initial request failed and didn't result in promise.")),e}function i(e){s=e}var s,u=new Map;this.get=e,this.setFactory=i}return e}(),_=function(){function e(e,t){function r(e){if(t.available){for(var r,n=t[Symbol.iterator]();!(r=n.next()).done;){var i=r.value;e[i.name]=o.get(i)}return e}}function n(e){e&&o.setFactory(e)}var o=new w;o.setFactory(e),this.apply=r,this.setFactory=n}function t(t,r){return new e(t,r)}return e.create=t,e}(),L=Symbol("request.factory::decorator"),q=Symbol("request.factory::handlers"),A=function(){function e(e,t){e!==s&&(this[q]=e,this[L]=_.create(this,e),Object.defineProperties(this,{cache:{value:t||null}}))}function t(e){var t=k.create(e,this[q]);return this[q].available&&this[L].apply(t),t}function r(e,t){return this.cache&&this.cache.get(e,t)}function n(e,t,r){var n=null;return this.cache&&(n=this.create(e),this.cache.set(t,r,n)),n}function o(t,r){return new e(t,r)}function i(){return new e(s)}var s={};return e.prototype.create=t,e.prototype.getCached=r,e.prototype.createCached=n,e.create=o,e.createNoInitProtoype=i,e}(),N=function(){function e(e,t){function r(){}return r.target=e,new Proxy(r,t)}function t(e,t,r){var n,o=e.target;return n=t in o||t in y||"symbol"==typeof t?o[t]=r:o[b.fields.set](t,r)}function r(e,t){return e.target.hasOwnProperty(t)}function n(e,t){var r=!1,n=e.target;return b.fields.deleteProperty in n&&(n[b.fields.deleteProperty](t),r=!0),r}function o(){return Object.getOwnPropertyNames(y)}function i(){return Object.getOwnPropertyNames(y)[Symbol.iterator]()}function s(e,t){var r;return r=y.hasOwnProperty(t)?Object.getOwnPropertyDescriptor(e,t):Object.getOwnPropertyDescriptor(e.target,t)}function u(){function e(e,t){var r,n=e.target;return r=t in n||t in y||"symbol"==typeof t?n[t]:n[b.fields.get](t)}function u(e,t,r){return e.target[b.fields.apply](null,r)}var a;return a={get:e,apply:u,set:t,has:r,deleteProperty:n,ownKeys:o,enumerate:i,getOwnPropertyDescriptor:s}}function a(e,t){this[q]=e,this[d]=A.create(e,t),this[d][L].setFactory(this)}function c(t){var r=this[d].create(t);return this[q].available&&(r=e(r,E)),r}function l(e,t){return this[d].getCached(e,t)}function h(t,r,n){var o=this[d].createCached(t,r,n);return this[q].available&&(o=e(o,E)),o}function f(t){return e(t,E)}function p(e,t){return new a(e,t)}var d=Symbol("request.proxy.factory::factory"),y={arguments:!0,caller:!0,prototype:!0},E=u();return a.prototype=A.createNoInitProtoype(),a.prototype.constructor=a,a.prototype.create=c,a.prototype.getCached=l,a.prototype.createCached=h,a.create=p,a.applyProxy=f,a}(),I=function(){function e(e,i,a){this.requestHandlers=a,this.requestTarget=e,this.link={},this.temporary,this.hadChildPromises=!1,this.status=y.PENDING,this.queue=[],this.children=[],this._deferred=t(),this.promise=this._deferred.promise,Object.defineProperties(this,{poolId:{get:r},type:{get:n},id:{get:o}}),i.then(s.bind(this),u.bind(this))}function r(){return this.link.poolId||null}function n(){return this.link.type||null}function o(){return this.link.id||null}function s(e){this.status=y.RESOLVED,l(e)?(this.link=i(e),e={target:this.requestTarget},this._sendQueue(),this.temporary&&this.destroy()):this._rejectQueue("Target of the call is not a resource and call cannot be sent."),this._deferred.resolve(e),delete this._deferred}function u(e){this.status=y.REJECTED,this._rejectQueue("Target of the call was rejected and call cannot be sent."),this._deferred.reject(e),delete this._deferred}function a(){for(;this.queue&&this.queue.length;){var e=this.queue.shift(),t=e[0],r=e[1],n=e[2],o=e[3];r.target=this.link.id,this._handleRequest(t,r,n,o)}this.queue=null}function c(e){for(var t=new Error(e||"This request was rejected before sending.");this.queue&&this.queue.length;){var r=this.queue.shift();r[2].reject(t)}this.queue=null}function h(e,r,n,o){var i=null;if(!this.requestHandlers.hasHandler(e))throw new Error('Request handler for "'+e+'" is not registered.');return i=this._applyRequest(e,r,n||t(),o),o&&this.registerChild(o),i}function f(e,t,r,n){this.queue.push([e,t,r,n])}function p(e,t,r,n){var o=r.promise;switch(this.status){case y.PENDING:this._addToQueue(e,t,r,n);break;case y.REJECTED:o=Promise.reject(new Error("Target object was rejected and cannot be used for calls."));break;case y.DESTROYED:o=Promise.reject(new Error("Target object was destroyed and cannot be used for calls."));break;case y.RESOLVED:this._handleRequest(e,t,r,n)}return o}function d(e,t,r,n){this.requestHandlers.handle(this.requestTarget,e,t,r,n)}function E(e){var t=O.bind(this,e),r=k.getRawPromise(e);this.children.push(e),r.then(t,t)}function O(e){if(this.children){var t=this.children.indexOf(e);t>=0&&this.children.splice(t,1)}}function g(){return this.status===y.PENDING||this.status===y.RESOLVED}function R(){return this.status===y.RESOLVED||this.status===y.REJECTED}function b(){var t=null;return this.canBeDestroyed()?(t=this.status===y.RESOLVED?this.sendRequest(P.fields.DESTROY,e.createRequestPackage(P.DESTROY,[null,null],this.id)):Promise.resolve(),this.status=y.DESTROYED):t=Promise.reject(new Error("Invalid or already destroyed target.")),t}function m(){var e=this.promise.then.apply(this.promise,arguments);return e&&(this.hadChildPromises=!0),e}function D(){var e=this.promise["catch"].apply(this.promise,arguments);return e&&(this.hadChildPromises=!0),e}function S(){var e={};return e[v]={id:this.link.id,type:this.link.type,poolId:this.link.poolId},e}function T(e,t,r){var n={type:e,cmd:t[0],value:t[1],target:r};return Object.defineProperty(n,"args",{value:t}),n}return e.prototype._sendQueue=a,e.prototype._rejectQueue=c,e.prototype.sendRequest=h,e.prototype._addToQueue=f,e.prototype._applyRequest=p,e.prototype._handleRequest=d,e.prototype.registerChild=E,e.prototype.isActive=g,e.prototype.canBeDestroyed=R,e.prototype.destroy=b,e.prototype.then=m,e.prototype["catch"]=D,e.prototype.toJSON=S,e.createRequestPackage=T,e}(),k=function(){function e(e,r){var n;Object.defineProperty(this,E,{value:new I(this,e,r),configurable:!0}),n=t.bind(this,e),e.then(n,n)}function t(e,t){l(t)||(this[m]=e,delete this[E])}function r(){var e=this[E]||this[m];e.then.apply(e,arguments)}function n(){var e=this[E]||this[m];e["catch"].apply(e,arguments)}function o(e){return e&&e[E]?e[E].isActive():!1}function i(e){return e&&e[E]?e[E].canBeDestroyed():!1}function s(e){return e&&e[E]?e[E].destroy():null}function u(e){return e&&e[E]?e[E].toJSON():null}function a(e){return f(e)==y.PENDING}function c(e){return e&&e[E]&&e[E].temporary}function h(e,t){e&&e[E]&&(e[E].temporary=Boolean(t))}function f(e){return e&&e[E]?e[E].status:null}function p(e){var t=e&&e[E]?e[E].queue:null;return t?t.length:0}function d(e){var t,r=[],n=e&&e[E]?e[E].queue:null;if(n){t=n.length;for(var o=0;t>o;o++)r.push(n[o][0].type)}return r}function v(e){return Boolean(e&&e[E]&&e[E].hadChildPromises)}function O(e){return e&&e[E]?e[E].promise:null}function g(e){var t=e&&e[E]?e[E].children:null;return t?t.slice():[]}function R(e){var t=e&&e[E]?e[E].children:null;return t&&t.length?t[t.length-1]:null}function P(e){var t=e&&e[E]?e[E].children:null;return t?t.length:0}function b(t,r){return new e(t,r)}var m=Symbol("request.target::promise");return e.prototype.then=r,e.prototype["catch"]=n,e.isActive=o,e.canBeDestroyed=i,e.destroy=s,e.toJSON=u,e.isPending=a,e.isTemporary=c,e.setTemporary=h,e.getStatus=f,e.getQueueLength=p,e.getQueueCommands=d,e.hadChildPromises=v,e.getRawPromise=O,e.getChildren=g,e.getLastChild=R,e.getChildrenCount=P,e.create=b,e}(),Y=function(){function e(e,t,n,o,i){function s(){o.removeEventListener(S.Events.POOL_DESTROYED,s),o=n.createPool(),o.addEventListener(S.Events.POOL_DESTROYED,s)}if(t=Boolean(t),t&&!r())throw new Error("Proxies are not available in this environment");var u=j.create(t),a=(t?N:A).create(u,i);n=n||T.create(),o?n.register(o):o=void 0!==o?n.createPool():T.defaultResourcePool,Object.defineProperties(this,{poolRegistry:{value:n},pool:{get:function(){return o}},resourceConverter:{value:C.create(a,n,o,u)},factory:{value:a},proxyEnabled:{get:function(){return u.proxyEnabled}}}),u.setHandlers(e),o.addEventListener(S.Events.POOL_DESTROYED,s)}function p(e){return this.resourceConverter.parse(e)}function d(e){return this.resourceConverter.toJSON(e)}function y(e){var t,r;return l(e)&&(r=this.poolRegistry.get(u(e)),t=r&&r.has(s(e))),t}function E(t,r,n,o,i){return new e(t,r,n,o,i)}return e.prototype.parse=p,e.prototype.toJSON=d,e.prototype.isOwnResource=y,e.create=E,e.createDeferred=t,e.IConvertible=n,e.RequestTarget=k,e.Deferred=g,e.CommandDescriptor=R,e.ResourcePool=S,e.ResourcePoolRegistry=T,e.ResourceConverter=C,e.Reserved=m,e.RequestTargetCommands=P,e.ProxyCommands=b,e.getRAWResource=o,e.getResourceData=i,e.getResourceId=s,e.getResourcePoolId=u,e.getResourceType=a,e.createForeignResource=c,e.isResource=l,e.isResourceConvertible=h,e.areSameResource=f,e}();return Y}();return t});