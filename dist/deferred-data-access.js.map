{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 5c9fc618e10e65bf8ccf","webpack:///./source/utils.js","webpack:///./source/resource/utils/index.js","webpack:///./source/request/RequestTarget.js","webpack:///./source/request/index.js","webpack:///./source/resource/index.js","webpack:///./source/request/utils/index.js","webpack:///./source/commands/index.js","webpack:///./source/commands/CommandDescriptor.js","webpack:///./source/commands/ProxyCommands.js","webpack:///./source/resource/ResourcePool.js","webpack:///./node_modules/event-dispatcher/dist/event-dispatcher.js","webpack:///./source/resource/TargetResource.js","webpack:///./source/commands/CommandHandlerFactory.js","webpack:///./source/resource/utils/defaultResourcePool.js","webpack:///./source/resource/utils/IConvertible.js","webpack:///./source/resource/utils/resourceUtils.js","webpack:///./source/request/RequestTargetInternals.js","webpack:///./source/commands/RequestTargetCommands.js","webpack:///./source/request/RequestTargetDecorator.js","webpack:///./source/request/RequestFactory.js","webpack:///./source/index.js","webpack:///./source/DataAccessInterface.js","webpack:///./source/request/utils/createRequestPackage.js","webpack:///./source/request/utils/filterRequestHandlers.js","webpack:///./source/resource/ResourceConverter.js","webpack:///./source/resource/ResourcePoolRegistry.js","webpack:///./source/commands/Reserved.js","webpack:///./source/request/RequestHandlers.js","webpack:///./source/request/RequestProxyFactory.js"],"names":["TargetStatus","Object","freeze","PENDING","RESOLVED","REJECTED","DESTROYED","TARGET_INTERNALS","Symbol","TARGET_DATA","getId","base","Date","now","index","Deferred","promise","Promise","resolve","reject","createDeferred","areProxiesAvailable","Proxy","defaultResourcePool","IConvertible","isResourceConvertible","getResourceType","isResource","areSameResource","createForeignResource","getRawResource","getResourceData","getResourceId","getResourcePoolId","PROMISE_FIELD","getRequestPromise","request","RequestTarget","requestHandlers","handlePromise","data","then","target","catch","isActive","canBeDestroyed","destroy","toJSON","isTemporary","temporary","setTemporary","value","Boolean","getStatus","status","isPending","getQueueLength","list","queue","length","getQueueCommands","result","push","type","hadChildPromises","getRawPromise","getRequestChildren","children","getChildren","getLastChild","getChildrenCount","sendRequest","createRequestTarget","createRequestPackage","RequestTargetInternals","RequestTargetDecorator","createRequestTargetDecorator","RequestFactory","createRequestFactory","RequestHandlers","createRequestHandlers","RequestProxyFactory","createRequestProxyFactory","ResourcePool","createResourcePool","ResourcePoolEvents","TargetResource","createTargetResource","ResourceConverter","createResourceConverter","ResourceConverterEvents","ResourcePoolRegistry","createResourcePoolRegistry","ResourcePoolRegistryEvents","filterRequestHandlers","CommandDescriptor","createCommandDescriptor","createDescriptors","CommandHandlerFactory","ProxyCommands","ProxyCommandNames","ProxyCommandFields","Reserved","RequestTargetCommands","RequestTargetCommandNames","RequestTargetCommandFields","handler","name","undefined","cacheable","virtual","resourceType","command","descriptor","addDescriptorTo","Array","descriptorGeneratorFactory","handlers","field","Function","GET","SET","APPLY","DELETE_PROPERTY","get","set","apply","deleteProperty","createGETDescriptor","createSETDescriptor","createAPPLYDescriptor","RESOURCE_ADDED","RESOURCE_REMOVED","POOL_CLEAR","POOL_CLEARED","POOL_DESTROYED","MAP_FIELD","validTargets","isValidTarget","setValidTargets","getDefaultValidTargets","Map","defineProperties","id","link","has","hasEventListener","dispatchEvent","delete","resource","key","keys","next","done","clear","getPoolId","pool","poolId","active","internals","remove","createCommandHandlerFor","factoryWrapper","propertyName","commandType","factory","checkState","getChildRequest","commandHandler","args","pack","child","deferred","Error","create","members","getCached","createCached","isTemporaryFn","parentRequest","childRequest","setFactory","DefaultResourcePool","object","resource1","resource2","requestTarget","handlePromiseResolve","sendQueue","rejectQueue","handlePromiseReject","shift","handleRequest","message","error","hasHandler","applyRequest","registerChild","addToQueue","handle","childRequestTarget","handleChildRequest","indexOf","splice","DESTROY","handleResolve","handleReject","createDESTROYDescriptor","available","iterator","getHandlers","FACTORY_DECORATOR_FIELD","FACTORY_HANDLERS_FIELD","cacheImpl","noInit","cache","dummy","DataAccessInterface","descriptors","proxyEnabled","poolRegistry","initialize","resourceConverter","register","createPool","poolDestroyedHandler","removeEventListener","addEventListener","setHandlers","parse","api","targetId","cmd","defineProperty","applyDescriptor","properties","names","prototype","hasOwnProperty","call","String","filterArray","filterHash","getOwnPropertyNames","concat","getOwnPropertySymbols","RESOURCE_CREATED","RESOURCE_CONVERTED","registry","setConverter","isRegistered","linkConvertHandler","property","resourceToObject","lookupArray","constructor","lookupObject","objectToResource","add","RESOURCE_POOL_CREATED","RESOURCE_POOL_REGISTERED","RESOURCE_POOL_REMOVED","POOLS_FIELD","event","handlePoolDestroyed","Events","DEFAULT_KEY","areProxyHandlersAvailable","throwError","required","RequestHandlersEvents","HANDLERS_UPDATED","converter","setHandlersByType","forEach","descrs","props","resultRequest","lookupForPending","all","handleImmediately","getHandler","nonEmptyList","find","item","FACTORY_FIELD","EXCLUSIONS","arguments","caller","wrapWithProxy","requestTargetProxy","proxyGet","wrapper","proxyApply","thisValue","proxySet","proxyHas","proxyDeleteProperty","proxyOwnKeys","proxyEnumerate","proxyGetOwnPropertyDescriptor","getOwnPropertyDescriptor","createProxyHandlers","ownKeys","enumerate","PROXY_HANDLERS","instance","applyProxyWithDefaultHandlers"],"mappings":"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ACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,0BAA0B,EAAE;AAC/D,yCAAyC,eAAe;AACxD;AACA;AACA;AACA;AACA;AACA,8DAA8D,+DAA+D;AAC7H;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA,CAAC;AACD;;AAEA;;AAEA;;AAEA,sCAAsC,uCAAuC,gBAAgB;;AAE7F;AACA;;AAEA,OAAO;AACP;AACA;;AAEA;;;AAGA;AACA;AACA,CAAC;;AAED,oGAAoG,mBAAmB,EAAE,mBAAmB,8HAA8H;;AAE1Q,gCAAgC,2CAA2C,gBAAgB,kBAAkB,OAAO,2BAA2B,wDAAwD,gCAAgC,uDAAuD,2DAA2D,EAAE,EAAE,yDAAyD,qEAAqE,6DAA6D,oBAAoB,GAAG,EAAE;;AAEjjB,iDAAiD,0CAA0C,0DAA0D,EAAE;;AAEvJ;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc;AACd;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,CAAC;;AAED;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAA0B,+BAA+B;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,CAAC;;AAED;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA,2BAA2B,gBAAgB;AAC3C;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA,2BAA2B,gBAAgB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,CAAC;;AAED;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;;AAEA,GAAG;;AAEH;AACA,CAAC;;AAED;;AAEA;;AAEA,OAAO;AACP;AACA,CAAC;AACD,4C;;;;;;;;;;;;;;;;;;ACjcA;;;;;;AAEA,IAAMwE,YAAY,SAAZA,SAAY,CAACC,IAAD;AAAA,SAAWA,OAAOA,KAAKb,EAAZ,GAAiB,IAA5B;AAAA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","file":"deferred-data-access.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DataAccessInterface\"] = factory();\n\telse\n\t\troot[\"DataAccessInterface\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"http://localhost:8081/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 20);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5c9fc618e10e65bf8ccf","export const TargetStatus = Object.freeze({\r\n  PENDING: 'pending',\r\n  RESOLVED: 'resolved',\r\n  REJECTED: 'rejected',\r\n  DESTROYED: 'destroyed',\r\n});\r\n\r\n/**\r\n * @type {Symbol}\r\n * @private\r\n */\r\nexport const TARGET_INTERNALS = Symbol('request.target:internals');\r\n/**\r\n *\r\n * @type {string}\r\n * @private\r\n */\r\nexport const TARGET_DATA = 'resource::data';\r\n\r\n/**\r\n * @private\r\n */\r\nexport const getId = (() => {\r\n  const base = `DA/${Date.now()}/`;\r\n  let index = 0;\r\n  return () => `${base}${++index}/${Date.now()}`;\r\n})();\r\n\r\n/**\r\n * @constructor\r\n * @alias DataAccessInterface.Deferred\r\n */\r\nexport class Deferred {\r\n  constructor() {\r\n    this.promise = new Promise((resolve, reject) => {\r\n      this.resolve = resolve;\r\n      this.reject = reject;\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * @returns {Deferred}\r\n * @private\r\n */\r\nexport const createDeferred = () => new Deferred();\r\n\r\n/**\r\n * @returns {boolean}\r\n * @private\r\n */\r\nexport const areProxiesAvailable = () => (typeof Proxy === 'function');\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/utils.js","import defaultResourcePool from './defaultResourcePool';\r\nimport IConvertible, { isResourceConvertible } from './IConvertible';\r\nimport {\r\n  getResourceType,\r\n  isResource,\r\n  areSameResource,\r\n  createForeignResource,\r\n  getRawResource,\r\n  getResourceData,\r\n  getResourceId,\r\n  getResourcePoolId,\r\n} from './resourceUtils';\r\n\r\nexport {\r\n  defaultResourcePool,\r\n  IConvertible,\r\n  isResourceConvertible,\r\n  getResourceType,\r\n  isResource,\r\n  areSameResource,\r\n  createForeignResource,\r\n  getRawResource,\r\n  getResourceData,\r\n  getResourceId,\r\n  getResourcePoolId,\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/resource/utils/index.js","import { TargetStatus, TARGET_INTERNALS } from '../utils';\r\nimport { isResource } from '../resource';\r\nimport RequestTargetInternals from './RequestTargetInternals';\r\n\r\nconst PROMISE_FIELD = Symbol('request.target::promise');\r\n\r\nconst getRequestPromise = (request) => (\r\n  request[TARGET_INTERNALS]\r\n  || request[PROMISE_FIELD]\r\n);\r\n\r\n/**\r\n * The object that will be available on other side\r\n * @class DataAccessInterface.RequestTarget\r\n * @param _promise {Promise}\r\n * @param _requestHandlers {RequestHandlers}\r\n */\r\nclass RequestTarget {\r\n  constructor(promise, requestHandlers) {\r\n    this[TARGET_INTERNALS] = new RequestTargetInternals(this, promise, requestHandlers);\r\n\r\n    const handlePromise = (data) => {\r\n      if (!isResource(data)) {\r\n        this[PROMISE_FIELD] = promise;\r\n        delete this[TARGET_INTERNALS];\r\n      }\r\n    };\r\n\r\n    promise.then(handlePromise, handlePromise);\r\n  }\r\n\r\n  then(...args) {\r\n    const target = getRequestPromise(this);\r\n    return target.then(...args);\r\n  }\r\n\r\n  catch(...args) {\r\n    const target = getRequestPromise(this);\r\n    return target.catch(...args);\r\n  }\r\n}\r\n\r\nexport const isActive = (target) => (\r\n  target\r\n  && target[TARGET_INTERNALS] ? target[TARGET_INTERNALS].isActive() : false\r\n);\r\n\r\nexport const canBeDestroyed = (target) => (\r\n  target\r\n  && target[TARGET_INTERNALS] ? target[TARGET_INTERNALS].canBeDestroyed() : false\r\n);\r\n\r\nexport const destroy = (target) => (\r\n  target &&\r\n  target[TARGET_INTERNALS] ? target[TARGET_INTERNALS].destroy() : null\r\n);\r\n\r\nexport const toJSON = (target) => (\r\n  target\r\n  && target[TARGET_INTERNALS] ? target[TARGET_INTERNALS].toJSON() : null\r\n);\r\n\r\nexport const isTemporary = (target) => (\r\n  target\r\n  && target[TARGET_INTERNALS] && target[TARGET_INTERNALS].temporary\r\n);\r\n\r\nexport const setTemporary = (target, value) => {\r\n  if (target && target[TARGET_INTERNALS]) {\r\n    target[TARGET_INTERNALS].temporary = Boolean(value);\r\n  }\r\n};\r\n\r\nexport const getStatus = (target) => (\r\n  target &&\r\n  target[TARGET_INTERNALS] ? target[TARGET_INTERNALS].status : ''\r\n);\r\n\r\nexport const isPending = (value) => (\r\n  getStatus(value) === TargetStatus.PENDING\r\n);\r\n\r\nexport const getQueueLength = (target) => {\r\n  const list = target && target[TARGET_INTERNALS] ? target[TARGET_INTERNALS].queue : null;\r\n  return list ? list.length : 0;\r\n};\r\n\r\nexport const getQueueCommands = (target) => {\r\n  const result = [];\r\n  const queue = target && target[TARGET_INTERNALS] ? target[TARGET_INTERNALS].queue : null;\r\n  if (queue) {\r\n    const { length } = queue;\r\n    // FIXME use Array.map()\r\n    for (let index = 0; index < length; index++) {\r\n      result.push(queue[index][0].type);\r\n    }\r\n  }\r\n  return result;\r\n};\r\n\r\nexport const hadChildPromises = (target) => Boolean(target\r\n  && target[TARGET_INTERNALS]\r\n  && target[TARGET_INTERNALS].hadChildPromises);\r\n\r\nexport const getRawPromise = (target) => (\r\n  target\r\n  && target[TARGET_INTERNALS] ? target[TARGET_INTERNALS].promise : null\r\n);\r\n\r\nconst getRequestChildren = (target) => (\r\n  target && target[TARGET_INTERNALS] ? target[TARGET_INTERNALS].children : null\r\n);\r\n\r\nexport const getChildren = (target) => {\r\n  const list = getRequestChildren(target);\r\n  return list ? [...list] : [];\r\n};\r\n\r\nexport const getLastChild = (target) => {\r\n  const list = getRequestChildren(target);\r\n  return list && list.length ? list[list.length - 1] : null;\r\n};\r\n\r\nexport const getChildrenCount = (target) => {\r\n  const list = getRequestChildren(target);\r\n  return list ? list.length : 0;\r\n};\r\n\r\n// FIXME Is it used? Why its similar to getChildrenCount()?\r\nexport const sendRequest = (target) => {\r\n  const list = getRequestChildren(target);\r\n  return list ? list.length : 0;\r\n};\r\n\r\nexport const createRequestTarget = (promise, requestHandlers) => (\r\n  new RequestTarget(promise, requestHandlers)\r\n);\r\n\r\nexport default RequestTarget;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/RequestTarget.js","import { createRequestPackage } from './utils';\r\nimport RequestTargetInternals from './RequestTargetInternals';\r\nimport RequestTarget, { createRequestTarget } from './RequestTarget';\r\nimport RequestTargetDecorator, { createRequestTargetDecorator } from './RequestTargetDecorator';\r\nimport RequestFactory, { createRequestFactory } from './RequestFactory';\r\nimport RequestHandlers, { createRequestHandlers } from './RequestHandlers';\r\nimport RequestProxyFactory, { createRequestProxyFactory } from './RequestProxyFactory';\r\n\r\nexport {\r\n  createRequestPackage,\r\n  RequestTargetInternals,\r\n  RequestTarget,\r\n  createRequestTarget,\r\n  RequestTargetDecorator,\r\n  createRequestTargetDecorator,\r\n  RequestFactory,\r\n  createRequestFactory,\r\n  RequestHandlers,\r\n  createRequestHandlers,\r\n  RequestProxyFactory,\r\n  createRequestProxyFactory,\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/index.js","import ResourcePool, {\r\n  createResourcePool,\r\n  ResourcePoolEvents,\r\n} from './ResourcePool';\r\nimport TargetResource, {\r\n  createTargetResource,\r\n} from './TargetResource';\r\nimport ResourceConverter, {\r\n  createResourceConverter,\r\n  ResourceConverterEvents,\r\n} from './ResourceConverter';\r\nimport ResourcePoolRegistry, {\r\n  createResourcePoolRegistry,\r\n  ResourcePoolRegistryEvents,\r\n} from './ResourcePoolRegistry';\r\n\r\nexport {\r\n  ResourcePool,\r\n  createResourcePool,\r\n  ResourcePoolEvents,\r\n  TargetResource,\r\n  createTargetResource,\r\n  ResourceConverter,\r\n  createResourceConverter,\r\n  ResourceConverterEvents,\r\n  ResourcePoolRegistry,\r\n  createResourcePoolRegistry,\r\n  ResourcePoolRegistryEvents,\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/resource/index.js","import createRequestPackage from './createRequestPackage';\r\nimport filterRequestHandlers from './filterRequestHandlers';\r\n\r\nexport {\r\n  createRequestPackage,\r\n  filterRequestHandlers,\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/utils/index.js","import CommandDescriptor, {\r\n  createCommandDescriptor,\r\n  createDescriptors,\r\n} from './CommandDescriptor';\r\nimport CommandHandlerFactory from './CommandHandlerFactory';\r\nimport ProxyCommands, {\r\n  ProxyCommandNames,\r\n  ProxyCommandFields,\r\n} from './ProxyCommands';\r\nimport Reserved from './Reserved';\r\nimport RequestTargetCommands, {\r\n  RequestTargetCommandNames,\r\n  RequestTargetCommandFields,\r\n} from './RequestTargetCommands';\r\n\r\nexport {\r\n  CommandDescriptor,\r\n  createCommandDescriptor,\r\n  createDescriptors,\r\n  CommandHandlerFactory,\r\n  ProxyCommands,\r\n  ProxyCommandNames,\r\n  ProxyCommandFields,\r\n  Reserved,\r\n  RequestTargetCommands,\r\n  RequestTargetCommandNames,\r\n  RequestTargetCommandFields,\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/commands/index.js","import ProxyCommands, { ProxyCommandFields } from './ProxyCommands';\r\n\r\nclass CommandDescriptor {\r\n  constructor(type, handler, name) {\r\n    this.name = name !== undefined ? name : type;\r\n    this.type = type;\r\n    this.handler = handler;\r\n    this.isTemporary = null;\r\n    this.cacheable = false;\r\n    this.virtual = false;\r\n    this.resourceType = null;\r\n  }\r\n}\r\n\r\nexport const createCommandDescriptor = (command, handler, name) => {\r\n  const descriptor = new CommandDescriptor(command, handler, name);\r\n  // We can use Object.freeze(), it keeps class/constructor information\r\n  return Object.freeze(descriptor);\r\n};\r\n\r\nexport const addDescriptorTo = (descriptor, target) => {\r\n  if (target instanceof Array) {\r\n    target.push(descriptor);\r\n  } else if (target) {\r\n    target[descriptor.name] = descriptor;\r\n  }\r\n};\r\n\r\nexport const descriptorGeneratorFactory = (command, name) =>\r\n  (handler, target, isTemporary, resourceType, cacheable) => {\r\n    const descriptor = new CommandDescriptor(command, handler, name);\r\n    descriptor.isTemporary = isTemporary;\r\n    descriptor.resourceType = resourceType;\r\n    descriptor.cacheable = cacheable;\r\n    addDescriptorTo(descriptor, target);\r\n    return Object.freeze(descriptor);\r\n  };\r\n\r\n\r\nexport const createDescriptors = (handlers, target, isTemporary, resourceType, cacheable) => {\r\n  const { list } = ProxyCommands;\r\n  const { length } = list;\r\n  target = target || {};\r\n  for (let index = 0; index < length; index++) {\r\n    const name = list[index];\r\n    const handler = handlers[name];\r\n    const field = ProxyCommandFields[name];\r\n\r\n    if (handler instanceof Function) {\r\n      let descriptor = new CommandDescriptor(name, handler, field);\r\n      descriptor.isTemporary = isTemporary;\r\n      descriptor.resourceType = resourceType;\r\n      descriptor.cacheable = cacheable;\r\n      descriptor = Object.freeze(descriptor);\r\n\r\n      if (target instanceof Array) {\r\n        target.push(descriptor);\r\n      } else if (target) {\r\n        target[field] = descriptor;\r\n      }\r\n    }\r\n  }\r\n  return target;\r\n};\r\n\r\nexport default CommandDescriptor;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/commands/CommandDescriptor.js","import { descriptorGeneratorFactory } from './CommandDescriptor';\r\n\r\nexport const ProxyCommandNames = Object.freeze({\r\n  GET: 'get',\r\n  SET: 'set',\r\n  APPLY: 'apply',\r\n  DELETE_PROPERTY: 'deleteProperty',\r\n});\r\n\r\nexport const ProxyCommandFields = Object.freeze({\r\n  get: Symbol('proxy.commands::get'),\r\n  set: Symbol('proxy.commands::set'),\r\n  apply: Symbol('proxy.commands::apply'),\r\n  deleteProperty: Symbol('proxy.commands::deleteProperty'),\r\n});\r\n\r\nclass ProxyCommands {\r\n  createGETDescriptor = descriptorGeneratorFactory(\r\n    ProxyCommandNames.GET,\r\n    ProxyCommandFields.get,\r\n  );\r\n  createSETDescriptor = descriptorGeneratorFactory(\r\n    ProxyCommandNames.SET,\r\n    ProxyCommandFields.set,\r\n  );\r\n  createAPPLYDescriptor = descriptorGeneratorFactory(\r\n    ProxyCommandNames.APPLY,\r\n    ProxyCommandFields.apply,\r\n  );\r\n\r\n  constructor() {\r\n    Object.freeze(this);\r\n  }\r\n\r\n  get list() {\r\n    return [\r\n      ProxyCommandNames.GET,\r\n      ProxyCommandNames.SET,\r\n      ProxyCommandNames.APPLY,\r\n      ProxyCommandNames.DELETE_PROPERTY,\r\n    ];\r\n  }\r\n\r\n  get required() {\r\n    return [\r\n      ProxyCommandFields.GET,\r\n      ProxyCommandFields.SET,\r\n      ProxyCommandFields.APPLY,\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new ProxyCommands();\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/commands/ProxyCommands.js","import EventDispatcher from 'event-dispatcher';\r\nimport { getId, isResource } from '../utils';\r\nimport { createTargetResource } from './TargetResource';\r\n\r\nexport const ResourcePoolEvents = Object.freeze({\r\n  RESOURCE_ADDED: 'resourceAdded',\r\n  RESOURCE_REMOVED: 'resourceRemoved',\r\n  POOL_CLEAR: 'poolClear',\r\n  POOL_CLEARED: 'poolCleared',\r\n  POOL_DESTROYED: 'poolDestroyed',\r\n});\r\n\r\nconst MAP_FIELD = Symbol('ResourcePool::map');\r\n\r\nlet validTargets = {};\r\n\r\nexport const isValidTarget = (target) => (\r\n  !isResource(target)\r\n  && Boolean(validTargets[typeof target])\r\n);\r\n\r\nexport const setValidTargets = (list) => {\r\n  validTargets = {};\r\n  const { length } = list;\r\n  for (let index = 0; index < length; index++) {\r\n    validTargets[list[index]] = true;\r\n  }\r\n};\r\n\r\nexport const getDefaultValidTargets = () => ['object', 'function'];\r\n\r\nclass ResourcePool extends EventDispatcher {\r\n  [MAP_FIELD] = new Map();\r\n\r\n  constructor() {\r\n    super();\r\n    Object.defineProperties(this, {\r\n      id: {\r\n        value: getId(),\r\n      },\r\n    });\r\n  }\r\n\r\n  set(target, type) {\r\n    let link = null;\r\n    if (isValidTarget(target)) {\r\n      if (this[MAP_FIELD].has(target)) {\r\n        link = this[MAP_FIELD].get(target);\r\n      } else {\r\n        link = createTargetResource(this, target, type || typeof target);\r\n        this[MAP_FIELD].set(link.id, link);\r\n        this[MAP_FIELD].set(target, link);\r\n        if (this.hasEventListener(ResourcePoolEvents.RESOURCE_ADDED)) {\r\n          this.dispatchEvent(ResourcePoolEvents.RESOURCE_ADDED, link);\r\n        }\r\n      }\r\n    }\r\n    return link;\r\n  }\r\n\r\n  has(target) {\r\n    return this[MAP_FIELD].has(target);\r\n  }\r\n\r\n  get(target) {\r\n    return this[MAP_FIELD].get(target);\r\n  }\r\n\r\n  remove(target) {\r\n    const link = this[MAP_FIELD].get(target);\r\n    if (link) {\r\n      this[MAP_FIELD].delete(link.id);\r\n      this[MAP_FIELD].delete(link.resource);\r\n      if (this.hasEventListener(ResourcePoolEvents.RESOURCE_REMOVED)) {\r\n        this.dispatchEvent(ResourcePoolEvents.RESOURCE_REMOVED, link);\r\n      }\r\n      link.destroy();\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    if (this.hasEventListener(ResourcePoolEvents.POOL_CLEAR)) {\r\n      this.dispatchEvent(ResourcePoolEvents.POOL_CLEAR, this);\r\n    }\r\n    let key;\r\n    const keys = this[MAP_FIELD].keys();\r\n    // FIXME update to for...of loop when it comes to browsers\r\n    while (!(key = keys.next()).done) {\r\n      if (typeof key.value === 'string') {\r\n        const link = this[MAP_FIELD].get(key.value);\r\n        link.destroy();\r\n      }\r\n    }\r\n    this[MAP_FIELD].clear();\r\n    if (this.hasEventListener(ResourcePoolEvents.POOL_CLEARED)) {\r\n      this.dispatchEvent(ResourcePoolEvents.POOL_CLEARED, this);\r\n    }\r\n  }\r\n\r\n  isActive() {\r\n    return Boolean(this[MAP_FIELD]);\r\n  }\r\n\r\n  destroy() {\r\n    this.clear();\r\n    // intentionally make it not usable after its destroyed\r\n    delete this[MAP_FIELD];\r\n    if (this.hasEventListener(ResourcePoolEvents.POOL_DESTROYED)) {\r\n      // FIXME why for second parameter?\r\n      this.dispatchEvent(ResourcePoolEvents.POOL_DESTROYED, this);\r\n    }\r\n  }\r\n}\r\n\r\nexport const createResourcePool = () => new ResourcePool();\r\n\r\nsetValidTargets(getDefaultValidTargets());\r\n\r\nexport default ResourcePool;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/resource/ResourcePool.js","(function webpackUniversalModuleDefinition(root, factory) {\r\n\tif(typeof exports === 'object' && typeof module === 'object')\r\n\t\tmodule.exports = factory();\r\n\telse if(typeof define === 'function' && define.amd)\r\n\t\tdefine([], factory);\r\n\telse if(typeof exports === 'object')\r\n\t\texports[\"EventDispatcher\"] = factory();\r\n\telse\r\n\t\troot[\"EventDispatcher\"] = factory();\r\n})(this, function() {\r\nreturn /******/ (function(modules) { // webpackBootstrap\r\n/******/ \t// The module cache\r\n/******/ \tvar installedModules = {};\r\n/******/\r\n/******/ \t// The require function\r\n/******/ \tfunction __webpack_require__(moduleId) {\r\n/******/\r\n/******/ \t\t// Check if module is in cache\r\n/******/ \t\tif(installedModules[moduleId]) {\r\n/******/ \t\t\treturn installedModules[moduleId].exports;\r\n/******/ \t\t}\r\n/******/ \t\t// Create a new module (and put it into the cache)\r\n/******/ \t\tvar module = installedModules[moduleId] = {\r\n/******/ \t\t\ti: moduleId,\r\n/******/ \t\t\tl: false,\r\n/******/ \t\t\texports: {}\r\n/******/ \t\t};\r\n/******/\r\n/******/ \t\t// Execute the module function\r\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\r\n/******/\r\n/******/ \t\t// Flag the module as loaded\r\n/******/ \t\tmodule.l = true;\r\n/******/\r\n/******/ \t\t// Return the exports of the module\r\n/******/ \t\treturn module.exports;\r\n/******/ \t}\r\n/******/\r\n/******/\r\n/******/ \t// expose the modules object (__webpack_modules__)\r\n/******/ \t__webpack_require__.m = modules;\r\n/******/\r\n/******/ \t// expose the module cache\r\n/******/ \t__webpack_require__.c = installedModules;\r\n/******/\r\n/******/ \t// define getter function for harmony exports\r\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\r\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\r\n/******/ \t\t\tObject.defineProperty(exports, name, {\r\n/******/ \t\t\t\tconfigurable: false,\r\n/******/ \t\t\t\tenumerable: true,\r\n/******/ \t\t\t\tget: getter\r\n/******/ \t\t\t});\r\n/******/ \t\t}\r\n/******/ \t};\r\n/******/\r\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\r\n/******/ \t__webpack_require__.n = function(module) {\r\n/******/ \t\tvar getter = module && module.__esModule ?\r\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\r\n/******/ \t\t\tfunction getModuleExports() { return module; };\r\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\r\n/******/ \t\treturn getter;\r\n/******/ \t};\r\n/******/\r\n/******/ \t// Object.prototype.hasOwnProperty.call\r\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\r\n/******/\r\n/******/ \t// __webpack_public_path__\r\n/******/ \t__webpack_require__.p = \"http://localhost:8081/dist/\";\r\n/******/\r\n/******/ \t// Load entry module and return exports\r\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\r\n/******/ })\r\n/************************************************************************/\r\n/******/ ([\r\n/* 0 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\nexports.Event = undefined;\r\n\r\nvar _EventDispatcher = __webpack_require__(1);\r\n\r\nvar _EventDispatcher2 = _interopRequireDefault(_EventDispatcher);\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\r\nexports.default = _EventDispatcher2.default;\r\nexports.Event = _EventDispatcher.Event;\r\n\r\n/***/ }),\r\n/* 1 */\r\n/***/ (function(module, exports, __webpack_require__) {\r\n\r\n\"use strict\";\r\n\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\r\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nvar hasOwnProp = function hasOwnProp(target, name) {\r\n  return Object.prototype.hasOwnProperty.call(target, name);\r\n}; /**\r\n    * Created by Oleg Galaburda on 09.02.16.\r\n    * \r\n    */\r\n\r\nvar Event = exports.Event = function () {\r\n  function Event(type, data) {\r\n    _classCallCheck(this, Event);\r\n\r\n    this.type = type;\r\n    this.data = data || null;\r\n    this.defaultPrevented = false;\r\n  }\r\n\r\n  _createClass(Event, [{\r\n    key: 'toJSON',\r\n    value: function toJSON() {\r\n      return { type: this.type, data: this.data };\r\n    }\r\n  }, {\r\n    key: 'isDefaultPrevented',\r\n    value: function isDefaultPrevented() {\r\n      return this.defaultPrevented;\r\n    }\r\n  }, {\r\n    key: 'preventDefault',\r\n    value: function preventDefault() {\r\n      this.defaultPrevented = true;\r\n    }\r\n  }]);\r\n\r\n  return Event;\r\n}();\r\n\r\nvar ListenersRunner = function () {\r\n  function ListenersRunner(listeners, onStopped, onComplete) {\r\n    var _this = this;\r\n\r\n    _classCallCheck(this, ListenersRunner);\r\n\r\n    this.index = -1;\r\n    this.immediatelyStopped = false;\r\n\r\n    this.stopImmediatePropagation = function () {\r\n      _this.immediatelyStopped = true;\r\n    };\r\n\r\n    this.listeners = listeners;\r\n    this.onStopped = onStopped;\r\n    this.onComplete = onComplete;\r\n  }\r\n\r\n  _createClass(ListenersRunner, [{\r\n    key: 'run',\r\n    value: function run(event, target) {\r\n      var listener = void 0;\r\n      var listeners = this.listeners;\r\n\r\n      this.augmentEvent(event);\r\n      // TODO this has to be handled in separate object ListenersRunner that should be\r\n      // created for each call() call and asked for index validation on each listener remove.\r\n      for (this.index = 0; this.index < listeners.length; this.index++) {\r\n        if (this.immediatelyStopped) break;\r\n        listener = listeners[this.index];\r\n        listener.call(target, event);\r\n      }\r\n      this.clearEvent(event);\r\n      this.onComplete(this);\r\n    }\r\n  }, {\r\n    key: 'augmentEvent',\r\n    value: function augmentEvent(eventObject) {\r\n      var event = eventObject;\r\n      event.stopPropagation = this.onStopped;\r\n      event.stopImmediatePropagation = this.stopImmediatePropagation;\r\n    }\r\n\r\n    /* eslint class-methods-use-this: \"off\" */\r\n\r\n  }, {\r\n    key: 'clearEvent',\r\n    value: function clearEvent(eventObject) {\r\n      var event = eventObject;\r\n      delete event.stopPropagation;\r\n      delete event.stopImmediatePropagation;\r\n    }\r\n  }, {\r\n    key: 'listenerRemoved',\r\n    value: function listenerRemoved(listeners, index) {\r\n      if (listeners === this.listeners && index <= this.index) {\r\n        this.index--;\r\n      }\r\n    }\r\n  }]);\r\n\r\n  return ListenersRunner;\r\n}();\r\n\r\nvar EventListeners = function () {\r\n  function EventListeners() {\r\n    var _this2 = this;\r\n\r\n    _classCallCheck(this, EventListeners);\r\n\r\n    this._listeners = {};\r\n    this._runners = [];\r\n\r\n    this.removeRunner = function (runner) {\r\n      _this2._runners.splice(_this2._runners.indexOf(runner), 1);\r\n    };\r\n  }\r\n  /**\r\n   * key - event Type\r\n   * value - hash of priorities\r\n   *    key - priority\r\n   *    value - list of handlers\r\n   * @type {Object<string, Object.<string, Array<number, Function>>>}\r\n   * @private\r\n   */\r\n\r\n\r\n  _createClass(EventListeners, [{\r\n    key: 'createList',\r\n    value: function createList(eventType, priorityOpt) {\r\n      var priority = parseInt(priorityOpt, 10);\r\n      var target = this.getPrioritiesByKey(eventType);\r\n      var key = String(priority);\r\n      var value = void 0;\r\n      if (hasOwnProp(target, key)) {\r\n        value = target[key];\r\n      } else {\r\n        value = [];\r\n        target[key] = value;\r\n      }\r\n      return value;\r\n    }\r\n  }, {\r\n    key: 'getPrioritiesByKey',\r\n    value: function getPrioritiesByKey(key) {\r\n      var value = void 0;\r\n      if (hasOwnProp(this._listeners, key)) {\r\n        value = this._listeners[key];\r\n      } else {\r\n        value = {};\r\n        this._listeners[key] = value;\r\n      }\r\n      return value;\r\n    }\r\n  }, {\r\n    key: 'add',\r\n    value: function add(eventType, handler, priority) {\r\n      var handlers = this.createList(eventType, priority);\r\n      if (handlers.indexOf(handler) < 0) {\r\n        handlers.push(handler);\r\n      }\r\n    }\r\n  }, {\r\n    key: 'has',\r\n    value: function has(eventType) {\r\n      var priority = void 0;\r\n      var result = false;\r\n      var priorities = this.getPrioritiesByKey(eventType);\r\n      if (priorities) {\r\n        for (priority in priorities) {\r\n          if (hasOwnProp(priorities, priority)) {\r\n            result = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      return result;\r\n    }\r\n  }, {\r\n    key: 'remove',\r\n    value: function remove(eventType, handler) {\r\n      var _this3 = this;\r\n\r\n      var priorities = this.getPrioritiesByKey(eventType);\r\n      if (priorities) {\r\n        var list = Object.getOwnPropertyNames(priorities);\r\n        var length = list.length;\r\n\r\n        var _loop = function _loop(index) {\r\n          var priority = list[index];\r\n          var handlers = priorities[priority];\r\n          var handlerIndex = handlers.indexOf(handler);\r\n          if (handlerIndex >= 0) {\r\n            handlers.splice(handlerIndex, 1);\r\n            if (!handlers.length) {\r\n              delete priorities[priority];\r\n            }\r\n            _this3._runners.forEach(function (runner) {\r\n              runner.listenerRemoved(handlers, handlerIndex);\r\n            });\r\n          }\r\n        };\r\n\r\n        for (var index = 0; index < length; index++) {\r\n          _loop(index);\r\n        }\r\n      }\r\n    }\r\n  }, {\r\n    key: 'removeAll',\r\n    value: function removeAll(eventType) {\r\n      delete this._listeners[eventType];\r\n    }\r\n  }, {\r\n    key: 'createRunner',\r\n    value: function createRunner(handlers, onStopped) {\r\n      var runner = new ListenersRunner(handlers, onStopped, this.removeRunner);\r\n      this._runners.push(runner);\r\n      return runner;\r\n    }\r\n  }, {\r\n    key: 'call',\r\n    value: function call(event, target) {\r\n      var priorities = this.getPrioritiesByKey(event.type);\r\n      var stopped = false;\r\n      var stopPropagation = function stopPropagation() {\r\n        stopped = true;\r\n      };\r\n      if (priorities) {\r\n        // getOwnPropertyNames() or keys()?\r\n        var list = Object.getOwnPropertyNames(priorities).sort(function (a, b) {\r\n          return a - b;\r\n        });\r\n        var length = list.length;\r\n\r\n        for (var index = 0; index < length; index++) {\r\n          if (stopped) break;\r\n          var _handlers = priorities[list[index]];\r\n          // in case if all handlers of priority were removed while event\r\n          // was dispatched and handlers become undefined.\r\n          if (_handlers) {\r\n            var _runner = this.createRunner(_handlers, stopPropagation);\r\n            _runner.run(event, target);\r\n            if (_runner.immediatelyStopped) break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }]);\r\n\r\n  return EventListeners;\r\n}();\r\n\r\nvar EventDispatcher = function () {\r\n  function EventDispatcher(eventPreprocessor) {\r\n    var noInit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\r\n\r\n    _classCallCheck(this, EventDispatcher);\r\n\r\n    if (!noInit) {\r\n      this.initialize(eventPreprocessor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n\r\n\r\n  _createClass(EventDispatcher, [{\r\n    key: 'initialize',\r\n    value: function initialize(eventPreprocessor) {\r\n      this._eventPreprocessor = eventPreprocessor;\r\n      this._listeners = new EventListeners();\r\n    }\r\n  }, {\r\n    key: 'addEventListener',\r\n    value: function addEventListener(eventType, listener) {\r\n      var priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\r\n\r\n      this._listeners.add(eventType, listener, -priority || 0);\r\n    }\r\n  }, {\r\n    key: 'hasEventListener',\r\n    value: function hasEventListener(eventType) {\r\n      return this._listeners.has(eventType);\r\n    }\r\n  }, {\r\n    key: 'removeEventListener',\r\n    value: function removeEventListener(eventType, listener) {\r\n      this._listeners.remove(eventType, listener);\r\n    }\r\n  }, {\r\n    key: 'removeAllEventListeners',\r\n    value: function removeAllEventListeners(eventType) {\r\n      this._listeners.removeAll(eventType);\r\n    }\r\n  }, {\r\n    key: 'dispatchEvent',\r\n    value: function dispatchEvent(event, data) {\r\n      var eventObject = EventDispatcher.getEvent(event, data);\r\n      if (this._eventPreprocessor) {\r\n        eventObject = this._eventPreprocessor.call(this, eventObject);\r\n      }\r\n      this._listeners.call(eventObject);\r\n    }\r\n  }], [{\r\n    key: 'isObject',\r\n    value: function isObject(value) {\r\n      return (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' && value !== null;\r\n    }\r\n  }, {\r\n    key: 'getEvent',\r\n    value: function getEvent(eventOrType, optionalData) {\r\n      var event = eventOrType;\r\n      if (!EventDispatcher.isObject(eventOrType)) {\r\n        event = new EventDispatcher.Event(String(eventOrType), optionalData);\r\n      }\r\n      return event;\r\n    }\r\n  }, {\r\n    key: 'create',\r\n    value: function create(eventPreprocessor) {\r\n      return new EventDispatcher(eventPreprocessor);\r\n    }\r\n\r\n    /* eslint no-undef: \"off\" */\r\n\r\n  }]);\r\n\r\n  return EventDispatcher;\r\n}();\r\n\r\nEventDispatcher.Event = Event;\r\n\r\nexports.default = EventDispatcher;\r\n\r\n/***/ })\r\n/******/ ]);\r\n});\r\n//# sourceMappingURL=event-dispatcher.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/event-dispatcher/dist/event-dispatcher.js\n// module id = 10\n// module chunks = 0","import { TARGET_DATA, TARGET_INTERNALS, getId } from '../utils';\r\n\r\nconst getPoolId = (pool) => (pool ? pool.id : null);\r\n\r\n/**\r\n * @exports TargetResource\r\n */\r\nclass TargetResource {\r\n  constructor(pool, resource, type, id) {\r\n    Object.defineProperties(this, {\r\n      [TARGET_INTERNALS]: {\r\n        value: {\r\n          pool,\r\n          resource,\r\n          type,\r\n          id,\r\n          active: true,\r\n          poolId: getPoolId(pool),\r\n        },\r\n      },\r\n      [TARGET_DATA]: {\r\n        get: this.toJSON,\r\n      },\r\n    });\r\n  }\r\n\r\n\r\n  get active() {\r\n    return Boolean(this[TARGET_INTERNALS].active);\r\n  }\r\n\r\n  get resource() {\r\n    return this[TARGET_INTERNALS].resource;\r\n  }\r\n\r\n  get type() {\r\n    return this[TARGET_INTERNALS].type || typeof this[TARGET_INTERNALS].resource;\r\n  }\r\n\r\n  get id() {\r\n    return this[TARGET_INTERNALS].id;\r\n  }\r\n\r\n  get poolId() {\r\n    return this[TARGET_INTERNALS].poolId;\r\n  }\r\n\r\n  toJSON = () => ({\r\n    [TARGET_DATA]: {\r\n      id: this.id,\r\n      type: this.type,\r\n      poolId: this.poolId,\r\n    },\r\n  });\r\n\r\n  destroy() {\r\n    const { id, pool } = this;\r\n    const internals = this[TARGET_INTERNALS];\r\n\r\n    if (!internals.active) {\r\n      return;\r\n    }\r\n\r\n    internals.active = false;\r\n    pool.remove(id);\r\n\r\n    for (const name in internals) {\r\n      delete internals[name];\r\n    }\r\n  }\r\n}\r\n\r\nexport const createTargetResource = (pool, resource, resourceType, id) => (\r\n  new TargetResource(pool, resource, resourceType, id || getId())\r\n);\r\n\r\nexport default TargetResource;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/resource/TargetResource.js","import { createDeferred, TARGET_INTERNALS } from '../utils';\r\nimport { createRequestPackage } from '../request';\r\nimport { setTemporary } from '../request/RequestTarget';\r\n\r\nconst createCommandHandlerFor = (\r\n  factoryWrapper,\r\n  propertyName,\r\n  commandType,\r\n  isTemporary,\r\n  cacheable,\r\n) => {\r\n  const { factory, checkState, getChildRequest } = factoryWrapper;\r\n\r\n  function commandHandler(command, value, ...args) {\r\n    let result;\r\n    let promise;\r\n    if (this[TARGET_INTERNALS]) {\r\n      const pack = createRequestPackage(\r\n        commandType,\r\n        [command, value, ...args],\r\n        this[TARGET_INTERNALS].id,\r\n      );\r\n      // FIXME Explicitly pass scope\r\n      const request = getChildRequest(propertyName, pack, cacheable);\r\n      result = request.child;\r\n      if (request.deferred) {\r\n        promise = this[TARGET_INTERNALS].sendRequest(propertyName, pack, request.deferred, result);\r\n        if (promise) {\r\n          if (isTemporary) {\r\n            // FIXME isTemporary must be called before `result` was resolved\r\n            // FIXME remove default `isTemporary`, if not defined just skip\r\n            checkState(promise, isTemporary, this, result, pack);\r\n          }\r\n        } else {\r\n          result = null;\r\n          promise = Promise.reject(new Error('Initial request failed and didn\\'t result in promise.'));\r\n        }\r\n      }\r\n    } else {\r\n      promise = Promise.reject(new Error('Target object is not a resource, so cannot be used for calls.'));\r\n    }\r\n    return result || factory.create(promise);\r\n  }\r\n\r\n  return commandHandler;\r\n};\r\n\r\nclass CommandHandlerFactory {\r\n  members = new Map();\r\n  factory = null;\r\n\r\n  constructor(factory = null) {\r\n    this.setFactory(factory);\r\n  }\r\n\r\n  /**\r\n   * @param {CommandDescriptor} descriptor\r\n   * @returns {Function}\r\n   * @private\r\n   */\r\n  get(descriptor) {\r\n    const propertyName = descriptor.name;\r\n    if (!this.members.has(propertyName)) {\r\n      this.members.set(\r\n        propertyName,\r\n        this.create(\r\n          descriptor.name,\r\n          descriptor.type,\r\n          descriptor.isTemporary,\r\n          descriptor.cacheable,\r\n        ),\r\n      );\r\n    }\r\n    return this.members.get(propertyName);\r\n  }\r\n\r\n  create(propertyName, commandType, isTemporary, cacheable) {\r\n    return createCommandHandlerFor(this, propertyName, commandType, isTemporary, cacheable);\r\n  }\r\n\r\n  getChildRequest = (propertyName, pack, cacheable) => {\r\n    let child;\r\n    let deferred;\r\n\r\n    if (cacheable) {\r\n      child = this.factory.getCached(propertyName, pack);\r\n    }\r\n\r\n    if (!child) {\r\n      deferred = createDeferred();\r\n      if (cacheable) {\r\n        child = this.factory.createCached(deferred.promise, propertyName, pack);\r\n      } else {\r\n        child = this.factory.create(deferred.promise, propertyName, pack);\r\n      }\r\n    }\r\n    return { child, deferred };\r\n  };\r\n\r\n  checkState = (promise, isTemporaryFn, parentRequest, childRequest, pack) => {\r\n    if (promise) {\r\n      promise.then((data) => {\r\n        const isTemporary = Boolean(isTemporaryFn(parentRequest, childRequest, pack, data));\r\n        setTemporary(childRequest, isTemporary);\r\n      });\r\n    }\r\n  };\r\n\r\n  setFactory(factory) {\r\n    this.factory = factory;\r\n  }\r\n}\r\n\r\nexport default CommandHandlerFactory;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/commands/CommandHandlerFactory.js","import ResourcePool from '../ResourcePool';\r\n\r\nexport class DefaultResourcePool extends ResourcePool {\r\n  // INFO default ResourcePool should not be destroyable;\r\n  destroy() {\r\n    throw new Error('Default ResourcePool cannot be destroyed.');\r\n  }\r\n}\r\n\r\nconst defaultResourcePool = new DefaultResourcePool();\r\n\r\nexport default defaultResourcePool;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/resource/utils/defaultResourcePool.js","import { isResource } from './resourceUtils';\r\n\r\n/**\r\n * Interface for all resource types, these will be treated as resources automatically\r\n * @interface\r\n * @alias DataAccessInterface.IConvertible\r\n */\r\nclass IConvertible {\r\n\r\n}\r\n\r\nexport const isResourceConvertible = (data) => (\r\n  isResource(data)\r\n  || typeof data === 'function'\r\n  || data instanceof IConvertible\r\n);\r\n\r\nexport default IConvertible;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/resource/utils/IConvertible.js","import { TARGET_INTERNALS, TARGET_DATA, getId } from '../utils';\r\nimport { RequestTarget } from '../../request';\r\nimport defaultResourcePool from './defaultResourcePool';\r\nimport IConvertible from './IConvertible';\r\nimport TargetResource from '../TargetResource';\r\n\r\nexport const isResource = (object) => object instanceof TargetResource ||\r\n  object instanceof RequestTarget ||\r\n  (object && (\r\n    // this case for RequestTargets and TargetResources which contain\r\n    // data in TARGET_INTERNALS Symbol\r\n    // We check for their types above but in cases when Proxies are enabled\r\n    // their type will be Function and verification will come to this case\r\n    typeof object[TARGET_INTERNALS] === 'object' ||\r\n    // this case for RAW resources passed via JSON conversion,\r\n    // look like {'resource::data': {id: '1111', poolId: '22222'}}\r\n    typeof object[TARGET_DATA] === 'object'\r\n  ));\r\n\r\nexport const getResourceId = (object) => {\r\n  // if (object instanceof TargetResource || object instanceof RequestTarget) {\r\n  if (typeof object[TARGET_INTERNALS] === 'object') {\r\n    return object[TARGET_INTERNALS];\r\n  } else if (isResource(object)) {\r\n    return object[TARGET_DATA].id;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const getResourcePoolId = (object) => {\r\n  if (typeof object[TARGET_INTERNALS] === 'object') {\r\n    return object[TARGET_INTERNALS].poolId;\r\n  } else if (isResource(object)) {\r\n    return object[TARGET_DATA].poolId;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const getResourceType = (object) => {\r\n  if (typeof object[TARGET_INTERNALS] === 'object') {\r\n    return object[TARGET_INTERNALS].type;\r\n  } else if (isResource(object)) {\r\n    return object[TARGET_DATA].type;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const getRawResource = (object, pool) => {\r\n  pool = pool || defaultResourcePool;\r\n\r\n  if (object instanceof TargetResource) {\r\n    return object.toJSON();\r\n  } else if (typeof object[TARGET_INTERNALS] === 'object') {\r\n    return RequestTarget.toJSON(object);\r\n  } else if (object instanceof IConvertible || typeof object === 'function') {\r\n    return pool.set(object).toJSON();\r\n  } else if (isResource(object)) {\r\n    return object;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const getResourceData = (object) => {\r\n  const data = getRawResource(object);\r\n  return data ? data[TARGET_DATA] : null;\r\n};\r\n\r\nexport const createForeignResource = (type, resource = {}) => {\r\n  resource[TARGET_DATA] = {\r\n    id: `foreign-id-${getId()}`,\r\n    type: type || typeof resource,\r\n    poolId: `foreign-poolId-${getId()}`,\r\n  };\r\n\r\n  return resource;\r\n};\r\n\r\nexport const areSameResource = (resource1, resource2) => (\r\n  isResource(resource1)\r\n  && isResource(resource2)\r\n  && getResourceId(resource1) === getResourceId(resource2)\r\n  && getResourcePoolId(resource1) === getResourcePoolId(resource2)\r\n);\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/resource/utils/resourceUtils.js","import { TargetStatus, createDeferred, TARGET_DATA } from '../utils';\r\nimport { createRequestPackage } from './utils';\r\nimport { isResource, getResourceData } from '../resource/utils';\r\nimport { getRawPromise } from './RequestTarget';\r\nimport {\r\n  RequestTargetCommandFields,\r\n  RequestTargetCommandNames,\r\n} from '../commands/RequestTargetCommands';\r\n\r\n/**\r\n * @exports RequestTargetInternals\r\n */\r\n\r\nclass RequestTargetInternals {\r\n\r\n  /**\r\n   * @class RequestTargetInternals\r\n   * @param {DataAccessInterface.RequestTarget} _requestTarget\r\n   * @param {Promise} _promise\r\n   * @param {RequestHandlers} _requestHandlers\r\n   * @mixin Promise\r\n   */\r\n  constructor(requestTarget, promise, requestHandlers) {\r\n    this.requestHandlers = requestHandlers;\r\n    this.requestTarget = requestTarget;\r\n    this.link = {};\r\n    // INFO this should be not initialized i.e. keep it undefined, this will be checked later\r\n    this.temporary;\r\n    this.hadChildPromises = false;\r\n    this.status = TargetStatus.PENDING;\r\n    this.queue = [];\r\n    this.children = [];\r\n    this.deferred = createDeferred();\r\n    this.promise = this.deferred.promise\r\n      .then(\r\n        this.handlePromiseResolve,\r\n        this.handlePromiseReject,\r\n      );\r\n  }\r\n\r\n  handlePromiseResolve = (value) => {\r\n    this.status = TargetStatus.RESOLVED;\r\n    if (isResource(value)) {\r\n      this.link = getResourceData(value);\r\n      /*\r\n       INFO Sending \"this\" as result of resolve() handler, causes infinite\r\n       loop of this.then(), so I've used wrapper object\r\n      */\r\n      // FIXME Check if Proxy wrapper will work with promise result, probably not\r\n      value = { target: this.requestTarget };\r\n      this.sendQueue();\r\n      /*\r\n      In theory, at time of these lines executing, \"temporary\" property should be\r\n      already set via _commandHandler() set from RequestTargetDecorator\r\n       */\r\n      if (this.temporary) {\r\n        this.destroy();\r\n      }\r\n    } else { // else { value must be passed as is }\r\n      this.rejectQueue('Target of the call is not a resource and call cannot be sent.');\r\n    }\r\n    this.deferred.resolve(value);\r\n    delete this.deferred;\r\n  };\r\n\r\n  handlePromiseReject = (value) => {\r\n    this.status = TargetStatus.REJECTED;\r\n    this.rejectQueue('Target of the call was rejected and call cannot be sent.');\r\n    this.deferred.reject(value);\r\n    delete this.deferred;\r\n  };\r\n\r\n  get poolId() {\r\n    return this.link.poolId || null;\r\n  }\r\n\r\n  get type() {\r\n    return this.link.type || null;\r\n  }\r\n\r\n  get id() {\r\n    return this.link.id || null;\r\n  }\r\n\r\n  sendQueue() {\r\n    while (this.queue && this.queue.length) {\r\n      const [name, pack, deferred, child] = this.queue.shift();\r\n      pack.target = this.link.id;\r\n      this.handleRequest(name, pack, deferred, child);\r\n    }\r\n    this.queue = null;\r\n  }\r\n\r\n  rejectQueue(message) {\r\n    const error = new Error(message || 'This request was rejected before sending.');\r\n    while (this.queue && this.queue.length) {\r\n      /**\r\n       * @type {Array.<string, CommandDataPack, DataAccessInterface.Deferred>}\r\n       */\r\n      // FIXME [string, {type:string, cmd:string, value:*, target:string}, Deferred]\r\n      // how to describe this in JSDoc?\r\n      const [, , deferred] = this.queue.shift();\r\n      deferred.reject(error);\r\n    }\r\n    this.queue = null;\r\n  }\r\n\r\n  sendRequest(name, pack, deferred, child) {\r\n    let promise = null;\r\n\r\n    if (this.requestHandlers.hasHandler(name)) {\r\n      promise = this.applyRequest(name, pack, deferred || createDeferred(), child);\r\n    } else {\r\n      throw new Error(`Request handler for \"${name}\" is not registered.`);\r\n    }\r\n\r\n    if (child) {\r\n      this.registerChild(child);\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  addToQueue(name, pack, deferred, child) {\r\n    this.queue.push([name, pack, deferred, child]);\r\n  }\r\n\r\n  applyRequest(name, pack, deferred, child) {\r\n    let { promise } = deferred;\r\n\r\n    switch (this.status) {\r\n      case TargetStatus.PENDING:\r\n        this.addToQueue(name, pack, deferred, child);\r\n        break;\r\n      case TargetStatus.REJECTED:\r\n        promise = Promise.reject(new Error('Target object was rejected and cannot be used for calls.'));\r\n        break;\r\n      case TargetStatus.DESTROYED:\r\n        promise = Promise.reject(new Error('Target object was destroyed and cannot be used for calls.'));\r\n        break;\r\n      case TargetStatus.RESOLVED:\r\n        this.handleRequest(name, pack, deferred, child);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  handleRequest(name, pack, deferred, child) {\r\n    this.requestHandlers.handle(this.requestTarget, name, pack, deferred, child);\r\n  }\r\n\r\n  registerChild(childRequestTarget) {\r\n    const handleChildRequest = () => {\r\n      if (this.children) {\r\n        const index = this.children.indexOf(childRequestTarget);\r\n        if (index >= 0) {\r\n          this.children.splice(index, 1);\r\n        }\r\n      }\r\n    };\r\n\r\n    this.children.push(childRequestTarget);\r\n    getRawPromise(childRequestTarget)\r\n      .then(handleChildRequest, handleChildRequest);\r\n  }\r\n\r\n  isActive() {\r\n    return this.status === TargetStatus.PENDING || this.status === TargetStatus.RESOLVED;\r\n  }\r\n\r\n  canBeDestroyed() {\r\n    return this.status === TargetStatus.RESOLVED || this.status === TargetStatus.REJECTED;\r\n  }\r\n\r\n  destroy() {\r\n    let promise = null;\r\n    if (this.canBeDestroyed()) {\r\n      // INFO I should not clear children list, since they are pending and requests already sent.\r\n      if (this.status === TargetStatus.RESOLVED) {\r\n        promise = this.sendRequest(\r\n          RequestTargetCommandFields.DESTROY,\r\n          createRequestPackage(\r\n            RequestTargetCommandNames.DESTROY,\r\n            [null, null],\r\n            this.id,\r\n          ),\r\n        );\r\n      } else {\r\n        promise = Promise.resolve();\r\n      }\r\n      this.status = TargetStatus.DESTROYED;\r\n    } else {\r\n      promise = Promise.reject(new Error('Invalid or already destroyed target.'));\r\n    }\r\n    return promise;\r\n  }\r\n\r\n  then(handleResolve, handleReject) {\r\n    const child = this.promise.then(handleResolve, handleReject);\r\n    this.hadChildPromises = true;\r\n    return child;\r\n  }\r\n\r\n  catch(handleReject) {\r\n    const child = this.promise.catch(handleReject);\r\n    this.hadChildPromises = true;\r\n    return child;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      [TARGET_DATA]: {\r\n        id: this.link.id,\r\n        type: this.link.type,\r\n        poolId: this.link.poolId,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nexport default RequestTargetInternals;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/RequestTargetInternals.js","import CommandDescriptor, { addDescriptorTo } from './CommandDescriptor';\r\n\r\nexport const RequestTargetCommandNames = Object.freeze({\r\n  DESTROY: '::destroy.resource',\r\n});\r\n\r\nexport const RequestTargetCommandFields = Object.freeze({\r\n  DESTROY: Symbol('::destroy.resource'),\r\n});\r\n\r\n/**\r\n * Destroy is unique type that exists for every RequestTarget\r\n * and does not have a method on its instances. This type will\r\n * be send each time RequestTarget.destroy() is applied to\r\n * RequestTarget in stance.\r\n */\r\nclass RequestTargetCommands {\r\n  constructor() {\r\n    Object.freeze(this);\r\n  }\r\n\r\n  createDESTROYDescriptor = (handler, target) => {\r\n    const descriptor = new CommandDescriptor(\r\n      RequestTargetCommandNames.DESTROY,\r\n      handler,\r\n      RequestTargetCommandFields.DESTROY,\r\n    );\r\n    descriptor.virtual = true;\r\n    addDescriptorTo(descriptor, target);\r\n    return Object.freeze(descriptor);\r\n  };\r\n\r\n}\r\n\r\nexport default new RequestTargetCommands();\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/commands/RequestTargetCommands.js","import CommandHandlerFactory from '../commands/CommandHandlerFactory';\r\nimport { getResourceType } from '../resource';\r\n\r\nclass RequestTargetDecorator {\r\n\r\n  /**\r\n   * @param {RequestFactory} factory\r\n   * @param {RequestHandlers} handlers\r\n   * @private\r\n   */\r\n  constructor(factory, handlers) {\r\n    this.handlers = handlers;\r\n    this.members = new CommandHandlerFactory(factory);\r\n  }\r\n\r\n  apply(request) {\r\n    let result;\r\n\r\n    if (!this.handlers.available) return;\r\n    /* FIXME revert change when ES6 will be supported widely\r\n     for (var descriptor of this.handlers) {\r\n     request[descriptor.name] = this.getMember(descriptor.name, descriptor.type);\r\n     }\r\n     */\r\n\r\n    const iterator = this.handlers.getHandlers(getResourceType(request));\r\n    while (!(result = iterator.next()).done) {\r\n      const descriptor = result.value;\r\n      request[descriptor.name] = this.members.get(descriptor);\r\n    }\r\n    return request;\r\n  }\r\n\r\n  setFactory(factory) {\r\n    if (factory) {\r\n      this.members.setFactory(factory);\r\n    }\r\n  }\r\n}\r\n\r\nexport const createRequestTargetDecorator = (factory, handlers) => (\r\n  new RequestTargetDecorator(factory, handlers)\r\n);\r\n\r\nexport default RequestTargetDecorator;\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/RequestTargetDecorator.js","import { createRequestTargetDecorator } from './RequestTargetDecorator';\r\nimport { createRequestTarget } from './RequestTarget';\r\n\r\nexport const FACTORY_DECORATOR_FIELD = Symbol('request.factory::decorator');\r\nexport const FACTORY_HANDLERS_FIELD = Symbol('request.factory::handlers');\r\n\r\nclass RequestFactory {\r\n  /*\r\n   function DummyCacheImpl() {\r\n   this.get = function(name, pack) {\r\n\r\n   };\r\n   this.set = function(name, pack, request) {\r\n\r\n   };\r\n   }\r\n   */\r\n  constructor(handlers, cacheImpl = null, noInit = false) {\r\n    if (noInit) {\r\n      return;\r\n    }\r\n\r\n    this.cache = cacheImpl;\r\n    this[FACTORY_HANDLERS_FIELD] = handlers;\r\n    this[FACTORY_DECORATOR_FIELD] = createRequestTargetDecorator(this, handlers);\r\n  }\r\n\r\n  create(promise) {\r\n    const request = createRequestTarget(promise, this[FACTORY_HANDLERS_FIELD]);\r\n    if (this[FACTORY_HANDLERS_FIELD].available) {\r\n      this[FACTORY_DECORATOR_FIELD].apply(request);\r\n    }\r\n    return request;\r\n  }\r\n\r\n  getCached(name, pack) {\r\n    return this.cache && this.cache.get(name, pack);\r\n  }\r\n\r\n  createCached(promise, name, pack) {\r\n    let request = null;\r\n    if (this.cache) {\r\n      request = this.create(promise);\r\n      this.cache.set(name, pack, request);\r\n    }\r\n    return request;\r\n  }\r\n\r\n}\r\n\r\nexport const createRequestFactory = (handlers, cacheImpl) => (\r\n  new RequestFactory(handlers, cacheImpl)\r\n);\r\n\r\nexport default RequestFactory;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/RequestFactory.js","import DataAccessInterface, {\r\n  create,\r\n  dummy,\r\n} from './DataAccessInterface';\r\nimport {\r\n  createDeferred,\r\n  Deferred,\r\n} from './utils';\r\nimport {\r\n  CommandDescriptor,\r\n  Reserved,\r\n  RequestTargetCommands,\r\n  ProxyCommands,\r\n} from './commands';\r\nimport { RequestTarget } from './request';\r\nimport {\r\n  ResourcePool,\r\n  ResourcePoolRegistry,\r\n  ResourceConverter,\r\n} from './resource';\r\nimport {\r\n  IConvertible,\r\n  isResourceConvertible,\r\n  getRawResource,\r\n  getResourceData,\r\n  getResourceId,\r\n  getResourcePoolId,\r\n  getResourceType,\r\n  isResource,\r\n} from './resource/utils';\r\n\r\nexport default DataAccessInterface;\r\n\r\nexport {\r\n  create,\r\n  dummy,\r\n  createDeferred,\r\n  Deferred,\r\n  CommandDescriptor,\r\n  Reserved,\r\n  RequestTargetCommands,\r\n  ProxyCommands,\r\n  RequestTarget,\r\n  ResourcePool,\r\n  ResourcePoolRegistry,\r\n  ResourceConverter,\r\n  IConvertible,\r\n  isResourceConvertible,\r\n  getRawResource,\r\n  getResourceData,\r\n  getResourceId,\r\n  getResourcePoolId,\r\n  getResourceType,\r\n  isResource,\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/index.js","/**\r\n * @exports DataAccessInterface\r\n */\r\n\r\nimport { areProxiesAvailable } from './utils';\r\nimport {\r\n  createRequestHandlers,\r\n  createRequestProxyFactory,\r\n  createRequestFactory,\r\n} from './request';\r\nimport {\r\n  createResourceConverter,\r\n  createResourcePoolRegistry,\r\n  ResourcePoolEvents,\r\n} from './resource';\r\nimport {\r\n  defaultResourcePool,\r\n  isResource,\r\n  getResourcePoolId,\r\n  getResourceId,\r\n} from './resource/utils';\r\n\r\nclass DataAccessInterface {\r\n\r\n  /**\r\n   * @class DataAccessInterface\r\n   * @classdesc Facade of Deferred Data Access library, it holds all\r\n   * of public API -- objects like ResourcePool and methods to work\r\n   * with resources.\r\n   * @param {CommandDescriptor[]|Object.<string, Function|CommandDescriptor>} descriptors\r\n   * @param {boolean} [proxyEnabled=false]\r\n   * @param {ResourcePoolRegistry} [poolRegistry]\r\n   * @param {ResourcePool} [pool]\r\n   * @param {ICacheImpl} [cacheImpl]\r\n   */\r\n  constructor(\r\n    descriptors,\r\n    proxyEnabled = true,\r\n    poolRegistry = null,\r\n    pool = null,\r\n    cacheImpl = null,\r\n  ) {\r\n    this.poolRegistry = poolRegistry;\r\n    this.pool = pool;\r\n    this.cache = cacheImpl;\r\n    this.initialize(descriptors, proxyEnabled);\r\n  }\r\n\r\n  initialize(descriptors, proxyEnabled) {\r\n    if (proxyEnabled && !areProxiesAvailable()) {\r\n      throw new Error('Proxies are not available in this environment');\r\n    }\r\n\r\n    this.handlers = createRequestHandlers(proxyEnabled);\r\n    this.resourceConverter = createResourceConverter(\r\n      this.factory,\r\n      this.poolRegistry,\r\n      this.pool,\r\n      this.handlers,\r\n    );\r\n\r\n    if (proxyEnabled) {\r\n      this.factory = createRequestProxyFactory(this.handlers, this.cache);\r\n    } else {\r\n      this.factory = createRequestFactory(this.handlers, this.cache);\r\n    }\r\n\r\n    if (!this.poolRegistry) {\r\n      this.poolRegistry = createResourcePoolRegistry();\r\n    }\r\n\r\n    if (this.pool) {\r\n      this.poolRegistry.register(this.pool);\r\n    } else if (this.pool !== undefined) {\r\n      this.pool = this.poolRegistry.createPool();\r\n    } else {\r\n      this.pool = defaultResourcePool;\r\n    }\r\n\r\n    const poolDestroyedHandler = () => {\r\n      this.pool.removeEventListener(ResourcePoolEvents.POOL_DESTROYED, poolDestroyedHandler);\r\n      this.pool = this.poolRegistry.createPool();\r\n      this.pool.addEventListener(ResourcePoolEvents.POOL_DESTROYED, poolDestroyedHandler);\r\n    };\r\n\r\n    this.handlers.setHandlers(descriptors);\r\n    this.pool.addEventListener(ResourcePoolEvents.POOL_DESTROYED, poolDestroyedHandler);\r\n  }\r\n\r\n  get proxyEnabled() {\r\n    return this.handlers.proxyEnabled;\r\n  }\r\n\r\n  parse(data) {\r\n    return this.resourceConverter.parse(data);\r\n  }\r\n\r\n  toJSON(data) {\r\n    return this.resourceConverter.toJSON(data);\r\n  }\r\n\r\n  isOwnResource(resource) {\r\n    /**\r\n     * @type {DataAccessInterface.ResourcePool}\r\n     */\r\n    let pool;\r\n    if (isResource(resource)) {\r\n      pool = this.poolRegistry.get(getResourcePoolId(resource));\r\n      return pool && pool.has(getResourceId(resource));\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const create = (handlers, proxyEnabled, poolRegistry, pool, cacheImpl) =>\r\n  new DataAccessInterface(handlers, proxyEnabled, poolRegistry, pool, cacheImpl);\r\n\r\nexport const dummy = (handlers, proxyEnabled, poolRegistry, pool, cacheImpl) => {\r\n  const api = new DataAccessInterface(handlers, proxyEnabled, poolRegistry, pool, cacheImpl);\r\n  return api.parse(handlers());\r\n};\r\n\r\nexport default DataAccessInterface;\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/DataAccessInterface.js","const createRequestPackage = (type, args, targetId) => {\r\n  const result = {\r\n    type,\r\n    cmd: args[0], // cmd,\r\n    value: args[1], // value,\r\n    target: targetId,\r\n  };\r\n\r\n  // FIXME why?\r\n  Object.defineProperty(result, 'args', {\r\n    value: args,\r\n  });\r\n\r\n  return result;\r\n};\r\n\r\nexport default createRequestPackage;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/utils/createRequestPackage.js","import { Reserved, createCommandDescriptor, CommandDescriptor } from '../../commands';\r\n\r\n/**\r\n * Checks for CommandDescriptor uniqueness and reserved words usage.\r\n * @param {DataAccessInterface.CommandDescriptor} descriptor\r\n * @param {Object.<string, DataAccessInterface.CommandDescriptor>} descriptors\r\n * @param {Array.<number, DataAccessInterface.CommandDescriptor>} properties\r\n * @private\r\n */\r\nconst applyDescriptor = (descriptor, descriptors, properties) => {\r\n  const { name } = descriptor;\r\n  if (name in Reserved.names) {\r\n    throw new Error(`Name \"${name}\" is reserved and cannot be used in descriptor.`);\r\n  }\r\n  if (\r\n    Object.prototype.hasOwnProperty.call(descriptors, name)\r\n    && descriptors[name] instanceof CommandDescriptor\r\n  ) {\r\n    throw new Error(`Field names should be unique, \"${String(name)}\" field has duplicates.`);\r\n  }\r\n  descriptors[name] = descriptor;\r\n  if (!descriptor.virtual) {\r\n    properties.push(descriptor);\r\n  }\r\n};\r\n\r\n/**\r\n * @param {Array} handlers\r\n * @param {Object} descriptors\r\n * @private\r\n */\r\nconst filterArray = (handlers, descriptors, properties) => {\r\n  const { length } = handlers;\r\n  for (let index = 0; index < length; index++) {\r\n    const value = handlers[index];\r\n    if (value instanceof CommandDescriptor) {\r\n      applyDescriptor(value, descriptors, properties);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {Object} handlers\r\n * @param {Object.<string, DataAccessInterface.CommandDescriptor>} descriptors\r\n * @param {Array.<number, DataAccessInterface.CommandDescriptor>} properties\r\n * @private\r\n */\r\nconst filterHash = (handlers, descriptors, properties) => {\r\n  if (!handlers) return;\r\n  const keys = Object.getOwnPropertyNames(handlers).concat(Object.getOwnPropertySymbols(handlers));\r\n  const { length } = keys;\r\n  for (let index = 0; index < length; index++) {\r\n    const name = keys[index];\r\n    let value = handlers[name];\r\n    if (typeof value === 'function') {\r\n      value = createCommandDescriptor(name, value);\r\n    }\r\n    if (value instanceof CommandDescriptor) {\r\n      applyDescriptor(value, descriptors, properties);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @method RequestHandlers.filterHandlers\r\n * @param {Array|Object} handlers\r\n * @param {Object.<string, DataAccessInterface.CommandDescriptor>} descriptors\r\n * @param {Array.<number, DataAccessInterface.CommandDescriptor>} properties\r\n */\r\nconst filterRequestHandlers = (handlers, descriptors, properties) => {\r\n  if (handlers instanceof Array) {\r\n    filterArray(handlers, descriptors, properties);\r\n  } else {\r\n    filterHash(handlers, descriptors, properties);\r\n  }\r\n};\r\n\r\nexport default filterRequestHandlers;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/utils/filterRequestHandlers.js","import EventDispatcher from 'event-dispatcher';\r\nimport {\r\n  getResourcePoolId,\r\n  getResourceId,\r\n  isResource,\r\n  isResourceConvertible,\r\n  getRawResource,\r\n} from './utils';\r\nimport { isPending } from '../request/RequestTarget';\r\n\r\nexport const ResourceConverterEvents = Object.freeze({\r\n  RESOURCE_CREATED: 'resourceCreated',\r\n  RESOURCE_CONVERTED: 'resourceConverted',\r\n});\r\n\r\n/**\r\n * Resource converter contains bunch of methods to lookup for resources\r\n * and registering them, converting them into RAWResource or into\r\n * RequestTargets, depending on their origin.\r\n * Before sending data, bundled resources should be registered in ResourcePool\r\n * and then converted to RAWResource objects.\r\n * After data received, its RAWResources should be converted to RequestTargets\r\n * for not resolved resources or to resource target values otherwise.\r\n * Resource can be resolved by its `id` and `poolId`, if ResourceConverter\r\n * can find ResourcePool with id from poolId, it will try to get target\r\n * resource value and replace with it RAWResource object.\r\n * If ResourcePool not found, ResourceConverter assumes that resource come from\r\n * other origin/environment and creates RequestTarget object that can be target\r\n * object for commands.\r\n * ResourceConverter while handling data does not look deeply, so its developer\r\n * responsibility to convert deeply nested resource targets.\r\n * @param {RequestFactory} factory\r\n * @param {ResourcePoolRegistry} registry\r\n * @param {ResourcePool} pool\r\n * @param {RequestHandlers} handlers\r\n * @extends EventDispatcher\r\n */\r\nclass ResourceConverter extends EventDispatcher {\r\n  constructor(factory, registry, pool, handlers = null) {\r\n    super();\r\n    this.factory = factory;\r\n    this.pool = pool;\r\n    this.registry = registry;\r\n\r\n    if (handlers) {\r\n      handlers.setConverter(this);\r\n    }\r\n  }\r\n\r\n  resourceToObject(data) {\r\n    let result;\r\n\r\n    if (isResourceConvertible(data)) {\r\n      result = getRawResource(data, this.pool);\r\n    } else if (typeof data.toJSON === 'function') {\r\n      result = data.toJSON();\r\n    } else {\r\n      return data;\r\n    }\r\n\r\n    if (this.hasEventListener(ResourceConverterEvents.RESOURCE_CONVERTED)) {\r\n      this.dispatchEvent(ResourceConverterEvents.RESOURCE_CONVERTED, {\r\n        data,\r\n        result,\r\n      });\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @method DataAccessInterface.ResourceConverter#objectToResource\r\n   * @param {*} data\r\n   * @returns {*}\r\n   * @private\r\n   */\r\n  objectToResource(data) {\r\n    let result = data;\r\n\r\n    if (isResource(data)) {\r\n      const poolId = getResourcePoolId(data);\r\n\r\n      if (this.registry.isRegistered(poolId)) { // target object is stored in current pool\r\n        const target = this.registry.get(poolId).get(getResourceId(data));\r\n\r\n        if (target) {\r\n          result = target.resource;\r\n        }\r\n\r\n      } else { // target object has another origin, should be wrapped\r\n        result = this.factory.create(Promise.resolve(data));\r\n      }\r\n    }\r\n\r\n    if (result !== data && this.hasEventListener(ResourceConverterEvents.RESOURCE_CREATED)) {\r\n      this.dispatchEvent(ResourceConverterEvents.RESOURCE_CREATED, {\r\n        data,\r\n        result,\r\n      });\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @method DataAccessInterface.ResourceConverter#lookupArray\r\n   * @param list\r\n   * @param linkConvertHandler\r\n   * @returns {Array}\r\n   * @private\r\n   */\r\n  lookupArray(list, linkConvertHandler) {\r\n    const result = [];\r\n    const { length } = list;\r\n    for (let index = 0; index < length; index++) {\r\n      // FIXME Array.map()\r\n      result[index] = linkConvertHandler.call(this, list[index]);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @method DataAccessInterface.ResourceConverter#lookupObject\r\n   * @param {*} data\r\n   * @param {Function} linkConvertHandler\r\n   * @returns {*}\r\n   * @private\r\n   */\r\n  lookupObject(data, linkConvertHandler) {\r\n    const result = {};\r\n    for (const name in data) {\r\n      if (!Object.property.hasOwnProperty.call(data, name)) continue;\r\n      result[name] = linkConvertHandler.call(this, data[name]);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @method DataAccessInterface.ResourceConverter#toJSON\r\n   * @param {*} data\r\n   * @returns {*}\r\n   * @private\r\n   */\r\n  toJSON(data) {\r\n    let result = data;\r\n\r\n    if (data !== undefined && data !== null) {\r\n      if (isResourceConvertible(data)) {\r\n        // if data is RequestTarget, TargetResource, IConvertible, Function or RAW resource data\r\n        result = this.resourceToObject(data);\r\n      } else if (data instanceof Array) {\r\n        // if data is Array of values, check its\r\n        result = this.lookupArray(data, this.resourceToObject);\r\n      } else if (data.constructor === Object) {\r\n        // only Object instances can be looked up, other object types must be converted by hand\r\n        result = this.lookupObject(data, this.resourceToObject);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @method DataAccessInterface.ResourceConverter#parse\r\n   * @param {*} data\r\n   * @returns {*}\r\n   * @private\r\n   */\r\n  parse(data) {\r\n    let result = data;\r\n\r\n    if (data !== undefined && data !== null) {\r\n      if (isResource(data)) { // if data is RAW resource data\r\n        result = this.objectToResource(data);\r\n      } else if (data instanceof Array) { // if data is Array of values, check its\r\n        result = this.lookupArray(data, this.objectToResource);\r\n      } else if (data.constructor === Object) {\r\n        result = this.lookupObject(data, this.objectToResource);\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @method DataAccessInterface.ResourceConverter#lookupForPending\r\n   * @param {*} data\r\n   * @returns {Array}\r\n   */\r\n  lookupForPending(data) {\r\n    const result = [];\r\n\r\n    const add = (value) => {\r\n      if (isPending(value)) {\r\n        result.push(value);\r\n      }\r\n      return value;\r\n    };\r\n\r\n    if (typeof data === 'object' && data !== null) {\r\n      if (isPending(data)) {\r\n        result.push(data);\r\n      } else if (data instanceof Array) {\r\n        this.lookupArray(data, add);\r\n      } else if (data.constructor === Object) {\r\n        this.lookupObject(data, add);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * @param {RequestFactory} factory\r\n * @param {DataAccessInterface.ResourcePoolRegistry} registry\r\n * @param {DataAccessInterface.ResourcePool} pool\r\n * @param {RequestHandlers} handlers\r\n * @returns {ResourceConverter}\r\n */\r\nexport const createResourceConverter = (factory, registry, pool, handlers) => (\r\n  new ResourceConverter(factory, registry, pool, handlers)\r\n);\r\n\r\nexport default ResourceConverter;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/resource/ResourceConverter.js","import EventDispatcher from 'event-dispatcher';\r\nimport defaultResourcePool from './utils';\r\nimport ResourcePool, {\r\n  createResourcePool,\r\n  ResourcePoolEvents,\r\n} from './ResourcePool';\r\n\r\nexport const ResourcePoolRegistryEvents = Object.freeze({\r\n  RESOURCE_POOL_CREATED: 'resourcePoolCreated',\r\n  RESOURCE_POOL_REGISTERED: 'resourcePoolRegistered',\r\n  RESOURCE_POOL_REMOVED: 'resourcePoolRemoved',\r\n});\r\n\r\nconst POOLS_FIELD = Symbol('resource.pool.registry::pools');\r\n\r\n/**\r\n * @classdesc Collection of ResourcePool instances. Allows lookup for ResourcePool by its Id.\r\n * When ResourcePool is registered in ResourcePoolRegistry, it subscribes to\r\n * ResourcePool POOL_DESTROYED event and removes pool from registry after its destroyed.\r\n */\r\nclass ResourcePoolRegistry extends EventDispatcher {\r\n  constructor() {\r\n    super();\r\n    this[POOLS_FIELD] = {};\r\n\r\n    // every registry should keep default pool, so you can have access from anywhere\r\n    this.register(defaultResourcePool);\r\n  }\r\n\r\n  handlePoolDestroyed(event) {\r\n    this.remove(event.data);\r\n  }\r\n\r\n  /**\r\n   * Create and register ResourcePool\r\n   * @returns {DataAccessInterface.ResourcePool} New ResourcePool instance\r\n   */\r\n  createPool() {\r\n    const pool = createResourcePool();\r\n    if (this.hasEventListener(ResourcePoolRegistryEvents.RESOURCE_POOL_CREATED)) {\r\n      this.dispatchEvent(ResourcePoolRegistryEvents.RESOURCE_POOL_CREATED, pool);\r\n    }\r\n    this.register(pool);\r\n    return pool;\r\n  }\r\n\r\n  /**\r\n   * Register ResourcePool instance.\r\n   * @param pool {DataAccessInterface.ResourcePool} ResourcePool instance to be registered\r\n   */\r\n  register(pool) {\r\n    if (Object.prototype.hasOwnProperty.call(this[POOLS_FIELD], pool.id)) return;\r\n    this[POOLS_FIELD][pool.id] = pool;\r\n    pool.addEventListener(ResourcePoolEvents.POOL_DESTROYED, this.handlePoolDestroyed);\r\n    if (this.hasEventListener(ResourcePoolRegistryEvents.RESOURCE_POOL_REGISTERED)) {\r\n      this.dispatchEvent(ResourcePoolRegistryEvents.RESOURCE_POOL_REGISTERED, pool);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieve ResourcePool instance from registry by its Id.\r\n   * @param poolId {String} ResourcePool instance Id\r\n   * @returns {DataAccessInterface.ResourcePool|null}\r\n   */\r\n  get(poolId) {\r\n    return this[POOLS_FIELD][poolId] || null;\r\n  }\r\n\r\n  /**\r\n   * Check if ResourcePool registered in this registry instance.\r\n   * @param pool {DataAccessInterface.ResourcePool|String} ResourcePool instance or its Id.\r\n   * @returns {Boolean}\r\n   */\r\n  isRegistered(pool) {\r\n    return Object.prototype.hasOwnProperty.call(\r\n      this[POOLS_FIELD],\r\n      pool instanceof ResourcePool ? pool.id : String(pool),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove ResourcePool from current registry instance.\r\n   * @param pool {DataAccessInterface.ResourcePool|String} ResourcePool instance or its Id.\r\n   * @returns {Boolean}\r\n   */\r\n  remove(pool) {\r\n    let result = false;\r\n    pool = pool instanceof ResourcePool ? pool : this.get(pool);\r\n    if (pool) {\r\n      pool.removeEventListener(ResourcePool.Events.POOL_DESTROYED, this.handlePoolDestroyed);\r\n      result = delete this[POOLS_FIELD][pool.id];\r\n    }\r\n    if (this.hasEventListener(ResourcePoolRegistryEvents.RESOURCE_POOL_REMOVED)) {\r\n      this.dispatchEvent(ResourcePoolRegistryEvents.RESOURCE_POOL_REMOVED, pool);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\nexport const createResourcePoolRegistry = () => new ResourcePoolRegistry();\r\n\r\nexport default ResourcePoolRegistry;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/resource/ResourcePoolRegistry.js","/**\r\n * Reserved words\r\n */\r\nconst Reserved = Object.freeze({\r\n  /**\r\n   * Contains property names that cannot be used for CommandDescriptor's\r\n   */\r\n  names: Object.freeze({\r\n    // INFO Exposed Promise method, cannot be overwritten by type\r\n    then: true,\r\n    // INFO Exposed Promise method, cannot be overwritten by type\r\n    catch: true,\r\n  }),\r\n});\r\n\r\nexport default Reserved;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/commands/Reserved.js","import { CommandDescriptor, ProxyCommands, ProxyCommandFields } from '../commands';\r\nimport { filterRequestHandlers } from './utils';\r\nimport { getResourceType } from '../resource/utils';\r\n\r\n/**\r\n * Key for default type for handlers that will be applied to any\r\n * resource that does not have type-specific handlers registered\r\n * @type {string}\r\n */\r\nconst DEFAULT_KEY = '';\r\n\r\nexport const areProxyHandlersAvailable = (handlers, throwError) => {\r\n  let result = true;\r\n  const list = ProxyCommands.required;\r\n  const { length } = list;\r\n  for (let index = 0; index < length; index++) {\r\n    const name = list[index];\r\n    if (!(ProxyCommandFields[name] in handlers)) {\r\n      result = false;\r\n      if (throwError) {\r\n        throw new Error(`For Proxy interface, handler \"${name}\" should be set.`);\r\n      }\r\n    }\r\n  }\r\n  return result;\r\n};\r\n\r\nexport const RequestHandlersEvents = Object.freeze({\r\n  HANDLERS_UPDATED: 'handlersUpdated',\r\n});\r\n\r\nclass RequestHandlers {\r\n\r\n  /**\r\n   * @class RequestHandlers\r\n   * @param {boolean} proxyEnabled\r\n   * @private\r\n   */\r\n  constructor(proxyEnabled) {\r\n    // named collection of CommandDescriptor lists that may be applied\r\n    this.properties = {};\r\n    this.descriptors = {};\r\n    this.proxyEnabled = Boolean(proxyEnabled);\r\n    this.converter = null;\r\n  }\r\n\r\n  get available() {\r\n    const nonEmptyList = Object.keys(this.properties).find((item) => Boolean(item && item.length));\r\n    return Boolean(nonEmptyList);\r\n  }\r\n\r\n  setConverter(converter) {\r\n    this.converter = converter;\r\n  }\r\n\r\n  setHandlers(handlers) {\r\n    this.setHandlersByType(DEFAULT_KEY, handlers);\r\n\r\n    Object.keys(handlers).forEach((name) => {\r\n      const type = handlers[name];\r\n      if (type && (type.constructor === Object || type instanceof Array)) {\r\n        this.setHandlersByType(name, type);\r\n      }\r\n    });\r\n\r\n    if (this.proxyEnabled) {\r\n      areProxyHandlersAvailable(this.descriptors, true);\r\n    }\r\n  }\r\n\r\n  setHandlersByType(type, handlers) {\r\n    const descrs = {};\r\n    const props = [];\r\n    filterRequestHandlers(handlers, descrs, props);\r\n    this.descriptors[type] = descrs;\r\n    this.properties[type] = props;\r\n  }\r\n\r\n  /**\r\n   * @method RequestHandlers#hasHandler\r\n   * @param {String|Symbol} name Property name of CommandDescriptor\r\n   * @param {String} [type] Resource type for type-specific handlers\r\n   * @returns {boolean}\r\n   */\r\n  hasHandler(name, type) {\r\n    return (\r\n      this.descriptors[type]\r\n        && Object.prototype.hasOwnProperty.call(this.descriptors[type], name)\r\n    )\r\n      || (\r\n        this.descriptors[DEFAULT_KEY]\r\n        && Object.prototype.hasOwnProperty.call(this.descriptors[DEFAULT_KEY], name)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * IMPORTANT: Returns original list of CommandDescriptors, changing it may cause\r\n   * unexpected result with newly decorated resources.\r\n   * @param {String} [type]\r\n   * @returns {CommandDescriptor[]|null}\r\n   * @private\r\n   */\r\n  getHandlers(type) {\r\n    let descrs = this.descriptors[type || DEFAULT_KEY];\r\n    if (!descrs) {\r\n      descrs = this.descriptors[DEFAULT_KEY];\r\n    }\r\n\r\n    return descrs || null;\r\n  }\r\n\r\n  /**\r\n   * @method RequestHandlers#getHandler\r\n   * @param name\r\n   * @param {String} [type]\r\n   * @returns {*|null}\r\n   * @private\r\n   */\r\n  getHandler(name, type) {\r\n    const handler = (\r\n      this.descriptors[type]\r\n        && this.descriptors[type][name]\r\n    )\r\n      || (\r\n        this.descriptors[DEFAULT_KEY]\r\n        && this.descriptors[DEFAULT_KEY][name]\r\n      );\r\n\r\n    return handler || null;\r\n  }\r\n\r\n  /**\r\n   * @method RequestHandlers#handle\r\n   * @param {DataAccessInterface.RequestTarget} parentRequest\r\n   * @param {String|Symbol} name\r\n   * @param {CommandDataPack} pack\r\n   * @param {DataAccessInterface.Deferred} deferred\r\n   * @param {DataAccessInterface.RequestTarget} [resultRequest]\r\n   * @private\r\n   */\r\n  handle(parentRequest, name, pack, deferred, resultRequest) {\r\n    const list = this.converter ? this.converter.lookupForPending(pack.value) : null;\r\n    if (list && list.length) {\r\n      // FIXME Need to test on all platforms: In other browsers this might not work\r\n      // because may need list of Promise objects, not RequestTargets\r\n      Promise.all(list).then(() => {\r\n        this.handleImmediately(parentRequest, name, pack, deferred, resultRequest);\r\n      });\r\n    } else {\r\n      this.handleImmediately(parentRequest, name, pack, deferred, resultRequest);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {DataAccessInterface.RequestTarget} parentRequest\r\n   * @param {String|Symbol} name\r\n   * @param {CommandDataPack} data\r\n   * @param {DataAccessInterface.Deferred} deferred\r\n   * @param {DataAccessInterface.RequestTarget} [resultRequest]\r\n   * @private\r\n   */\r\n  handleImmediately(parentRequest, name, data, deferred, resultRequest) {\r\n    /**\r\n     * @type {DataAccessInterface.CommandDescriptor|null}\r\n     */\r\n    const handler = this.getHandler(name, getResourceType(parentRequest));\r\n    if (handler instanceof CommandDescriptor) {\r\n      // INFO result should be applied to deferred.resolve() or deferred.reject()\r\n      handler.handler(parentRequest, data, deferred, resultRequest);\r\n    } else {\r\n      throw new Error(`Command descriptor for \"${name}\" was not found.`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * @member RequestHandlers.create\r\n * @param {Boolean} proxyEnabled\r\n * @returns {RequestHandlers}\r\n */\r\nexport const createRequestHandlers = (proxyEnabled) => new RequestHandlers(proxyEnabled);\r\n\r\nexport default RequestHandlers;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/RequestHandlers.js","import RequestFactory, { FACTORY_DECORATOR_FIELD, FACTORY_HANDLERS_FIELD } from './RequestFactory';\r\nimport { ProxyCommandFields } from '../commands/ProxyCommands';\r\n\r\nconst FACTORY_FIELD = Symbol('request.proxy.factory::factory');\r\n\r\nconst EXCLUSIONS = {\r\n  /*\r\n   INFO arguments and caller were included because they are required function properties\r\n   */\r\n  arguments: true,\r\n  caller: true,\r\n  prototype: true,\r\n};\r\n\r\nconst wrapWithProxy = (target, handlers) => {\r\n  // INFO Target must be a function so I could use Proxy.call() interceptor.\r\n  function requestTargetProxy() {\r\n  }\r\n\r\n  requestTargetProxy.target = target;\r\n  return new Proxy(requestTargetProxy, handlers);\r\n};\r\n\r\nconst proxyGet = (wrapper, name) => {\r\n  const { target } = wrapper;\r\n  if (name in target || name in EXCLUSIONS || typeof name === 'symbol') {\r\n    return target[name];\r\n  }\r\n  // INFO Proxy should be already applied, so no need in additional wrapping\r\n  return target[ProxyCommandFields.get](name);\r\n};\r\n\r\n// INFO Proxy should be already applied, so no need in additional wrapping\r\nconst proxyApply = (wrapper, thisValue, args) => (\r\n  wrapper.target[ProxyCommandFields.apply](null, args)\r\n);\r\n\r\nconst proxySet = (wrapper, name, value) => {\r\n  const { target } = wrapper;\r\n\r\n  if (name in target || name in EXCLUSIONS || typeof name === 'symbol') {\r\n    target[name] = value;\r\n    return value;\r\n  }\r\n\r\n  return target[ProxyCommandFields.set](name, value);\r\n};\r\n\r\nconst proxyHas = (wrapper, name) => (\r\n  Object.prototype.hasOwnProperty.call(wrapper.target, name)\r\n);\r\n\r\nconst proxyDeleteProperty = (wrapper, name) => {\r\n  const { target } = wrapper;\r\n\r\n  if (ProxyCommandFields.deleteProperty in target) {\r\n    target[ProxyCommandFields.deleteProperty](name);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nconst proxyOwnKeys = () => Object.getOwnPropertyNames(EXCLUSIONS);\r\n\r\nconst proxyEnumerate = () => Object.getOwnPropertyNames(EXCLUSIONS)[Symbol.iterator]();\r\n\r\nconst proxyGetOwnPropertyDescriptor = (wrapper, name) => {\r\n  if (Object.prototype.hasOwnProperty.call(EXCLUSIONS, name)) {\r\n    return Object.getOwnPropertyDescriptor(wrapper, name);\r\n  }\r\n  return Object.getOwnPropertyDescriptor(wrapper.target, name);\r\n};\r\n\r\n/**\r\n * Builds proper handlers hash for Proxy\r\n * @returns {Function}\r\n */\r\nexport const createProxyHandlers = (handlers = {}) => ({\r\n  get: proxyGet,\r\n  apply: proxyApply,\r\n  set: proxySet,\r\n  has: proxyHas,\r\n  deleteProperty: proxyDeleteProperty,\r\n  ownKeys: proxyOwnKeys,\r\n  enumerate: proxyEnumerate,\r\n  getOwnPropertyDescriptor: proxyGetOwnPropertyDescriptor,\r\n  ...handlers,\r\n});\r\n\r\nconst PROXY_HANDLERS = createProxyHandlers();\r\n\r\nclass RequestProxyFactory extends RequestFactory {\r\n  constructor(handlers, cacheImpl) {\r\n    super(null, null, true);\r\n\r\n    this[FACTORY_HANDLERS_FIELD] = handlers;\r\n    this[FACTORY_FIELD] = RequestFactory.create(handlers, cacheImpl);\r\n    this[FACTORY_FIELD][FACTORY_DECORATOR_FIELD].setFactory(this);\r\n  }\r\n\r\n  create(promise) {\r\n    const instance = this[FACTORY_FIELD].create(promise);\r\n\r\n    if (this[FACTORY_HANDLERS_FIELD].available) {\r\n      return wrapWithProxy(instance, PROXY_HANDLERS);\r\n    }\r\n\r\n    return instance;\r\n  }\r\n\r\n  getCached(name, pack) {\r\n    return this[FACTORY_FIELD].getCached(name, pack);\r\n  }\r\n\r\n  createCached(promise, name, pack) {\r\n    const instance = this[FACTORY_FIELD].createCached(promise, name, pack);\r\n\r\n    if (this[FACTORY_HANDLERS_FIELD].available) {\r\n      return wrapWithProxy(instance, PROXY_HANDLERS);\r\n    }\r\n\r\n    return instance;\r\n  }\r\n\r\n}\r\n\r\nexport const applyProxyWithDefaultHandlers = (target) => wrapWithProxy(target, PROXY_HANDLERS);\r\n\r\nexport const createRequestProxyFactory = (handlers, cacheImpl) => (\r\n  new RequestProxyFactory(handlers, cacheImpl)\r\n);\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/request/RequestProxyFactory.js"],"sourceRoot":""}